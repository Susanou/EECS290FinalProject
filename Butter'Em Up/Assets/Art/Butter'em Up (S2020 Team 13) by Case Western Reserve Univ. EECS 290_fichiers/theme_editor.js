(function(){var EMPTY,is_different,translation_component_cache,hasProp={}.hasOwnProperty,slice=[].slice;if(window.R){return}EMPTY={};is_different=function(a,b){var key;for(key in a){if(!hasProp.call(a,key))continue;if(a[key]!==b[key]){return true}}for(key in b){if(!hasProp.call(b,key))continue;if(!(key in a)){return true}}return false};translation_component_cache={};window.R=function(name,data,p,prefix){var cl,class_name,default_props,prop_types;if(p==null){p=R}if(prefix==null){prefix=""}if(p[name]){return p[name]._class}data.trigger=function(){var node;node=$(ReactDOM.findDOMNode(this));R.trigger.apply(R,[node].concat(slice.call(arguments)));return void 0};data.dispatch=function(){var node;node=$(ReactDOM.findDOMNode(this));R.dispatch.apply(R,[node].concat(slice.call(arguments)));return void 0};data.container=function(){return $(ReactDOM.findDOMNode(this))};data.extend_props=function(){var more;more=1<=arguments.length?slice.call(arguments,0):[];return $.extend.apply($,[{},this.props].concat(slice.call(more)))};data.tt=function(key,props){var text;if(props==null){props=EMPTY}if(text=I.i18n.fetch_key_sync(key)){if(_.isString(text)){return text}}translation_component_cache[key]||(translation_component_cache[key]=I.i18n.react_class(key));return React.createElement(translation_component_cache[key],props)};data.t=function(key,variables){if(I.i18n.fetch_key_sync(key)){return I.i18n.t_sync(key,variables)}else{I.i18n.fetch_key(key).done(function(_this){return function(){if(_this.isMounted()){return _this.forceUpdate()}}}(this));return"…"}};class_name=_.once(function(){return(""+prefix+name).replace(/[A-Z]/g,"_$&").replace(/\./g,"_").replace(/__+/g,"_").replace(/^_+/,"").replace(/_+$/,"").toLowerCase()+"_widget"});data.enclosing_class_name=class_name;data.enclose=function(){var args,component,props;props=arguments[0],args=2<=arguments.length?slice.call(arguments,1):[];component=props.component||"div";delete props.component;return React.createElement.apply(React,[component,$.extend({},props,{className:classNames(class_name(),props.className)})].concat(slice.call(args)))};data.displayName=""+prefix+name;if(data.pure){data.shouldComponentUpdate=function(nextProps,nextState){return is_different(this.props||EMPTY,nextProps)||is_different(this.state||EMPTY,nextState)}}default_props=data.getDefaultProps;delete data.getDefaultProps;prop_types=data.propTypes;delete data.propTypes;cl=createReactClass(data);if(default_props){cl.defaultProps=default_props()}if(prop_types){cl.propTypes=prop_types}p[name]=React.createFactory(cl);return p[name]._class=cl};R.scope_event_name=function(name){return"itch:"+name};R.trigger=function(){var args,name,node;node=arguments[0],name=arguments[1],args=3<=arguments.length?slice.call(arguments,2):[];return node.trigger(R.scope_event_name(name),slice.call(args))};R.dispatch=function(node,prefix,event_table){var event_name,fn,results;if(typeof prefix==="object"){event_table=prefix;prefix=false}results=[];for(event_name in event_table){if(!hasProp.call(event_table,event_name))continue;fn=event_table[event_name];if(prefix){event_name=prefix+":"+event_name}results.push(node.on(R.scope_event_name(event_name),fn))}return results};R.component=function(){return R.apply(null,arguments)};R.is_different=is_different;R["package"]=function(_this){return function(prefix){var p;p=R[prefix]||(R[prefix]=function(name,data){data.Package=p;return R.component(name,data,p,prefix+".")});p.component=function(){return p.apply(null,arguments)};return p}}(this)}).call(this);(function(){var ImagePicker,ImageUpload,extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty,bind=function(fn,me){return function(){return fn.apply(me,arguments)}};ImageUpload=function(superClass){extend(ImageUpload,superClass);function ImageUpload(){return ImageUpload.__super__.constructor.apply(this,arguments)}ImageUpload.prototype.success_params={type:"layout",thumb_size:"original"};return ImageUpload}(I.ImageUpload);ImagePicker=function(){function ImagePicker(el,editor,update){this.editor=editor;if(update==null){update=null}if(update){this.update=update}this.el=$(el);this.make_upload_btn();this.el.dispatch("click",{remove_image_btn:function(_this){return function(btn){_this.el.removeClass("has_image").find(".image_preview").css("background-image","").end().find(".image_id_input").val("").end().data("image_url","");return _this.send_update()}}(this)});this.el.on("change",function(_this){return function(e){return _this.send_update()}}(this));this.send_update()}ImagePicker.prototype.upload_prefix=function(){return this.editor.upload_prefix()};ImagePicker.prototype.prepare_upload=function(fn){return typeof fn==="function"?fn():void 0};ImagePicker.prototype.update=function(){};ImagePicker.prototype.send_update=function(){var i,len,name,option,opts,ref,url;name=this.el.data("image_name");url=this.el.data("image_url");if(!url){return this.update(name,void 0)}opts={url:url};ref=this.el.find(".image_option");for(i=0,len=ref.length;i<len;i++){option=ref[i];option=$(option);opts[option.data("name")]=option.find("select").val()}return this.update(name,opts)};ImagePicker.prototype.make_upload_btn=function(){var btn;if(this.upload_btn){return}this.progress_inner||(this.progress_inner=this.el.find(".progress_inner"));btn=this.el.find(".upload_image_btn");return this.upload_btn=I.make_popup_upload_button(this,btn,ImageUpload,{start_uploading:function(_this){return function(){_this.progress_inner.css({width:""});return _this.el.addClass("uploading")}}(this),finish_upload:function(_this){return function(upload,file){_this.el.removeClass("uploading").addClass("has_image").find(".image_preview").css("background-image","url("+file.url+")").end().find(".image_id_input").val(file.id).end().data("image_url",file.url);return _this.send_update()}}(this)})};return ImagePicker}();I.AppearanceEditor=function(){AppearanceEditor.ImageUpload=ImageUpload;AppearanceEditor.ImagePicker=ImagePicker;function AppearanceEditor(el,data){this.data=data;this.set_height=bind(this.set_height,this);this.css_template=bind(this.css_template,this);this.el=$(el);this.style=_.extend({},this.data);this.refresh_style=_.debounce(function(_this){return function(){return _this.constructor.prototype.refresh_style.apply(_this,arguments)}}(this),0);this.setup_color_picker();this.setup_image_picker();this.setup_text_areas();this.setup_form();this.el.dispatch("click",{toggle_editor_btn:function(_this){return function(){return _this.toggle()}}(this)});if(window.location.hash.match(/\bedit\b/)){_.defer(function(_this){return function(){return _this.toggle()}}(this))}$(window).on("resize",_.debounce(function(_this){return function(){return _this.set_height()}}(this),100))}AppearanceEditor.prototype.css_template=function(){var template_code;if(!this.css_template_fn){template_code=this.el.data("css_template");if(!template_code){return}this.css_template_fn=eval(template_code)}return this.css_template_fn.apply(this,arguments)};AppearanceEditor.prototype.set_height=function(){var html_h,inner,inner_h,real_height,win_h;inner=this.el.find(".appearance_editor_inner");html_h=$("html").outerHeight(true);win_h=$(window).height();inner_h=inner.outerHeight(true);if(inner_h>win_h){real_height=Math.max(html_h,win_h,inner_h);return this.el.height(real_height).css({bottom:"",position:""})}else{return this.el.height("").css({bottom:"0",position:"fixed"})}};AppearanceEditor.prototype.toggle=function(){var body;body=$(document.body).toggleClass("show_appearance_editor");this.set_height();this.el.addClass("animating");return setTimeout(function(_this){return function(){_this.el.removeClass("animating");return _this.set_height()}}(this),200)};AppearanceEditor.prototype.refresh_style=function(){};AppearanceEditor.prototype.upload_prefix=function(){throw"override me"};AppearanceEditor.prototype.update_image=function(name,image){this.style[name]=image;return this.refresh_style()};AppearanceEditor.prototype.update_color=function(name,color){this.style[name]=color;return this.refresh_style()};AppearanceEditor.prototype.setup_form=function(){return this.el.find("form").remote_submit(function(_this){return function(res){if(res.errors){alert(res.errors.join(", "))}}}(this))};AppearanceEditor.prototype.setup_text_areas=function(){return this.el.on("focusin focusout",".text_field",function(_this){return function(e){return $(e.currentTarget).toggleClass("open",e.type==="focusin")}}(this))};AppearanceEditor.prototype.setup_image_picker=function(){var el,image_pickers;image_pickers=this.el.find(".image_picker");return this.image_pickers=function(){var i,len,results;results=[];for(i=0,len=image_pickers.length;i<len;i++){el=image_pickers[i];results.push(new ImagePicker($(el),this,function(_this){return function(){return _this.update_image.apply(_this,arguments)}}(this)))}return results}.call(this)};AppearanceEditor.prototype.setup_color_picker=function(){var i,len,picker,pickers;this.el.dispatch("click",{color_preview:function(_this){return function(btn){return _this.open_color_picker(btn.closest(".color_picker"))}}(this)});this.el.on("click",".color_picker .close_btn",function(_this){return function(e){var picker;picker=$(e.target).closest(".color_picker");return picker.data("close")()}}(this));this.el.find("input[type='text']").on("focus",function(_this){return function(e){return _this.open_color_picker($(e.target).closest(".color_picker"),false)}}(this));pickers=this.el.find(".color_picker");for(i=0,len=pickers.length;i<len;i++){picker=pickers[i];picker=$(picker);this.set_picker_color(picker,this.style[picker.find("[data-name]").data("name")])}pickers.on("keyup","input",function(_this){return function(e){var color,ref;color=$(e.currentTarget).val();return(ref=$(e.delegateTarget).data("farb"))!=null?ref.setColor(color):void 0}}(this));return pickers.on("change","input",function(_this){return function(e){var color,ref;picker=$(e.delegateTarget);if(color=(ref=picker.data("farb"))!=null?ref.color:void 0){return picker.find("input").val(color)}}}(this))};AppearanceEditor.prototype.set_picker_color=function(picker,color){var farb,h,input,l,preview,ref,s;farb=picker.data("farb")||new $._farbtastic($());input=picker.find("input");if(color){input.val(color)}else{color=input.val()}preview=picker.find(".color_preview");input=picker.find("input");ref=farb.RGBToHSL(farb.unpack(color)),h=ref[0],s=ref[1],l=ref[2];preview.toggleClass("is_bright",l>.9);preview.css("backgroundColor",color);return this.update_color(picker.find("[data-name]").data("name"),color)};AppearanceEditor.prototype.open_color_picker=function(picker,toggle){var base,farb,i,input,len,other_picker,popup,preview,ref;if(toggle==null){toggle=true}if(picker.is(".flyout_open")){if(toggle){picker.data("close")()}return false}ref=this.el.find(".color_picker");for(i=0,len=ref.length;i<len;i++){other_picker=ref[i];if(typeof(base=$(other_picker).data("close"))==="function"){base()}}popup=$('<div class="color_popup input_flyout">\n  <div class="close_btn">&times;</div>\n  <div class="farb"></div>\n</div>');input=picker.find("input");preview=picker.find(".color_preview");picker.data("close",function(_this){return function(){popup.removeClass("open");picker.removeClass("flyout_open").removeData("farb");$(document.body).off("click.color_picker");$(window).off("keydown.color_picker");return setTimeout(function(){return popup.remove()},200)}}(this));farb=$.farbtastic(popup.find(".farb"),function(_this){return function(color){return _this.set_picker_color(picker,color)}}(this));picker.data("farb",farb);farb.setColor(input.val());$(document.body).on("click.color_picker",function(_this){return function(e){if($(e.target).closest(".color_picker").length){return}return picker.data("close")()}}(this));$(window).on("keydown.color_picker",function(_this){return function(e){if(e.keyCode===27){return picker.data("close")()}}}(this));picker.append(popup).addClass("flyout_open");return _.defer(function(_this){return function(){return popup.addClass("open")}}(this))};return AppearanceEditor}()}).call(this);(function(){I.libs.react.done(function(){var P,_rdf,a,br,button,c,code,div,em,fieldset,form,fragment,h1,h2,h3,h4,h5,h6,iframe,img,input,label,legend,li,ol,optgroup,option,p,pre,section,select,span,strong,textarea,types,ul,slice=[].slice;_rdf=ReactDOMFactories;div=_rdf.div,span=_rdf.span,a=_rdf.a,br=_rdf.br,p=_rdf.p,ol=_rdf.ol,ul=_rdf.ul,li=_rdf.li,strong=_rdf.strong,em=_rdf.em,img=_rdf.img,form=_rdf.form,label=_rdf.label,input=_rdf.input,textarea=_rdf.textarea,button=_rdf.button,iframe=_rdf.iframe,h1=_rdf.h1,h2=_rdf.h2,h3=_rdf.h3,h4=_rdf.h4,h5=_rdf.h5,h6=_rdf.h6,pre=_rdf.pre,code=_rdf.code,select=_rdf.select,option=_rdf.option,section=_rdf.section,optgroup=_rdf.optgroup,fieldset=_rdf.fieldset,legend=_rdf.legend;fragment=React.createFactory(React.Fragment);if(R.Redactor){return}c=function(_this){return function(){return R.component.apply(R,arguments)}}(this);types=PropTypes;c("Redactor",{pure:true,componentDidMount:function(){var opts;opts=$.extend({minHeight:80,source:false},this.props.redactor_opts);opts.callbacks||(opts.callbacks={});opts.callbacks.change=function(_this){return function(html){var base;if(typeof(base=_this.props).on_change==="function"){base.on_change(html)}if(_this.props.remember_key){_this.set_memory||(_this.set_memory=_.throttle(function(html){return I.store_memory(this.remember_key(),html)},500));return _this.set_memory(html)}}}(this);return I.redactor($(ReactDOM.findDOMNode(this)),opts)},remember_key:function(){return"inputmemory:"+this.props.remember_key},clear_memory:function(){return I.clear_memory(this.remember_key())},get_default_value:function(){var v;if(v=this.props.defaultValue){return v}if(this.props.remember_key){if(v=typeof localStorage!=="undefined"&&localStorage!==null?localStorage.getItem(this.remember_key()):void 0){return v}}},render:function(){return textarea({name:this.props.name,value:this.props.value,defaultValue:this.get_default_value(),placeholder:this.props.placeholder,required:this.props.required,autoFocus:this.props.autofocus})}});c("CSRF",{pure:true,render:function(){return input({type:"hidden",name:"csrf_token",value:$("meta[name=csrf_token]").attr("value")})}});R.DownTickIcon=React.createElement("svg",{className:"svgicon icon_down_tick2",strokeLinecap:"round",stroke:"currentColor",role:"img",version:"1.1",viewBox:"0 0 24 24",strokeWidth:"2",width:"22",height:"22",strokeLinejoin:"round","aria-hidden":true,fill:"none"},React.createElement("polyline",{points:"6 9 12 15 18 9"}));P=R["package"]("Forms");P("TextInputRow",{pure:true,propTypes:{title:types.string,sub:types.any,name:types.string.isRequired,value:types.any},focus:function(){return this.input_ref.current.focus()},get_input_el:function(){return this.input_ref.current},get_value:function(){return this.input_ref.current.value},componentDidMount:function(){var valid_slug_chars;if(this.props.money_input){if(!this.props.currency){throw new Error("missing currency")}I.money_input(this.input_ref.current,{currency:this.props.currency})}if(this.props.slug_input){I.slug_input($(this.input_ref.current))}if(this.props.integer_input){valid_slug_chars=/[0-9]/g;return $(this.input_ref.current).on("keypress",function(_this){return function(e){var char;if(e.keyCode>=32){char=String.fromCharCode(e.keyCode);if(!char.match(valid_slug_chars)){return false}}}}(this))}},render:function(){var inside;inside=[div({className:"label",key:"label"},this.props.title,this.props.sub?span({className:"sub"}," — ",this.props.sub):void 0),input({type:"text",key:"input",name:this.props.name,ref:this.input_ref||(this.input_ref=React.createRef()),value:this.props.value,defaultValue:this.props.defaultValue,onChange:this.props.onChange,onKeyUp:this.props.onKeyUp,onFocus:this.props.onFocus,onBlur:this.props.onBlur,onClick:this.props.onClick,readOnly:this.props.readonly,className:classNames({has_error:this.props.has_error}),required:this.props.required,placeholder:this.props.placeholder,disabled:this.props.disabled,pattern:this.props.pattern}),this.props.error_message?p({key:"error",className:"input_error"},this.props.error_message):void 0];if(!this.props.multi){inside=label({children:inside})}return div({className:classNames("input_row",this.props.className)},inside)}});P("SimpleSelect",{pure:true,propTypes:{options:types.array.isRequired,name:types.string},getInitialState:function(){return{value:this.props.defaultValue?this.props.defaultValue:void 0}},render:function(){var children,current,current_group,push_group,render_current_option;current=this.current_option();render_current_option=this.props.render_current_option;render_current_option||(render_current_option=function(_this){return function(current){return current.short_name||current.name}}(this));children=[];current_group=null;push_group=function(){if(!current_group){return}children.push(optgroup.apply(null,[{label:current_group.label,key:"group-"+children.length}].concat(slice.call(current_group.children))));return current_group=null};this.props.options.map(function(_this){return function(o,idx){var opt;opt=option({key:""+idx,value:o.value},o.name);if(o.group){if((current_group!=null?current_group.label:void 0)!==o.group){push_group()}current_group||(current_group={label:o.group,children:[]});return current_group.children.push(opt)}else{push_group();return children.push(opt)}}}(this));push_group();return this.enclose({className:classNames({focused:this.state.focused,disabled:this.props.disabled,has_value:current!==this.props.options[0]})},div({className:"selected_option"},span({className:"selected_option_name"},render_current_option(current)),R.DownTickIcon),select({disabled:this.props.disabled,value:current.value,name:this.props.name,onFocus:function(_this){return function(e){return _this.setState({focused:true})}}(this),onBlur:function(_this){return function(e){return _this.setState({focused:false})}}(this),onChange:this.on_change,children:children}))},on_change:function(e){var value;value=e.target.value;if(this.props.onChange){if(value===this.props.value){return}return this.props.onChange(value)}else{if(value===this.state.value){return}return this.setState({value:value})}},find_option:function(value){var j,len,opt,ref;ref=this.props.options;for(j=0,len=ref.length;j<len;j++){opt=ref[j];if(opt.value===value){return opt}}},current_option:function(){var current,search_value;search_value=this.props.value||this.state.value;current=search_value!=null?this.find_option(search_value):void 0;return current||this.props.options[0]}});P("Select",{propTypes:{name:types.string.isRequired,value:types.any,options:types.array.isRequired},componentDidMount:function(){var el,opts;if(!this.props.selectize){return}opts=this.props.selectize===true?{}:this.props.selectize;el=$(this.refs.input);el.selectize(opts);if(this.props.onChange){return el.on("change",function(_this){return function(e){return _this.props.onChange(e)}}(this))}},render:function(){return select({ref:"input",name:this.props.name,onChange:this.props.onChange,value:this.props.value,defaultValue:this.props.defaultValue,children:this.props.options.map(function(_this){return function(arg){var label,value;value=arg[0],label=arg[1];return option({key:value,value:value},label||value)}}(this))})}});P("RadioButtons",{propTypes:{name:types.string.isRequired,value:types.any,options:types.array.isRequired},getValue:function(){var j,len,name,ref,ref1,value;ref=this.container().find("input").serializeArray();for(j=0,len=ref.length;j<len;j++){ref1=ref[j],name=ref1.name,value=ref1.value;return value}},render:function(){return ul({className:"radio_list",children:this.props.options.map(function(_this){return function(arg,idx){var input_label,more_opts,sub,value;value=arg[0],input_label=arg[1],sub=arg[2],more_opts=arg[3];return li({key:value!=null?value:idx,className:classNames({disabled:more_opts!=null?more_opts.disabled:void 0})},label({},input($.extend({type:"radio",name:_this.props.name,value:value,defaultChecked:_this.props.defaultValue?value===_this.props.defaultValue:void 0,checked:_this.props.value!=null?value===_this.props.value:void 0,onChange:_this.props.onChange},more_opts)),span({className:"radio_label"},input_label),sub?span({className:"sub"}," — ",sub):void 0))}}(this))})}});P("Slider",{pure:true,propTypes:{min:types.number,max:types.number,value:types.number,onChange:types.func,disabled:types.bool},getInitialState:function(){return{}},on_change:function(value){value=Math.round(value);if(this.props.onChange){if(this.props.value===value){return}return this.props.onChange(value)}else{if(this.state.value===value){return}return this.setState({value:value})}},start_drag:function(start_x,start_y){var move_listener,start_value,up_listener,width;if(this.props.disabled){return}width=this.refs.track.clientWidth;start_value=this.current_value();this.setState({dragging:true});move_listener=function(_this){return function(e){var dx,new_value,x,y;e.preventDefault();if(e.buttons===0){up_listener();return}x=e.pageX;y=e.pageX;dx=x-start_x;new_value=dx/width*(_this.props.max-_this.props.min)+start_value;new_value=Math.min(_this.props.max,Math.max(_this.props.min,new_value));if(new_value!==_this.current_value()){return _this.on_change(new_value)}}}(this);up_listener=function(_this){return function(e){if(e!=null){e.preventDefault()}_this.setState({dragging:false});document.body.removeEventListener("mousemove",move_listener);document.body.removeEventListener("mouseup",up_listener);return delete _this.up_listener}}(this);document.body.addEventListener("mousemove",move_listener);document.body.addEventListener("mouseup",up_listener);return this.up_listener=up_listener},current_value:function(){if("value"in this.state){return this.state.value||this.props.min}else{return this.props.value||this.props.min}},percent:function(){return(this.current_value()-this.props.min)/(this.props.max-this.props.min)},componentWillUnmount:function(){if(this.up_listener){return this.up_listener()}},render:function(){var offset_style;offset_style={left:this.percent()*100+"%"};return this.enclose({className:classNames("slider_input",{disabled:this.props.disabled}),onClick:function(_this){return function(e){var new_value,rect;if(e.target===_this.refs.slider_nub){return}rect=_this.refs.track.getBoundingClientRect();p=Math.min(rect.width,Math.max(0,e.pageX-rect.left))/rect.width;new_value=_this.props.min+p*(_this.props.max-_this.props.min);new_value=Math.min(_this.props.max,Math.max(_this.props.min,new_value));if(new_value!==_this.current_value()){return _this.on_change(new_value)}}}(this)},this.props.name?input({type:"hidden",name:this.props.name,value:this.current_value()}):void 0,div({ref:"track",className:"slider_track"},div({className:"slider_fill",style:{width:this.percent()*100+"%"}}),this.state.focused&&this.props.show_tooltip?div({style:offset_style,className:"value_tooltip"},this.current_value()):void 0,button({type:"button",ref:"slider_nub",className:"slider_nub",onFocus:function(_this){return function(){return _this.setState({focused:true})}}(this),onBlur:function(_this){return function(){return _this.setState({focused:false})}}(this),onMouseDown:function(_this){return function(e){return _this.start_drag(e.pageX,e.pageY)}}(this),onKeyDown:function(_this){return function(e){switch(e.keyCode){case 37:_this.on_change(Math.max(_this.props.min,_this.current_value()-1));break;case 39:_this.on_change(Math.min(_this.props.max,_this.current_value()+1));break;default:return}return e.preventDefault()}}(this),style:offset_style})))}});P("FilterPicker",{pure:true,componentWillUnmount:function(){return $(window).off("click",this.window_click_listener)},getDefaultProps:function(){return{label_padding:3}},getInitialState:function(){return{open:false}},close_picker:function(){if(!this.state.open){return}this.setState({open:false,popup_visible:false});return $(window).off("click",this.window_click_listener)},open_picker:function(){var el,rect;el=this.open_button_ref.current;rect=el.getBoundingClientRect();if(this.window_click_listener){$(window).off("click",this.window_click_listener)}this.window_click_listener=function(_this){return function(e){c=$(e.target).closest(_this.container());if(c.length){return}return _this.close_picker()}}(this);$(window).on("click",this.window_click_listener);return this.setState({open:true,top:-this.props.label_padding,left:-this.props.label_padding,height:rect.height+this.props.label_padding*2},function(_this){return function(){_this.filter_popup_ref.current.focus();return _.defer(function(){if(_this.window_click_listener&&_this.state.open){return _this.setState({popup_visible:true})}})}}(this))},render:function(){return this.enclose({className:classNames("filter_picker_widget",{open:this.state.open,popup_visible:this.state.popup_visible}),onKeyDown:this.state.open?function(_this){return function(e){if(e.keyCode===27){return _this.close_picker()}}}(this):void 0},button({type:"button",className:"filter_value",ref:this.open_button_ref||(this.open_button_ref=React.createRef()),onClick:this.state.open?this.close_picker:this.open_picker},span({className:"value_label"},this.props.label),R.DownTickIcon),div({tabIndex:-1,ref:this.filter_popup_ref||(this.filter_popup_ref=React.createRef()),className:"filter_popup",style:{top:(this.state.top||0)+"px",left:(this.state.left||0)+"px"}},div({style:{marginTop:(this.state.height||0)+"px"},className:"filter_options"},this.props.render_children?this.state.open?this.props.render_children():void 0:this.props.children)))}});P("StarPicker",{getDefaultProps:function(){return{total_stars:5,star_filled:"icon-star",star_empty:"icon-star2"}},getInitialState:function(){return{}},set_value:function(value){if(this.props.set_value){return this.props.set_value(value)}else{return this.setState({value:value})}},render:function(){var display_value,i,ref,ref1,ref2,stars,value;value=(ref=(ref1=(ref2=this.props.value)!=null?ref2:this.state.value)!=null?ref1:this.props.defaultValue)!=null?ref:0;display_value=this.state.preview_value||value;stars=function(){var j,ref3,results;results=[];for(i=j=1,ref3=this.props.total_stars;1<=ref3?j<=ref3:j>=ref3;i=1<=ref3?++j:--j){results.push(function(_this){return function(i){var cls;cls=i>display_value?"star icon "+_this.props.star_empty:"star icon "+_this.props.star_filled;return button({key:"star-"+i,type:"button",title:i+" Star"+(i===1?"":"s"),onMouseEnter:function(){return _this.setState({preview_value:i})},onMouseLeave:function(){return _this.setState({preview_value:null})},onClick:function(){return _this.set_value(i)}},span({className:cls}))}}(this)(i))}return results}.call(this);return this.enclose({className:classNames(this.props.className,{interactive:true,previewing:this.state.preview_value!=null,has_value:value>0})},this.props.name?input({type:"hidden",name:this.props.name,value:value>0?value:""}):void 0,stars)}});P("EditableInput",{getInitialState:function(){return{value:null,edit_value:null}},componentDidUpdate:function(prev_props){var value;value=this.state.value?this.state.value:this.props.value;if(this.props.value===value){return}return this.setState({value:this.props.value,edit_value:null})},confirm_edit:function(){if(!this.state.edit_value){return}return this.setValue(this.state.edit_value)},cancel_edit:function(){return this.setState({edit_value:null})},setValue:function(value){var base;this.setState({value:value,edit_value:null});return typeof(base=this.props).onUpdate==="function"?base.onUpdate(value):void 0},render:function(){var ref;return input({type:(ref=this.props.type)!=null?ref:"text",className:this.props.className,name:this.props.name,title:this.props.title,readOnly:this.props.readonly,required:this.props.required,placeholder:this.props.placeholder,disabled:this.props.disabled,pattern:this.props.pattern,value:this.state.edit_value!==null?this.state.edit_value:this.state.value!==null?this.state.value:this.props.value,onKeyDown:function(_this){return function(e){if(e.keyCode===27){_this.cancel_edit();e.stopPropagation()}if(e.keyCode===13){_this.confirm_edit();return e.stopPropagation()}}}(this),onFocus:function(_this){return function(e){return e.target.select()}}(this),onBlur:function(_this){return function(e){return _this.confirm_edit()}}(this),onChange:function(_this){return function(e){return _this.setState({edit_value:e.target.value})}}(this)})}});P("FocusButton",{pure:true,getInitialState:function(){return{focused:false}},componentWillUnmount:function(){var base;if(this.state.focused){return typeof(base=this.props).on_decrement_focus==="function"?base.on_decrement_focus():void 0}},on_focus:function(){var base;this.setState({focused:true});return typeof(base=this.props).on_increment_focus==="function"?base.on_increment_focus():void 0},on_blur:function(){var base;this.setState({focused:false});return typeof(base=this.props).on_decrement_focus==="function"?base.on_decrement_focus():void 0},render:function(){var props;props=$.extend({onFocus:this.on_focus,onBlur:this.on_blur},this.props);delete props.on_increment_focus;delete props.on_decrement_focus;return button(props)}});P("FormErrors",{pure:true,getDefaultProps:function(){return{animated:true,scroll_into_view:true}},propTypes:{title:types.string,errors:types.array.isRequired},render:function(){var el;el=function(){if(this.props.animated){if(!R.SlideDown){throw new Error("Attempted to render animated errors without R.SlideDown")}return R.SlideDown}else{return section}}.call(this);return el({className:classNames(this.enclosing_class_name(),"form_errors"),role:"alert"},div({ref:this.props.scroll_into_view?function(el){if(el){return typeof el.scrollIntoView==="function"?el.scrollIntoView():void 0}}:void 0},p({},strong({},this.props.title||this.tt("misc.forms.form_errors"))),ul({},this.props.errors.map(function(_this){return function(e){var text;text=e==="recaptcha"?"Please complete the CAPTCHA to continue":e;return li({key:e},text)}}(this))),this.props.children))}});P("RecaptchaInput",{propTypes:{sitekey:types.string.isRequired},componentDidMount:function(){return I.with_recaptcha(function(_this){return function(){var el;I.event("recaptcha","show",I.page_name());el=ReactDOM.findDOMNode(_this);return grecaptcha.render(el,{sitekey:_this.props.sitekey})}}(this))},render:function(){return div({className:"g-recaptcha"})}})})}).call(this);(function(){I.libs.react.done(function(){var P,_rdf,a,br,button,code,div,em,fieldset,form,fragment,h1,h2,h3,h4,h5,h6,iframe,img,input,label,legend,li,ol,optgroup,option,p,pre,ref,section,select,span,strong,textarea,types,ul;_rdf=ReactDOMFactories;div=_rdf.div,span=_rdf.span,a=_rdf.a,br=_rdf.br,p=_rdf.p,ol=_rdf.ol,ul=_rdf.ul,li=_rdf.li,strong=_rdf.strong,em=_rdf.em,img=_rdf.img,form=_rdf.form,label=_rdf.label,input=_rdf.input,textarea=_rdf.textarea,button=_rdf.button,iframe=_rdf.iframe,h1=_rdf.h1,h2=_rdf.h2,h3=_rdf.h3,h4=_rdf.h4,h5=_rdf.h5,h6=_rdf.h6,pre=_rdf.pre,code=_rdf.code,select=_rdf.select,option=_rdf.option,section=_rdf.section,optgroup=_rdf.optgroup,fieldset=_rdf.fieldset,legend=_rdf.legend;fragment=React.createFactory(React.Fragment);if((ref=R.Forms)!=null?ref.ColorWheel:void 0){return}P=R["package"]("Forms");types=PropTypes;P("PortalElement",{getInitialState:function(){this.el=document.createElement("div");$(this.el).addClass("portal_element");return{}},componentDidMount:function(){return this.props.container_el.appendChild(this.el)},componentWillUnmount:function(){return this.props.container_el.removeChild(this.el)},render:function(){return ReactDOM.createPortal(this.props.children,this.el)}});P("ColorWheel",{render:function(){var h,l,rad,ref1,ref2,ref3,s,x,y;if(((ref1=this.state)!=null?ref1.color:void 0)&&!this.props.onChange){ref2=this.state.color,h=ref2[0],s=ref2[1],l=ref2[2]}else if(this.props.color){ref3=this.props.color,h=ref3[0],s=ref3[1],l=ref3[2]}if(h==null){h=0}if(s==null){s=50}if(l==null){l=100}rad=(h-90)/180*Math.PI;x=Math.cos(rad);y=Math.sin(rad);return this.enclose({},div({className:"color_block",style:{background:"hsl("+h+", 100%, 50%)",width:"101px",height:"101px"}}),div({className:"wheel",style:{width:"195px",height:"195px"},onMouseDown:function(_this){return function(event){event.preventDefault();return _this.start_drag(event,event.target,function(px,py){var deg,new_h;x=(px-.5)*2;y=(py-.5)*2;deg=Math.atan2(y,x)/Math.PI*180;new_h=(deg+360+90)%360;return _this.update_color(new_h,s,l)})}}(this)}),div({className:"mask",style:{width:"101px",height:"101px"},onMouseDown:function(_this){return function(event){event.preventDefault();return _this.start_drag(event,event.target,function(px,py){var new_l,new_s;new_s=(1-px)*100;new_l=(1-py)*100;return _this.update_color(h,new_s,new_l)})}}(this)}),div({className:"marker h-marker",style:{left:97+x*84+"px",top:97+y*84+"px"}}),div({className:"marker sl-marker",style:{left:47+101*(100-s)/100+"px",top:47+101*(100-l)/100+"px"}}))},set_hex_color:function(color){var b,g,r,ref1;try{ref1=I.Color.parse_color(color),r=ref1[0],g=ref1[1],b=ref1[2];return this.setState({color:I.Color.rgb_to_hsl(r,g,b)})}catch(error){}},update_color:function(h,s,l){if(this.props.onChange!=null){return this.props.onChange([h,s,l])}else{return this.setState({color:[h,s,l]})}},start_drag:function(original_event,el,callback){var move_listener,ref1,up_listener;if((ref1=this.state)!=null?ref1.dragging:void 0){return}this.setState({dragging:true});move_listener=function(e){var px,py,rect,x,y;e.preventDefault();if(e.buttons===0){up_listener();return}rect=el.getBoundingClientRect();x=e.clientX;y=e.clientY;px=(x-rect.left)/(rect.right-rect.left);py=(y-rect.top)/(rect.bottom-rect.top);px=Math.min(1,Math.max(0,px));py=Math.min(1,Math.max(0,py));return typeof callback==="function"?callback(px,py):void 0};up_listener=function(_this){return function(e){if(e!=null){e.preventDefault()}document.body.removeEventListener("mousemove",move_listener);document.body.removeEventListener("mouseup",up_listener);delete _this.up_listener;return _this.setState({dragging:false})}}(this);document.body.addEventListener("mousemove",move_listener);document.body.addEventListener("mouseup",up_listener);move_listener(original_event);return this.up_listener=up_listener}});P("ColorInputPopup",{palette:["#193d3f","#3f2832","#743f39","#9e2835","#b86f50","#327345","#e53b44","#4f6781","#0484d1","#fb922b","#afbfd2","#63c64d","#e4a672","#2ce8f4","#ffe762"],set_wheel_color:function(color){var b,g,r,ref1;try{ref1=I.Color.parse_color(color),r=ref1[0],g=ref1[1],b=ref1[2];return this.setState({wheel_color:I.Color.rgb_to_hsl(r,g,b)})}catch(error){}},componentDidMount:function(){var ref1;if(!((ref1=this.state)!=null?ref1.wheel_color:void 0)&&this.props.color){return this.set_wheel_color(this.props.color)}},render:function(){var palette,pos,ref1,style;this.wheel_ref||(this.wheel_ref=React.createRef());palette=this.props.palette||this.palette;if(pos=this.props.position){style={left:pos.left+"px",top:pos.top+"px"}}return this.enclose({className:"color_popout",style:style},this.props.allow_empty&&this.props.color?button({type:"button",className:"clear_color_btn",onClick:function(_this){return function(){var base;return typeof(base=_this.props).set_color==="function"?base.set_color(""):void 0}}(this)},"Clear"):void 0,R.Forms.ColorWheel({ref:this.wheel_ref,color:(ref1=this.state)!=null?ref1.wheel_color:void 0,onChange:function(_this){return function(color){var base,ref2,ref3;if(typeof(base=_this.props).set_color==="function"){base.set_color((ref3=I.Color).hex_color.apply(ref3,(ref2=I.Color).hsl_to_rgb.apply(ref2,color)))}return _this.setState({wheel_color:color})}}(this)}),palette?div({className:"palette_options"},palette.map(function(_this){return function(color){return button({key:color,type:"button",style:{backgroundColor:color},onClick:function(e){var base;if(typeof(base=_this.props).set_color==="function"){base.set_color(color)}return _this.set_wheel_color(color)}},color)}}(this))):void 0)}});P("ColorInput",{pure:true,propTypes:{name:types.string,value:types.any,defaultValue:types.any,allow_empty:types.bool,popout_portal_target:types.object},componentDidMount:function(){var base;(base=R.Forms.ColorInput).active_inputs||(base.active_inputs=[]);return R.Forms.ColorInput.active_inputs.push(this)},componentWillUnmount:function(){var c;return R.Forms.ColorInput.active_inputs=function(){var i,len,ref1,results;ref1=R.Forms.ColorInput.active_inputs;results=[];for(i=0,len=ref1.length;i<len;i++){c=ref1[i];if(c!==this){results.push(c)}}return results}.call(this)},componentDidUpdate:function(prev_props,prev_state){var c,current_value,new_value;current_value=prev_props.value||"";new_value=this.props.value||"";if(current_value!==new_value){if(c=this.set_color(new_value)){return this.refs.input.value=c}}},getInitialState:function(){return{open:false,last_value:this.props.value||this.props.defaultValue||""}},on_blur:function(){if(!this.set_color_from_input()){this.input_ref.current.value=this.state.last_value;return this.set_color(this.state.last_value)}},set_color_from_input:function(){var c,input_value,ref1;input_value=this.input_ref.current.value;if(input_value===""&&this.props.allow_empty){this.setState({has_error:false,last_value:""});return true}if(input_value!==""&&!input_value.match("^#")){input_value="#"+input_value;this.input_ref.current.value=input_value}c=I.Color.parse_color(input_value);if(c){this.set_color(input_value);if((ref1=this.popout_ref.current)!=null){ref1.set_wheel_color(input_value)}return true}else{this.setState({has_error:true});return false}},set_color:function(color){var base;this.input_ref.current.value=color;this.setState({last_value:color,has_error:false});return typeof(base=this.props).onChange==="function"?base.onChange(color):void 0},open:function(){if(this.state.open){return}this.setState({open:true,on_left:this.popout_on_left(),popout_position:this.popout_position()});this.click_outside_handler||(this.click_outside_handler=function(_this){return function(e){var el,popout,self;self=ReactDOM.findDOMNode(_this);if($(e.target).closest(self).length){return}if(popout=_this.popout_ref.current){el=ReactDOM.findDOMNode(popout);if($(e.target).closest(el).length){return}}return _this.close()}}(this));return $(document.body).on("mousedown",this.click_outside_handler)},componentWillUnmount:function(){if(this.click_outside_handler){return $(document.body).off("mousedown",this.click_outside_handler)}},close:function(){if(!this.state.open){return}this.setState({open:false});return $("document.body").off("mousedown",this.click_outside_handler)},popout_position:function(){var el,rect;if(!this.props.popout_portal_target){return}el=ReactDOM.findDOMNode(this);rect=el.getBoundingClientRect();return{left:Math.trunc(rect.right+window.scrollX),top:Math.trunc(rect.top+window.scrollY)}},popout_on_left:function(){var el,popout_right;el=$(ReactDOM.findDOMNode(this));popout_right=el.offset().left+el.width()+250;return popout_right>$(window).width()+$(window).scrollLeft()},render_color_popout:function(){var el,popout;this.popout_ref||(this.popout_ref=React.createRef());popout=R.Forms.ColorInputPopup({ref:this.popout_ref,palette:this.props.palette,color:this.state.last_value,allow_empty:this.props.allow_empty,set_color:this.set_color,position:this.state.popout_position});if(el=this.props.popout_portal_target){popout=P.PortalElement({container_el:el},popout)}return popout},render:function(){var current_color;current_color=this.state.last_value||"#ffffff";this.input_ref||(this.input_ref=React.createRef());return this.enclose({className:classNames(this.props.className,{picker_open:this.state.open,picker_left:this.state.on_left,color_error:this.state.has_error})},input({ref:this.input_ref,type:"text",className:"color_text_input",name:this.props.name,defaultValue:this.props.value||this.props.defaultValue,placeholder:this.props.defaultValue||"Color",onBlur:this.on_blur,onFocus:this.open,onKeyDown:function(_this){return function(e){switch(e.keyCode){case 9:return _this.close()}}}(this),onKeyUp:function(_this){return function(e){return _this.set_color_from_input()}}(this)}),div({className:"color_swatch",onClick:this.open,style:{backgroundColor:current_color}}),this.state.open?this.render_color_popout():void 0)}})})}).call(this);(function(){I.libs.react.done(function(){var P,PATTERNS,_rdf,a,br,button,code,create_line_icon,div,em,fieldset,form,fragment,h1,h2,h3,h4,h5,h6,iframe,img,input,label,legend,li,line,ol,optgroup,option,p,path,pre,rect,section,select,span,strong,table,tbody,td,textarea,tr,types,ul,slice=[].slice,hasProp={}.hasOwnProperty;_rdf=ReactDOMFactories;div=_rdf.div,span=_rdf.span,a=_rdf.a,br=_rdf.br,p=_rdf.p,ol=_rdf.ol,ul=_rdf.ul,li=_rdf.li,strong=_rdf.strong,em=_rdf.em,img=_rdf.img,form=_rdf.form,label=_rdf.label,input=_rdf.input,textarea=_rdf.textarea,button=_rdf.button,iframe=_rdf.iframe,h1=_rdf.h1,h2=_rdf.h2,h3=_rdf.h3,h4=_rdf.h4,h5=_rdf.h5,h6=_rdf.h6,pre=_rdf.pre,code=_rdf.code,select=_rdf.select,option=_rdf.option,section=_rdf.section,optgroup=_rdf.optgroup,fieldset=_rdf.fieldset,legend=_rdf.legend;fragment=React.createFactory(React.Fragment);P=R["package"]("Forms");types=PropTypes;table=ReactDOMFactories.table,tbody=ReactDOMFactories.tbody,tr=ReactDOMFactories.tr,td=ReactDOMFactories.td;P("MarkdownInput",{pure:true,propTypes:{name:types.string,value:types.string},getDefaultProps:function(){return{max_default_height:400}},componentWillUnmount:function(){return this.unmounted=true},componentDidMount:function(){var inner_height,total_height;total_height=this.input_ref.current.scrollHeight;inner_height=this.input_ref.current.clientHeight;if(total_height>inner_height){this.setState({default_height:Math.min(total_height,this.props.max_default_height)})}if(this.props.autofocus){return _.defer(function(_this){return function(){var ref;return(ref=_this.input_ref.current)!=null?ref.focus():void 0}}(this))}},get_value:function(){var ref;return(ref=this.input_ref.current)!=null?ref.value:void 0},set_value:function(value){return this.input_ref.current.value=value},click_bold_text:function(e){return this.wrap_selection("**","**")},click_italic_text:function(e){return this.wrap_selection("*","*")},click_insert_link:function(e){var input_el,select_end,t;t=this.get_selected_text();input_el=this.input_ref.current;if(t.match(/^https?:\/\/[^\s]+$/)){this.wrap_selection("[](",")");input_el.selectionStart=input_el.selectionStart-"](".length;return input_el.selectionEnd=input_el.selectionStart}else{this.wrap_selection("[","](url)");if(t.length>0){select_end=input_el.selectionEnd;input_el.selectionStart=select_end+"](".length;return input_el.selectionEnd=select_end+"](url".length}}},click_insert_video:function(e){return I.Lightbox.open(P.MarkdownVideoEmbedLightbox({on_submit:function(_this){return function(embed_code){return _this.insert_line(embed_code)}}(this)}))},click_insert_image:function(e){return I.Lightbox.open_remote(I.root_url("dashboard/upload-image"),I.PickImageLightbox,function(_this){return function(image_url){var input_el;I.Lightbox.close();if(_this.unmounted){return}if(input_el=_this.input_ref.current){return _this.insert_line("![]("+image_url+")")}}}(this))},click_show_help:function(e){return I.Lightbox.open(P.MarkdownHelpLightbox({}))},get_selected_text:function(){var input_el;if(input_el=this.input_ref.current){return input_el.value.substring(input_el.selectionStart,input_el.selectionEnd)}else{return""}},wrap_selection:function(left,right){var input_el,inserted,replacement,select_end,select_start,text_after,text_before,text_selected,value;input_el=this.input_ref.current;select_start=input_el.selectionStart;select_end=input_el.selectionEnd;value=input_el.value;text_before=value.substring(0,input_el.selectionStart);text_after=value.substring(input_el.selectionEnd,value.length);text_selected=value.substring(input_el.selectionStart,input_el.selectionEnd);input_el.focus();replacement=""+left+(text_selected||"")+right;inserted=document.execCommand("insertText",false,replacement);if(!inserted){if(typeof input_el.setRangeText==="function"){input_el.setRangeText(replacement)}}input_el.selectionStart=select_start+left.length;return input_el.selectionEnd=select_end+left.length},insert_line:function(text){var input_el,inserted;input_el=this.input_ref.current;input_el.focus();inserted=document.execCommand("insertText",false,text);if(!inserted){if(typeof input_el.setRangeText==="function"){input_el.setRangeText(text)}input_el.selectionStart=input_el.selectionStart+text.length;return input_el.selectionEnd=input_el.selectionEnd}},on_hotkey_keydown:function(e){var base;if(!(e.metaKey||e.ctrlKey)){return}switch(e.key){case"b":this.click_bold_text(e);break;case"i":this.click_italic_text(e);break;case"k":this.click_insert_link(e);break;case"Enter":if(typeof(base=this.props).on_submit_hotkey==="function"){base.on_submit_hotkey()}break;default:return}return e.preventDefault()},render:function(){var ref;return this.enclose({},ul({className:"markdown_toolbar"},li({},button({tabIndex:-1,type:"button",onClick:this.click_show_help,title:"Markdown Help"},R.Icons.Markdown)),li({},button({tabIndex:-1,type:"button",onClick:this.click_bold_text,title:"Bold"},R.Icons.FormatBold)),li({},button({tabIndex:-1,type:"button",onClick:this.click_italic_text,title:"Italic"},R.Icons.FormatItalic)),li({},button({tabIndex:-1,type:"button",title:"Insert link",onClick:this.click_insert_link},R.Icons.InsertLink)),li({},button({tabIndex:-1,type:"button",title:"Insert image",onClick:this.click_insert_image},R.Icons.InsertImage)),li({},button({tabIndex:-1,type:"button",title:"Insert video",onClick:this.click_insert_video},R.Icons.InsertVideo))),textarea({name:this.props.name,ref:this.input_ref||(this.input_ref=React.createRef()),defaultValue:this.get_default_value(),className:"markdown_textarea",onKeyDown:this.on_hotkey_keydown,placeholder:this.props.placeholder,required:this.props.required,style:((ref=this.state)!=null?ref.default_height:void 0)?{height:this.state.default_height+"px"}:void 0,onChange:function(_this){return function(e){var base,value;value=e.target.value;if(typeof(base=_this.props).on_change==="function"){base.on_change(value)}if(_this.props.remember_key){_this.set_memory||(_this.set_memory=_.throttle(function(value){return I.store_memory(this.remember_key(),value)},500));return _this.set_memory(value)}}}(this)}))},get_default_value:function(){var v;if(v=this.props.value||this.props.defaultValue){return v}if(this.props.remember_key){if(v=typeof localStorage!=="undefined"&&localStorage!==null?localStorage.getItem(this.remember_key()):void 0){return v}}},remember_key:function(){return"inputmemory:"+this.props.remember_key},clear_memory:function(){return I.clear_memory(this.remember_key())}});R.Icons||(R.Icons={});path=ReactDOMFactories.path,line=ReactDOMFactories.line,rect=ReactDOMFactories.rect;R.Icons.Markdown=React.createElement("svg",{className:classNames("svgicon markdown_icon"),role:"img",version:"1.1",viewBox:"0 0 208 128",fill:"currentColor"},path({d:"M193 128H15a15 15 0 0 1-15-15V15A15 15 0 0 1 15 0h178a15 15 0 0 1 15 15v98a15 15 0 0 1-15 15zM50 98V59l20 25 20-25v39h20V30H90L70 55 50 30H30v68zm134-34h-20V30h-20v34h-20l30 35z"}));create_line_icon=function(){var contents,props,ref;props=arguments[0],contents=2<=arguments.length?slice.call(arguments,1):[];return React.createElement.apply(React,["svg",{className:classNames("svgicon",props.className),role:"img",version:"1.1",viewBox:"0 0 24 24",width:"24",height:"24",fill:(ref=props!=null?props.fill:void 0)!=null?ref:"none",stroke:"currentColor",strokeWidth:"3",strokeLinejoin:"round","aria-hidden":true}].concat(slice.call(contents)))};R.Icons.FormatBold=create_line_icon({className:"icon_format_bold"},path({d:"M6 4h8a4 4 0 0 1 4 4 4 4 0 0 1-4 4H6z"}),path({d:"M6 12h9a4 4 0 0 1 4 4 4 4 0 0 1-4 4H6z"}));R.Icons.FormatItalic=create_line_icon({className:"icon_format_italic"},line({x1:"19",y1:"4",x2:"10",y2:"4"}),line({x1:"14",y1:"20",x2:"5",y2:"20"}),line({x1:"15",y1:"4",x2:"9",y2:"20"}));R.Icons.InsertLink=create_line_icon({className:"icon_insert_link"},path({d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"}),path({d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"}));R.Icons.InsertImage=create_line_icon({className:"icon_insert_image"},rect({x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"}),React.createElement("circle",{cx:"8.5",cy:"8.5",r:"1.5"}),React.createElement("polyline",{points:"21 15 16 10 5 21"}));R.Icons.InsertVideo=create_line_icon({className:"icon_insert_video"},path({d:"M22.54 6.42a2.78 2.78 0 0 0-1.94-2C18.88 4 12 4 12 4s-6.88 0-8.6.46a2.78 2.78 0 0 0-1.94 2A29 29 0 0 0 1 11.75a29 29 0 0 0 .46 5.33A2.78 2.78 0 0 0 3.4 19c1.72.46 8.6.46 8.6.46s6.88 0 8.6-.46a2.78 2.78 0 0 0 1.94-2 29 29 0 0 0 .46-5.25 29 29 0 0 0-.46-5.33z"}),React.createElement("polygon",{points:"9.75 15.02 15.5 11.75 9.75 8.48 9.75 15.02"}));PATTERNS={youtube:/https?:\/\/(?:[0-9A-Z-]+\.)?(?:youtu\.be\/|youtube(?:\-nocookie)?\.com\S*[^\w\-\s])([\w\-]{11})(?=[^\w\-]|$)(?![?=&+%\w.\-]*(?:['"][^<>]*>|<\/a>))[?=&+%\w.-]*/gi,vimeo:/https?:\/\/(www\.)?vimeo.com\/(\d+)($|\/)/,sketchfab_old:/https?:\/\/(?:www\.)?sketchfab\.com\/models\/([\w]+)($|\/)/,sketchfab:/https?:\/\/(?:www\.)?sketchfab\.com\/3d-models\/.*?-([^-]+)$/};P("MarkdownVideoEmbedLightbox",{pure:true,getInitialState:function(){return{is_valid:false}},componentDidMount:function(){return _.defer(function(_this){return function(){var ref;return(ref=_this.input_ref.current)!=null?ref.focus():void 0}}(this))},generate_youtube_embed_code:function(video_id){return'<iframe width="560" height="315" src="https://www.youtube.com/embed/'+video_id+'" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>'},generate_vimeo_embed_code:function(video_id){return'<iframe src="https://player.vimeo.com/video/'+video_id+'" width="560" height="315" frameborder="0" allow="autoplay; fullscreen" allowfullscreen></iframe>'},generate_sketchfab_embed_code:function(model_id){return'<iframe width="560" height="315" src="https://sketchfab.com/models/'+model_id+'/embed" frameborder="0" allow="autoplay; fullscreen; vr" mozallowfullscreen="true" webkitallowfullscreen="true"></iframe>'},parse_input_value:function(){var m,pattern,ref,res,type,value,video_id;value=$.trim(((ref=this.input_ref.current)!=null?ref.value:void 0)||"");if(value.match(/<iframe/i)){return value}for(type in PATTERNS){if(!hasProp.call(PATTERNS,type))continue;pattern=PATTERNS[type];m=value.match(pattern);if(!m){continue}switch(type){case"youtube":video_id=(res=m[0].match(/v=([^>"'&]+)/))?res[1]:(res=m[0].match(/embed\/([^>"'&\/]+)/))?res[1]:void 0;if(video_id){return this.generate_youtube_embed_code(video_id)}break;case"vimeo":if(video_id=m[2]){return this.generate_vimeo_embed_code(video_id)}break;case"sketchfab":case"sketchfab_old":if(video_id=m[1]){return this.generate_sketchfab_embed_code(video_id)}break;default:console.log(type,m)}}},render:function(){return R.Lightbox({className:classNames(this.enclosing_class_name(),"compact")},h2({},"Embed Video"),form({className:"form",onSubmit:this.on_submit||(this.on_submit=function(_this){return function(e){var base;e.preventDefault();if(!(_this.state.is_valid&&_this.state.embed_code)){return}if(typeof(base=_this.props).on_submit==="function"){base.on_submit(_this.state.embed_code)}return I.Lightbox.close()}}(this))},div({className:"label"},"Youtube/Vimeo/Sketchfab URL or ",code({},"<iframe>")," embed code"),div({className:"input_split"},input({type:"text",required:"required",placeholder:"Please paste a valid URL or embed code",ref:this.input_ref||(this.input_ref=React.createRef()),onChange:this.on_change||function(_this){return function(e){var embed_code;embed_code=_this.parse_input_value();return _this.setState({embed_code:embed_code,is_valid:!!embed_code})}}(this)})," ",button({disabled:!this.state.is_valid,className:classNames("button",{disabled:!this.state.is_valid})},"Insert"))))}});P("MarkdownHelpLightbox",{pure:true,render:function(){var pair;pair=function(){var left,rest;left=arguments[0],rest=2<=arguments.length?slice.call(arguments,1):[];return tr({},td({className:"format_type"},left),td.apply(null,[{className:"format_example"}].concat(slice.call(rest))))};return R.Lightbox({className:classNames(this.enclosing_class_name(),"compact")},h2({},"Quick Markdown Guide"),p({},"Markdown is a writing format that converts into HTML."),div({className:"table_wrapper"},table({className:"nice_table"},tbody({},pair("Bold","**Bolded text here**"),pair("Italic","*Emphasized text here*"),pair("Bullet list","* First item",br({}),"* Second item"),pair("Link","[Linked text](http://example.com)"),pair("Blockquote","> Quoted text here",br({}),"> Can span multiple lines"),pair("Code","```",br({}),'print("Hello world")',br({}),"```"),pair("Video embeds",em({},"Paste embed code directly"))))),p({},a({href:"https://commonmark.org/help/",target:"_blank"},"Extended tutorial ↗"),". You can also use a subset of HTML directly for advanced formatting."))}})})}).call(this);(function(){I.libs.react.done(function(){var P,_rdf,a,br,button,code,counter,div,em,fieldset,form,fragment,h1,h2,h3,h4,h5,h6,iframe,img,input,label,legend,li,ol,optgroup,option,p,pre,section,select,span,strong,textarea,types,ul;_rdf=ReactDOMFactories;div=_rdf.div,span=_rdf.span,a=_rdf.a,br=_rdf.br,p=_rdf.p,ol=_rdf.ol,ul=_rdf.ul,li=_rdf.li,strong=_rdf.strong,em=_rdf.em,img=_rdf.img,form=_rdf.form,label=_rdf.label,input=_rdf.input,textarea=_rdf.textarea,button=_rdf.button,iframe=_rdf.iframe,h1=_rdf.h1,h2=_rdf.h2,h3=_rdf.h3,h4=_rdf.h4,h5=_rdf.h5,h6=_rdf.h6,pre=_rdf.pre,code=_rdf.code,select=_rdf.select,option=_rdf.option,section=_rdf.section,optgroup=_rdf.optgroup,fieldset=_rdf.fieldset,legend=_rdf.legend;fragment=React.createFactory(React.Fragment);P=R["package"]("Forms");types=PropTypes;counter=0;P("Image",{pure:true,getInitialState:function(){return{loaded:false}},render:function(){return img({className:classNames(this.enclosing_class_name(),this.props.className,{image_loading:!this.state.loaded}),src:this.props.src,onLoad:function(_this){return function(){var base;_this.setState({loaded:true});return typeof(base=_this.props).on_load==="function"?base.on_load():void 0}}(this)})}});P("Video",{pure:true,render:function(){return React.createElement("video",{width:200,loop:true,muted:true,autoPlay:true,src:this.props.src})}});P("ImageUploader",{pure:true,propTypes:{upload_url:types.string.isRequired,name:types.string.isRequired,thumb_size:types.string,label:types.string,upload:types.object,show_replace:types.bool},getDefaultProps:function(){return{remove_button_classes:["button","outline","small"],replace_button_classes:["button","outline","small"],upload_button_classes:"button"}},getInitialState:function(){return{uploads:this.props.upload?[this.props.upload]:this.props.uploads}},componentDidMount:function(){return this.dispatch({remove_image:function(_this){return function(e,upload_idx){var base,to_remove,upload;to_remove=_this.state.uploads[upload_idx];_this.setState({uploads:function(){var i,len,ref,results;ref=this.state.uploads;results=[];for(i=0,len=ref.length;i<len;i++){upload=ref[i];if(upload!==to_remove){results.push(upload)}}return results}.call(_this)});if(!_this.props.multiple){return typeof(base=_this.props).on_upload==="function"?base.on_upload(null):void 0}}}(this),pick_image:function(_this){return function(e,image_uploading_fn){var completed_uploads,mark_uploads_complete;completed_uploads={};mark_uploads_complete=function(uploads){var base,i,len,newly_completed,upload;newly_completed=function(){var i,len,results;results=[];for(i=0,len=uploads.length;i<len;i++){upload=uploads[i];if(completed_uploads[upload.id]){continue}completed_uploads[upload.id]=true;results.push(upload)}return results}();if(!newly_completed.length){return}for(i=0,len=newly_completed.length;i<len;i++){upload=newly_completed[i];if(typeof(base=_this.props).on_upload==="function"){base.on_upload(upload)}}return _this.setState({uploads:(_this.state.uploads||[]).concat(newly_completed)})};return I.upload_image({url:_this.props.upload_url,accept:_this.props.accept,thumb_size:_this.props.thumb_size,multiple:_this.props.multiple,max_size:_this.props.max_size,on_start_upload:function(){if(!_this.state.uploading){_this.setState({uploading:true})}return typeof image_uploading_fn==="function"?image_uploading_fn.apply(null,arguments):void 0}}).progress(function(event,sent,total){var args,i,len,percents,prog,res,uploads;percents=[];uploads=[];args=typeof arguments[0]==="string"?[arguments]:arguments;for(i=0,len=args.length;i<len;i++){prog=args[i];if(!prog){continue}switch(prog[0]){case"progress":event=prog[0],sent=prog[1],total=prog[2];percents.push(sent/total);break;case"upload_saved":res=prog[1];if(res.errors){continue}uploads.push(res.upload)}}if(percents.length){_this.setState({progress:Math.min.apply(Math,percents)})}return mark_uploads_complete(uploads)}).fail(function(err){console.error("upload failed",err);return _this.setState({uploading:false,upload_error:true,errors:[err]})}).done(function(res){if(res.upload){mark_uploads_complete([res.upload])}if(res.errors){_this.setState({uploading:false,upload_error:true,errors:res.errors});return}return _this.setState({uploading:false})})}}(this)})},render_existing_upload:function(upload,idx){var input_name;input_name=this.props.multiple?this.props.name+"["+(idx+1)+"]":this.props.name;return div({className:"existing_upload",key:upload.id},input({type:"hidden",name:input_name,value:upload.id}),upload.thumb_url?div({className:"preview_image"},upload.thumb_url.match(/\.mp4$/)?P.Video({src:upload.thumb_url}):P.Image({src:upload.thumb_url})):void 0,this.props.children,div({className:"existing_upload_tools"},this.props.show_replace?button({className:classNames("replace_image_btn",this.props.replace_button_classes),type:"button",onClick:function(_this){return function(e){e.preventDefault();return _this.trigger("pick_image",function(){return _this.trigger("remove_image",idx)})}}(this)},"Replace image"):void 0,button({className:classNames("remove_image_btn",this.props.remove_button_classes),type:"button",onClick:function(_this){return function(e){e.preventDefault();return _this.trigger("remove_image",idx)}}(this)},"Remove image")))},render:function(){var have_uploads,ref,ref1,ref2,ref3;this.autogen_id="image-uploader-"+counter++;have_uploads=!!((ref=this.state.uploads)!=null?ref.length:void 0);return this.enclose({className:classNames(this.props.className,{no_upload:!have_uploads,have_upload:!!have_uploads})},this.props.label?label({className:"label",htmlFor:this.autogen_id},this.props.label):void 0,this.state.errors?R.Forms.FormErrors({errors:this.state.errors,title:"Upload failed",animated:false,scroll_into_view:false}):void 0,!(this.props.multiple||((ref1=this.state.uploads)!=null?ref1.length:void 0))?input({type:"hidden",name:this.props.name,value:""}):void 0,this.state.uploading?div({className:"upload_progress"},"Uploading "+((this.state.progress||0)*100).toFixed(2)+"%"):void 0,this.props.multiple||!((ref2=this.state.uploads)!=null?ref2.length:void 0)?button({id:this.autogen_id,disabled:!!this.state.uploading,className:classNames(this.props.upload_button_classes,{small:this.props.compact,disabled:!!this.state.uploading}),type:"button",onClick:function(_this){return function(e){e.preventDefault();return _this.trigger("pick_image")}}(this)},this.props.upload_label||(this.props.multiple?"Upload images":"Upload image")):void 0,((ref3=this.state.uploads)!=null?ref3.length:void 0)?div({className:"existing_uploads",children:this.state.uploads.map(this.render_existing_upload)}):void 0)}})})}).call(this);(function(){I.libs.react.done(function(){var _rdf,a,br,button,code,div,em,fieldset,form,fragment,h1,h2,h3,h4,h5,h6,iframe,img,input,label,legend,li,ol,optgroup,option,p,pre,section,select,span,strong,textarea,ul;_rdf=ReactDOMFactories;div=_rdf.div,span=_rdf.span,a=_rdf.a,br=_rdf.br,p=_rdf.p,ol=_rdf.ol,ul=_rdf.ul,li=_rdf.li,strong=_rdf.strong,em=_rdf.em,img=_rdf.img,form=_rdf.form,label=_rdf.label,input=_rdf.input,textarea=_rdf.textarea,button=_rdf.button,iframe=_rdf.iframe,h1=_rdf.h1,h2=_rdf.h2,h3=_rdf.h3,h4=_rdf.h4,h5=_rdf.h5,h6=_rdf.h6,pre=_rdf.pre,code=_rdf.code,select=_rdf.select,option=_rdf.option,section=_rdf.section,optgroup=_rdf.optgroup,fieldset=_rdf.fieldset,legend=_rdf.legend;fragment=React.createFactory(React.Fragment);R.Icons||(R.Icons={});R.Icons.Close=function(props){var height,ref,ref1,width;if(props==null){props={}}width=(ref=props.width)!=null?ref:24;height=(ref1=props.height)!=null?ref1:width;return React.createElement("svg",{className:"svgicon icon_close",strokeLinecap:"round",stroke:"currentColor",role:"img",version:"1.1",viewBox:"0 0 24 24",strokeWidth:"2",width:width,height:height,strokeLinejoin:"round","aria-hidden":true,fill:"none"},React.createElement("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),React.createElement("line",{x1:"6",y1:"6",x2:"18",y2:"18"}))};R.component("Lightbox",{render:function(){return div({className:classNames("lightbox",this.props.className),style:this.props.style},this.props.close!==false?button({className:"close_button",type:"button"},R.Icons.Close({width:18})):void 0,this.props.children)}})})}).call(this);(function(){I.libs.react.done(function(){var _rdf,a,br,button,code,div,em,fieldset,form,fragment,h1,h2,h3,h4,h5,h6,iframe,img,input,label,legend,li,ol,optgroup,option,p,pre,section,select,span,strong,textarea,ul;_rdf=ReactDOMFactories;div=_rdf.div,span=_rdf.span,a=_rdf.a,br=_rdf.br,p=_rdf.p,ol=_rdf.ol,ul=_rdf.ul,li=_rdf.li,strong=_rdf.strong,em=_rdf.em,img=_rdf.img,form=_rdf.form,label=_rdf.label,input=_rdf.input,textarea=_rdf.textarea,button=_rdf.button,iframe=_rdf.iframe,h1=_rdf.h1,h2=_rdf.h2,h3=_rdf.h3,h4=_rdf.h4,h5=_rdf.h5,h6=_rdf.h6,pre=_rdf.pre,code=_rdf.code,select=_rdf.select,option=_rdf.option,section=_rdf.section,optgroup=_rdf.optgroup,fieldset=_rdf.fieldset,legend=_rdf.legend;fragment=React.createFactory(React.Fragment);R.component("SlideDown",{getInitialState:function(){return{}},getDefaultProps:function(){return{duration:200,delay:1}},componentDidMount:function(){var el;el=ReactDOM.findDOMNode(this);return this.timer=window.setTimeout(function(_this){return function(){_this.setState({height:el.scrollHeight||false});_this.timer=window.setTimeout(function(){return _this.setState({animated:true})},_this.props.duration+50);return _this.wrapper_ref.current.scrollTop=0}}(this),this.props.delay)},componentWillUnmount:function(){if(this.timer){window.clearTimeout(this.timer);return delete this.timer}},render:function(){var style;style=this.state.height===false?null:this.state.height?this.state.animated?null:{height:this.state.height+"px",overflow:"hidden",transition:"height "+this.props.duration/1e3+"s ease"}:{height:0,overflow:"scroll",transition:"height 0.2s ease"};return div({style:style,className:this.props.className,ref:this.wrapper_ref||(this.wrapper_ref=React.createRef())},this.props.children)}})})}).call(this);(function(){var slice=[].slice;I.theme_template_scope={first:function(a,b,c,d){var ref,ref1;return(ref=(ref1=a!=null?a:b)!=null?ref1:c)!=null?ref:slice.call(arguments).find(function(_this){return function(v){return v!=null}}(this))},when:function(_this){return function(val,expected,ret,other){if(val===expected){return ret}else{return other}}}(this),sub_color2:I.Color.sub_color2,sub_color:I.Color.sub_color,mix_color:I.Color.mix_color,alpha:function(color,a){var b,g,r,ref;ref=I.Color.parse_color_safe(color),r=ref[0],g=ref[1],b=ref[2];return"rgba("+r+", "+g+", "+b+", "+a+")"},bg_color_for_input:function(color){var bg_sub,l,p,ref;bg_sub=I.Color.sub_color2(color,.1);l=(ref=I.Color).luma.apply(ref,I.Color.parse_color_safe(color));p=Math.min(1,Math.max(0,(l-.5)*2));return I.Color.mix_color("#ffffff",bg_sub,p)},text_color_for_bg:function(color){var h,l,ref,ref1,s;ref1=(ref=I.Color).rgb_to_hsl.apply(ref,I.Color.parse_color_safe(color)),h=ref1[0],s=ref1[1],l=ref1[2];if(l>=75){return"black"}else{return"white"}},text_shadow_color_for_bg:function(color){var h,l,ref,ref1,s;ref1=(ref=I.Color).rgb_to_hsl.apply(ref,I.Color.parse_color_safe(color)),h=ref1[0],s=ref1[1],l=ref1[2];if(l>=75){return"transparent"}else{return I.Color.sub_color2(color)}}}}).call(this);(function(){I.libs.react.done(function(){var P,_rdf,a,br,button,code,div,em,fieldset,form,fragment,h1,h2,h3,h4,h5,h6,iframe,img,input,label,legend,li,ol,optgroup,option,p,pre,section,select,span,strong,textarea,types,ul;_rdf=ReactDOMFactories;div=_rdf.div,span=_rdf.span,a=_rdf.a,br=_rdf.br,p=_rdf.p,ol=_rdf.ol,ul=_rdf.ul,li=_rdf.li,strong=_rdf.strong,em=_rdf.em,img=_rdf.img,form=_rdf.form,label=_rdf.label,input=_rdf.input,textarea=_rdf.textarea,button=_rdf.button,iframe=_rdf.iframe,h1=_rdf.h1,h2=_rdf.h2,h3=_rdf.h3,h4=_rdf.h4,h5=_rdf.h5,h6=_rdf.h6,pre=_rdf.pre,code=_rdf.code,select=_rdf.select,option=_rdf.option,section=_rdf.section,optgroup=_rdf.optgroup,fieldset=_rdf.fieldset,legend=_rdf.legend;fragment=React.createFactory(React.Fragment);P=R["package"]("ThemeEditor");types=PropTypes;P("CSSInstructionsLightbox",{render:function(){return R.Lightbox({className:"css_instructions_lightbox_widget"},h2({},"Custom CSS"),p({},"Keep in mind we sometimes upgrade itch.io's pages and it's difficult to ensure those changes don't conflict with custom layouts people have done with the CSS editor. ",strong({},"Enhancing existing components instead of trying to redo the entire page is the best way to avoid any problems. ")),p({},"Please read the ",a({href:this.props.css_guide_url,target:"_blank"},"Custom CSS guide")," before using any custom CSS."),p({},"If there's a customization you think that we should include as part of the theme editor then ",a({href:"/support",target:"_blank"},"send us a message"),"."),p({},button({type:"button",className:"button",onClick:function(_this){return function(){return I.Lightbox.close()}}(this)},"Got it")))}})})}).call(this);(function(){I.libs.react.done(function(){var P,_rdf,a,br,button,code,div,em,fieldset,form,fragment,h1,h2,h3,h4,h5,h6,iframe,img,input,label,legend,li,ol,optgroup,option,p,pre,section,select,span,strong,textarea,types,ul,slice=[].slice;_rdf=ReactDOMFactories;div=_rdf.div,span=_rdf.span,a=_rdf.a,br=_rdf.br,p=_rdf.p,ol=_rdf.ol,ul=_rdf.ul,li=_rdf.li,strong=_rdf.strong,em=_rdf.em,img=_rdf.img,form=_rdf.form,label=_rdf.label,input=_rdf.input,textarea=_rdf.textarea,button=_rdf.button,iframe=_rdf.iframe,h1=_rdf.h1,h2=_rdf.h2,h3=_rdf.h3,h4=_rdf.h4,h5=_rdf.h5,h6=_rdf.h6,pre=_rdf.pre,code=_rdf.code,select=_rdf.select,option=_rdf.option,section=_rdf.section,optgroup=_rdf.optgroup,fieldset=_rdf.fieldset,legend=_rdf.legend;fragment=React.createFactory(React.Fragment);P=R["package"]("ThemeEditor");types=PropTypes;P("ErrorLightbox",{propTypes:{title:types.string,errors:types.array.isRequired},render:function(){return R.Lightbox.apply(R,[{className:"game_edit_error_lightbox_widget compact"},h2({},this.props.title||"We encountered an error")].concat(slice.call(this.props.errors.map(function(_this){return function(e){return p({},e)}}(this))),[p({className:"sub_text"},this.props.sub_text)],[p({className:"buttons"},button({className:"button",type:"button",onClick:function(_this){return function(){return I.Lightbox.close()}}(this)},"Close"))]))}})})}).call(this);(function(){I.libs.react.done(function(){var P,_rdf,a,br,button,code,div,em,fieldset,form,fragment,h1,h2,h3,h4,h5,h6,iframe,img,input,label,legend,li,ol,optgroup,option,p,pre,section,select,span,stop_propagation,strong,textarea,types,ul,hasProp={}.hasOwnProperty,slice=[].slice;_rdf=ReactDOMFactories;div=_rdf.div,span=_rdf.span,a=_rdf.a,br=_rdf.br,p=_rdf.p,ol=_rdf.ol,ul=_rdf.ul,li=_rdf.li,strong=_rdf.strong,em=_rdf.em,img=_rdf.img,form=_rdf.form,label=_rdf.label,input=_rdf.input,textarea=_rdf.textarea,button=_rdf.button,iframe=_rdf.iframe,h1=_rdf.h1,h2=_rdf.h2,h3=_rdf.h3,h4=_rdf.h4,h5=_rdf.h5,h6=_rdf.h6,pre=_rdf.pre,code=_rdf.code,select=_rdf.select,option=_rdf.option,section=_rdf.section,optgroup=_rdf.optgroup,fieldset=_rdf.fieldset,legend=_rdf.legend;fragment=React.createFactory(React.Fragment);P=R["package"]("ThemeEditor");types=PropTypes;stop_propagation=function(_this){return function(e){return e.stopPropagation()}}(this);P("FontPickerFontRow",{pure:true,render:function(){var font;font=this.props.font;return li({},button({onClick:this.props.select_font,type:"button","data-family":font.family},span({},span({className:"family_name"},font.family),br({}),span({className:"category"},font.category)),a({href:"https://fonts.google.com/specimen/"+font.family,target:"_blank",onClick:stop_propagation},"preview")))}});P("FontPickerLightbox",{getInitialState:function(_this){return function(){return{loading_fonts:true,filter_category:"all"}}}(this),render:function(){var key;return R.Lightbox({className:"font_picker_lightbox_widget compact"},h2({},"Select a font"),div({className:"form"},div({className:"font_filter"},input({type:"text",value:this.state.filter||"",onChange:function(_this){return function(e){var filter;filter=e.currentTarget.value;if($.trim(filter)===""){filter=null}_this.reset_scroll();return _this.setState({filter:filter})}}(this),placeholder:"Search for font by name..."}),R.Forms.SimpleSelect({value:this.state.filter_category,onChange:function(_this){return function(value){_this.reset_scroll();return _this.setState({filter_category:value})}}(this),options:[{name:"All fonts",value:"all"}].concat(slice.call(function(){var ref,results;ref=this.state.font_categories||[];results=[];for(key in ref){if(!hasProp.call(ref,key))continue;results.push({name:key,value:key})}return results}.call(this)))})),this.render_font_list(),p({className:"google_fonts"},"These fonts are pulled from Google Fonts, consider ",a({href:"https://fonts.google.com/",target:"_blank"},"using their directory")," and typing the font name here.")))},reset_scroll:function(){if(this.refs.scroller){return this.refs.scroller.scrollTop=0}},select_font:function(e){var base,target;target=e.currentTarget;if($(target).is("[href]")){return}return typeof(base=this.props).on_pick_font==="function"?base.on_pick_font(target.dataset.family):void 0},render_font_list:function(){var available_fonts,filter_font,r;if(this.state.loading_fonts){return p({className:"loading"},"Loading list...")}r=this.state.filter?new RegExp("\\b"+I.escape_regex($.trim(this.state.filter)),"i"):void 0;filter_font=function(_this){return function(font){if(_this.state.filter_category!=="all"){if(font.category!==_this.state.filter_category){return false}}if(_this.state.filter){if(font.family===_this.state.filter){return true}return r.test(font.family)}else{return true}}}(this);available_fonts=this.state.fonts.filter(filter_font).map(function(_this){return function(font){return P.FontPickerFontRow({key:font.family,select_font:_this.select_font,font:font})}}(this));return ul({className:"font_list",ref:"scroller"},available_fonts.length?available_fonts:li({className:"empty_search"},"No results found"))},componentDidMount:function(){var fetch_fonts;fetch_fonts=this.props.fonts?$.when(this.props.fonts):$.getJSON(this.props.fonts_url);return fetch_fonts.then(function(_this){return function(fonts){var font,font_categories,i,len;font_categories={};for(i=0,len=fonts.length;i<len;i++){font=fonts[i];if(!font_categories[font.category]){font_categories[font.category]=0}font_categories[font.category]+=1}return _this.setState({loading_fonts:false,font_categories:font_categories,fonts:fonts})}}(this))}})})}).call(this);(function(){I.libs.react.done(function(){var CSSTransition,P,TransitionGroup,_rdf,a,br,button,code,div,em,fieldset,form,fragment,h1,h2,h3,h4,h5,h6,iframe,img,input,label,legend,li,ol,optgroup,option,p,pre,section,select,span,strong,textarea,types,ul,slice=[].slice;_rdf=ReactDOMFactories;div=_rdf.div,span=_rdf.span,a=_rdf.a,br=_rdf.br,p=_rdf.p,ol=_rdf.ol,ul=_rdf.ul,li=_rdf.li,strong=_rdf.strong,em=_rdf.em,img=_rdf.img,form=_rdf.form,label=_rdf.label,input=_rdf.input,textarea=_rdf.textarea,button=_rdf.button,iframe=_rdf.iframe,h1=_rdf.h1,h2=_rdf.h2,h3=_rdf.h3,h4=_rdf.h4,h5=_rdf.h5,h6=_rdf.h6,pre=_rdf.pre,code=_rdf.code,select=_rdf.select,option=_rdf.option,section=_rdf.section,optgroup=_rdf.optgroup,fieldset=_rdf.fieldset,legend=_rdf.legend;fragment=React.createFactory(React.Fragment);P=R["package"]("GameEdit");types=PropTypes;TransitionGroup=ReactTransitionGroup.TransitionGroup,CSSTransition=ReactTransitionGroup.CSSTransition;P("ThemeEditor",{getInitialState:function(){return $.extend({open:this.props.open||false,fonts:this.props.fonts,css_template:this.props.css_template?window["eval"](this.props.css_template):void 0},this.props.theme)},render_to_css:function(){var align,alpha,background_layers,color1,color2,embed_background_css,font,header_font,ref,ref1,rgba,theme,wrapper_background_css;if(!this.state.css_template){console.warn("tried to render to css but we don't have a template");return}wrapper_background_css=this.state.background_image?(align=function(){switch(this.state.background_position){case"align_left":return"0 0 ";case"align_right":return"100% 0";default:return"50% 0"}}.call(this),_.compact(["background-image: url('"+this.state.background_image.thumb_url+"')","background-repeat: "+(this.state.background_repeat||"repeat"),"background-position: "+align,this.state.background_attach==="fixed"?"background-attachment: fixed":void 0]).join(";")):"";embed_background_css=this.state.embed_background_image?(background_layers=["url('"+this.state.embed_background_image.thumb_url+"')"],(color1=this.state.embed_background_color1)?(color2=(ref=this.state.embed_background_color2)!=null?ref:color1,alpha=((ref1=this.state.embed_background_alpha)!=null?ref1:50)/100,rgba=I.theme_template_scope.alpha,background_layers.unshift("linear-gradient(to bottom, "+rgba(color1,alpha)+", "+rgba(color2,alpha)+")")):void 0,_.compact(["background-image: "+background_layers.join(",")+";"])):"";font=this.state.fonts.find(function(_this){return function(f){return f.slug===_this.state.font_family}}(this));header_font=this.state.fonts.find(function(_this){return function(f){return f.slug===_this.state.header_font_family}}(this));theme=$.extend(Object.create(I.theme_template_scope),{wrapper_background_css:wrapper_background_css,embed_background_css:embed_background_css,font_family:R.ThemeEditor.escape_font_family((font!=null?font.family:void 0)||"inherit"),header_font_family:R.ThemeEditor.escape_font_family((header_font!=null?header_font.family:void 0)||"inherit"),header_text_color:this.state.header_text_color||"inherit"},_.pick.apply(_,[this.state].concat(slice.call(["bg_color","bg2_color","text_color","link_color","button_color","header_text_color","screenshots_loc","default_screenshots_loc","bg2_alpha"]))));theme=new Proxy(theme,{has:function(_this){return function(){return true}}(this)});return this.state.css_template(theme)},render_banner:function(){var banner,position;this._header||(this._header=$("#header"));this._header.removeClass().addClass("header");banner=this.state.banner_image;if(banner){position=this.state.banner_position||"align_center";img=this._header.find("img");this._header.addClass("has_image").addClass(position);if(img.exists()){return img.attr("src",banner.thumb_url)}else{return $("<img src='"+banner.thumb_url+"'/>").appendTo(this._header)}}},load_font:function(family){var font;this.loaded_fonts||(this.loaded_fonts=$.extend({},this.props.loaded_fonts));if(this.loaded_fonts[family]){return}this.loaded_fonts[family]=true;font=this.state.fonts.find(function(f){return f.slug===family});if(!font){return}if(font.href&&!$("link[data-font='"+font.slug+"']").exists()){return $("<link rel='stylesheet' href='"+font.href+"' data-font='"+font.slug+"'></link>").appendTo("head")}},apply_css:function(){var classes;this.style_el||(this.style_el=$("#game_theme").exists()||$("<style type='text/css' id='game_theme'></style>").appendTo($("head")));this.style_el.html(I.strip_css(this.render_to_css()||""));if(this.props.can_use_css){this.custom_style_el||(this.custom_style_el=$("#custom_css").exists()||$("<style type='text/css' id='custom_css'></style>").appendTo($("head")));this.custom_style_el.html(I.strip_css(this.state.css||""))}this.render_banner();this.load_font(this.state.font_family);this.load_font(this.state.header_font_family);classes=classNames(["inner_column",this.state.font_family?"family_"+this.state.font_family:void 0,this.state.font_size?"size_"+this.state.font_size:void 0]);return $("#inner_column").removeClass().addClass(classes)},componentDidUpdate:function(prev_props,prev_state){this.apply_css_throttled||(this.apply_css_throttled=_.throttle(this.apply_css,100));return this.apply_css_throttled()},save:function(){this.setState({loading:true});return I.remote_submit($(this.refs.form)).then(function(_this){return function(res){_this.setState({loading:false});if(res.errors){return I.Lightbox.open(R.ThemeEditor.ErrorLightbox({errors:res.errors,sub_text:"Your changes were not saved, please try again"}))}}}(this))},render:function(){return React.createElement(TransitionGroup,{key:"transition_group",component:"span"},this.state.open?React.createElement(CSSTransition,{classNames:"slide_in",timeout:{enter:200,exit:1}},this.render_sidebar()):void 0)},render_sidebar:function(){return this.enclose({className:"theme_editor_widget",key:"real"},form({ref:"form",method:"POST",action:this.props.submit_url,onSubmit:function(_this){return function(e){e.preventDefault();return _this.save()}}(this)},R.CSRF({}),section.apply(null,[{className:"input_group"}].concat(slice.call(this.render_color_pickers()))),section.apply(null,[{className:"input_group"}].concat(slice.call(this.render_font_pickers()))),section.apply(null,[{className:"input_group"}].concat(slice.call(this.render_layout_options()))),this.render_image_uploaders(),this.render_css_editor(),div({className:"buttons save_buttons"},button({className:classNames("button",{disabled:this.state.loading}),disabled:this.state.loading||false},this.state.loading&&"Saving..."||"Save"))))},append_font:function(font){return this.setState({fonts:slice.call(this.state.fonts).concat([font])})},render_font_pickers:function(){var ref;return[h3({},"Text"),label({className:"horiz_input"},span({className:"label_text"},"Font"),R.ThemeEditor.FontSelect({name:"layout[font_family]",value:this.state.font_family,fonts:this.state.fonts,fonts_url:this.props.fonts_url,on_add_font:this.append_font,on_pick_family:this.set_font_family||(this.set_font_family=function(_this){return function(family){return _this.setState({font_family:family})}}(this))})),label({className:"horiz_input"},span({className:"label_text"},"Size"),R.Forms.SimpleSelect({name:"layout[font_size]",value:this.state.font_size,onChange:this.set_font_size||(this.set_font_size=function(_this){return function(size){return _this.setState({font_size:size})}}(this)),options:this.font_size_options||(this.font_size_options=[{name:"Small",value:"small"},{name:"Medium",value:"medium"},{name:"Large",value:"large"},{name:"Very Large",value:"very_large"}])})),R.ThemeEditor.MoreGroup({label:"More options...",ref:"more_font_options",default_open:!!((ref=this.props.theme)!=null?ref.header_font_family:void 0)},label({className:"horiz_input"},span({className:"label_text"},"Header font"),R.ThemeEditor.FontSelect({name:"layout[header_font_family]",allow_default:true,value:this.state.header_font_family,fonts:this.state.fonts,fonts_url:this.props.fonts_url,on_add_font:this.append_font,on_pick_family:this.set_header_font_family||(this.set_header_font_family=function(_this){return function(family){return _this.setState({header_font_family:family})}}(this))})))]},render_align_select:function(name,state_field){var name1;return label({className:"horiz_input"},span({className:"label_text"},"Align"),R.Forms.SimpleSelect({name:name,value:this.state[state_field],onChange:this[name1="set_"+state_field]||(this[name1]=function(_this){return function(val){var o;o={};o[state_field]=val;return _this.setState(o)}}(this)),options:this.image_align_options||(this.image_align_options=[{name:"Center",value:"align_center"},{name:"Left",value:"align_left"},{name:"Right",value:"align_right"}])}))},render_image_uploaders:function(){var ref;return section({className:"input_group"},h3({},"Images"),R.Forms.ImageUploader({compact:true,upload_url:this.props.image_upload_url,upload:this.state.banner_image,name:"layout[banner_image][image_id]",label:"Banner",upload_label:"Upload",on_upload:this.set_banner_image||(this.set_banner_image=function(_this){return function(upload){return _this.setState({banner_image:upload})}}(this))},this.state.banner_image?div({className:"position_fields"},this.render_align_select("layout[banner_image][position]","banner_position")):void 0),R.Forms.ImageUploader({compact:true,upload_url:this.props.image_upload_url,upload:this.state.background_image,name:"layout[background_image][image_id]",label:"Background",upload_label:"Upload",on_upload:this.set_background_image||(this.set_background_image=function(_this){return function(upload){return _this.setState({background_image:upload})}}(this))},this.state.background_image?div({className:"position_fields"},label({className:"horiz_input"},span({className:"label_text"},"Repeat"),R.Forms.SimpleSelect({name:"layout[background_image][repeat]",value:this.state.background_repeat,onChange:this.set_background_repeat||(this.set_background_repeat=function(_this){return function(val){return _this.setState({background_repeat:val})}}(this)),options:this.background_repeat_options||(this.background_repeat_options=[{name:"Both",value:"repeat"},{name:"Horizontally",value:"repeat-x"},{name:"Vertically",value:"repeat-y"},{name:"None",value:"no-repeat"}])})),this.render_align_select("layout[background_image][position]","background_position"),label({className:"horiz_input"},span({className:"label_text"},"Fixed"),div({},input({type:"checkbox",name:"layout[background_image][attach]",value:"fixed",checked:this.state.background_attach==="fixed",onChange:this.set_background_attach||(this.set_background_attach=function(_this){return function(e){return _this.setState({background_attach:e.target.checked?"fixed":null})}}(this))})))):void 0),this.props.game_type==="html"||this.state.embed_background_image?R.Forms.ImageUploader({compact:true,upload_url:this.props.image_upload_url,name:"layout[embed_background_image][image_id]",label:"Embed BG",upload_label:"Upload",upload:this.state.embed_background_image,on_upload:function(_this){return function(upload){return _this.setState({embed_background_image:upload})}}(this)},div({className:"color_options"},label({className:"horiz_input"},span({className:"label_text"},"Color 1"),this.color_input("embed_background_color1",{name:"layout[embed_background_image][color1]"})),label({className:"horiz_input"},span({className:"label_text"},"Color 2"),this.color_input("embed_background_color2",{name:"layout[embed_background_image][color2]",allow_empty:true})),label({className:"horiz_input"},span({className:"label_text"},"Alpha"),R.Forms.Slider({min:0,max:100,show_tooltip:true,value:(ref=this.state.embed_background_alpha)!=null?ref:50,name:"layout[embed_background_image][alpha]",onChange:this.set_embed_background_alpha||(this.set_embed_background_alpha=function(_this){return function(val){return _this.setState({embed_background_alpha:val})}}(this))})))):void 0)},color_input:function(field_name,opts){var name1,ref;if(opts==null){opts={}}return R.Forms.ColorInput({name:(ref=opts.name)!=null?ref:"layout["+field_name+"]",popout_portal_target:document.body,className:"compact",value:this.state[field_name],allow_empty:opts.allow_empty,onChange:this[name1="set_"+field_name]||(this[name1]=function(_this){return function(color){var update;if(color===""){color=void 0}update={};update[field_name]=color;return _this.setState(update)}}(this))})},render_color_pickers:function(){var ref,ref1,ref2,ref3;return[h3({},"Color"),label({className:"horiz_input"},span({className:"label_text"},"BG"),this.color_input("bg_color")),label({className:"horiz_input"},span({className:"label_text"},"BG 2"),this.color_input("bg2_color")),label({className:"horiz_input"},span({className:"label_text"},"Text"),this.color_input("text_color")),label({className:"horiz_input"},span({className:"label_text"},"Link"),this.color_input("link_color")),R.ThemeEditor.MoreGroup({label:"More options...",ref:"more_color_options",default_open:((ref=this.props.theme)!=null?ref.header_text_color:void 0)||((ref1=this.props.theme)!=null?ref1.button_color:void 0)||((ref2=this.props.theme)!=null?ref2.bg2_alpha:void 0)!=null},label({className:"horiz_input"},span({className:"label_text"},"Headers"),this.color_input("header_text_color",{allow_empty:true})),label({className:"horiz_input"},span({className:"label_text"},"Buttons"),this.color_input("button_color",{allow_empty:true})),label({className:"horiz_input"},span({className:"label_text"},"BG2 Alpha"),R.Forms.Slider({min:0,max:100,show_tooltip:true,value:(ref3=this.state.bg2_alpha)!=null?ref3:100,name:"layout[bg2_alpha]",onChange:this.set_bg2_alpha||(this.set_bg2_alpha=function(_this){return function(val){return _this.setState({bg2_alpha:val})}}(this))})))]},render_css_editor:function(){if(!this.props.can_use_css){return}return section({className:"input_group css_editor"},h3({},"Misc"),R.ThemeEditor.CssEditor({name:"layout[css]",value:this.state.css,css_guide_url:this.props.css_guide_url,on_change:this.set_css||(this.set_css=function(_this){return function(e){return _this.setState({css:e.target.value})}}(this))}))},render_layout_options:function(){return[h3({},"Layout"),label({className:"horiz_input"},span({className:"label_text"},"Screenshots"),R.Forms.SimpleSelect({name:"layout[screenshots_loc]",value:this.state.screenshots_loc||"",onChange:this.setup_screenshots_loc||(this.setup_screenshots_loc=function(_this){return function(val){if(!val){val=void 0}return _this.setState({screenshots_loc:val})}}(this)),options:this.screenshots_loc_options||(this.screenshots_loc_options=[{name:"Auto ("+this.state.default_screenshots_loc+")",short_name:"Auto",value:""},{name:"Sidebar",value:"sidebar"},{name:"Hidden",value:"hidden"}])}))]}})})}).call(this);(function(){I.libs.react.done(function(){var P,_rdf,a,br,button,code,div,em,fieldset,form,fragment,h1,h2,h3,h4,h5,h6,iframe,img,input,label,legend,li,ol,optgroup,option,p,pre,section,select,span,strong,textarea,types,ul;_rdf=ReactDOMFactories;div=_rdf.div,span=_rdf.span,a=_rdf.a,br=_rdf.br,p=_rdf.p,ol=_rdf.ol,ul=_rdf.ul,li=_rdf.li,strong=_rdf.strong,em=_rdf.em,img=_rdf.img,form=_rdf.form,label=_rdf.label,input=_rdf.input,textarea=_rdf.textarea,button=_rdf.button,iframe=_rdf.iframe,h1=_rdf.h1,h2=_rdf.h2,h3=_rdf.h3,h4=_rdf.h4,h5=_rdf.h5,h6=_rdf.h6,pre=_rdf.pre,code=_rdf.code,select=_rdf.select,option=_rdf.option,section=_rdf.section,optgroup=_rdf.optgroup,fieldset=_rdf.fieldset,legend=_rdf.legend;fragment=React.createFactory(React.Fragment);P=R["package"]("ThemeEditor");types=PropTypes;R.Icons||(R.Icons={});R.Icons.Grab=function(props){var height,ref,ref1,width;if(props==null){props={}}width=(ref=props.width)!=null?ref:18;height=(ref1=props.height)!=null?ref1:16;return React.createElement("svg",{className:"svgicon icon_grab",fill:"currentColor",stroke:"none",role:"img",version:"1.1",viewBox:"0 0 18 16",width:width,height:height,"aria-hidden":true},React.createElement("rect",{width:"18",height:"4"}),React.createElement("rect",{y:"12",width:"18",height:"4"}),React.createElement("rect",{y:"6",width:"18",height:"4"}))};P("OrderPickerItem",{pure:true,propTypes:{item:types.shape({id:types.number,order:types.number,name:types.string,hidden:types.bool,type:types.string},{position:types.number,input_name:types.string})},input_name:function(name){return this.props.input_name+"["+(this.props.position+1)+"]["+name+"]"},render:function(){var item;item=this.props.item;return div({"data-id":item.id,className:classNames("order_row",{dragging:this.props.dragging})},this.props.input_name?input({type:"hidden",className:"position_input",name:this.input_name("id"),value:item.id}):void 0,this.props.item.hidden&&this.props.input_name?input({type:"hidden",name:this.input_name("hidden"),value:"1"}):void 0,R.Icons.Grab({}),span({className:"item_name",title:item.name},item.name),button({type:"button",className:classNames("hide_btn",{is_active:this.props.item.hidden}),onClick:function(_this){return function(e){e.preventDefault();return _this.trigger("order_picker_item:hidden",_this.props.item,!_this.props.item.hidden)}}(this)},this.props.item.hidden?"Hidden":"Hide"))}});P("OrderPicker",{pure:true,propTypes:{input_name:types.string,update_order:types.func,items:types.arrayOf(types.shape({id:types.number,name:types.string,hidden:types.bool,type:types.string}))},getInitialState:function(){return{items:this.props.items}},update_order:function(ids){var base,item,items,items_by_id,j,len,ref;items_by_id={};ref=this.state.items;for(j=0,len=ref.length;j<len;j++){item=ref[j];items_by_id[""+item.id]=item}items=ids.map(function(_this){return function(id){return items_by_id[id]}}(this));this.setState({items:items});return typeof(base=this.props).update_order==="function"?base.update_order(items):void 0},componentDidMount:function(){var el;el=$(this.list_ref.current);this.dispatch("order_picker_item",{hidden:function(_this){return function(e,item,hidden){var base,items;items=_this.state.items.map(function(list_item){if(item.id===list_item.id){return $.extend({},item,{hidden:hidden})}else{return list_item}});_this.setState({items:items});return typeof(base=_this.props).update_order==="function"?base.update_order(items):void 0}}(this)});return window.requestAnimationFrame(function(_this){return function(){return el.sortable({cancel:"button"}).on("sortstop",function(e){var order;order=el.sortable("toArray",{attribute:"data-id"});el.sortable("cancel");return _this.update_order(order)})}}(this))},render:function(){return this.enclose({ref:this.list_ref||(this.list_ref=React.createRef()),className:"sorting_picker"},this.state.items.map(function(_this){return function(item,i){return R.ThemeEditor.OrderPickerItem({key:item.id,position:i,item:item,input_name:_this.props.input_name})}}(this)))}})})}).call(this);(function(){I.libs.react.done(function(){var CSSTransition,P,TransitionGroup,_rdf,a,br,button,code,div,em,fieldset,form,fragment,h1,h2,h3,h4,h5,h6,iframe,img,input,label,legend,li,ol,optgroup,option,p,pre,section,select,span,strong,textarea,types,ul,slice=[].slice,indexOf=[].indexOf||function(item){for(var i=0,l=this.length;i<l;i++){if(i in this&&this[i]===item)return i}return-1};_rdf=ReactDOMFactories;div=_rdf.div,span=_rdf.span,a=_rdf.a,br=_rdf.br,p=_rdf.p,ol=_rdf.ol,ul=_rdf.ul,li=_rdf.li,strong=_rdf.strong,em=_rdf.em,img=_rdf.img,form=_rdf.form,label=_rdf.label,input=_rdf.input,textarea=_rdf.textarea,button=_rdf.button,iframe=_rdf.iframe,h1=_rdf.h1,h2=_rdf.h2,h3=_rdf.h3,h4=_rdf.h4,h5=_rdf.h5,h6=_rdf.h6,pre=_rdf.pre,code=_rdf.code,select=_rdf.select,option=_rdf.option,section=_rdf.section,optgroup=_rdf.optgroup,fieldset=_rdf.fieldset,legend=_rdf.legend;fragment=React.createFactory(React.Fragment);P=R["package"]("Profile");types=PropTypes;TransitionGroup=ReactTransitionGroup.TransitionGroup,CSSTransition=ReactTransitionGroup.CSSTransition;P("ThemeEditor",{getInitialState:function(){return{open:false,fonts:this.props.fonts,css_template:this.props.css_template?window["eval"](this.props.css_template):void 0,theme:this.props.theme,banner_image:this.props.banner_image,background_image:this.props.background_image}},update_theme:function(key,value){var update;if(this.state.theme[key]===value){return}update={};update[key]=value;return this.setState({theme:Object.assign({},this.state.theme,update)})},componentDidUpdate:function(prev_props,prev_state){this.apply_css_throttled||(this.apply_css_throttled=_.throttle(this.apply_css,100));this.apply_css_throttled();if(prev_state.theme.game_order!==this.state.theme.game_order||prev_state.theme.hidden_games!==this.state.theme.hidden_games){this.apply_project_order()}if(prev_state.theme.collection_order!==this.state.theme.collection_order||prev_state.theme.hidden_collections!==this.state.theme.hidden_collections){return this.apply_collection_order()}},render_to_css:function(){var background_image_css,font,ref,ref1,theme;if(!this.state.css_template){console.warn("tried to render to css but we don't have a template");return}font=this.state.fonts.find(function(_this){return function(f){return f.slug===_this.state.theme.font_family}}(this));background_image_css=R.ThemeEditor.background_css(this.state.background_image,this.state.theme.background_image);theme=Object.assign(Object.create(I.theme_template_scope),{font_size:((ref=this.state.theme.font_size)!=null?ref:100)+"%",font_family:R.ThemeEditor.escape_font_family((font!=null?font.family:void 0)||"inherit"),background_image_css:background_image_css,border_radius:this.state.theme.border_radius?this.state.theme.border_radius+"px":void 0,header_image_css:((ref1=this.state.theme.banner_image)!=null?ref1.size:void 0)==="full"?"width: 100%;":void 0},_.pick.apply(_,[this.state.theme].concat(slice.call(["bg_color","text_color","link_color"]))));theme=new Proxy(theme,{has:function(_this){return function(){return true}}(this)});return this.state.css_template(theme)},apply_css:function(){var has_banner,ref;this.style_el||(this.style_el=$("#user_theme").exists()||$("<style type='text/css' id='user_theme'></style>").appendTo($("head")));this.style_el.html(I.strip_css(this.render_to_css()||""));this._user_page||(this._user_page=$(".user_page.page_widget"));has_banner=!!((ref=this.state.theme.banner_image)!=null?ref.id:void 0);this._user_page.toggleClass("has_banner",has_banner);this._user_page.toggleClass("mode_grid",this.state.theme.layout==="grid");this._user_page.toggleClass("mode_column",this.state.theme.layout==="column");this._user_page.toggleClass("mode_collection_grid",this.state.theme.collection_layout==="grid");this._user_page.toggleClass("mode_show_purchases",!!this.state.theme.show_purchases);if(has_banner){this._user_header_image||(this._user_header_image=$("#profile_header .profile_banner"));if(this.state.banner_image){this._user_header_image.attr("src",this.state.banner_image.thumb_url)}}if(this.props.can_use_css){this.custom_style_el||(this.custom_style_el=$("#custom_css").exists()||$("<style type='text/css' id='custom_css'></style>").appendTo($("head")));this.custom_style_el.html(I.strip_css(this.state.theme.css||""))}return this.load_font(this.state.theme.font_family)},apply_project_order:function(){var cell,cells_by_id,current_order,el,game_grid,game_id,game_order,hidden,i,id,len,results;game_grid=this._user_page.find(".user_game_grid");cells_by_id={};current_order=function(){var i,len,ref,results;ref=game_grid.children(".game_cell");results=[];for(i=0,len=ref.length;i<len;i++){cell=ref[i];game_id=parseInt($(cell).data("game_id"));cells_by_id[game_id]=cell;results.push(game_id)}return results}();game_order=this.state.theme.game_order||current_order;hidden=this.state.theme.hidden_games||[];results=[];for(i=0,len=game_order.length;i<len;i++){id=game_order[i];el=cells_by_id[id];if(!el){continue}el.style.display=indexOf.call(hidden,id)>=0?"none":"";results.push(game_grid.append(el))}return results},apply_collection_order:function(){var collection_id,collection_order,collections,current_order,el,hidden,i,id,len,results,row,rows_by_id;collections=this._user_page.find(".collections");rows_by_id={};current_order=function(){var i,len,ref,results;ref=collections.children(".collection_row");results=[];for(i=0,len=ref.length;i<len;i++){row=ref[i];collection_id=parseInt($(row).data("collection_id"));rows_by_id[collection_id]=row;results.push(collection_id)}return results}();collection_order=this.state.theme.collection_order||current_order;hidden=this.state.theme.hidden_collections||[];results=[];for(i=0,len=collection_order.length;i<len;i++){id=collection_order[i];el=rows_by_id[id];if(!el){continue}el.style.display=indexOf.call(hidden,id)>=0?"none":"";results.push(collections.append(el))}return results},load_font:function(family){var font;this.loaded_fonts||(this.loaded_fonts=$.extend({},this.props.loaded_fonts));if(this.loaded_fonts[family]){return}this.loaded_fonts[family]=true;font=this.state.fonts.find(function(f){return f.slug===family});if(!font){return}if(font.href&&!$("link[data-font='"+font.slug+"']").exists()){return $("<link rel='stylesheet' href='"+font.href+"' data-font='"+font.slug+"'></link>").appendTo("head")}},render:function(){return React.createElement(TransitionGroup,{key:"transition_group",component:"span"},this.state.open?React.createElement(CSSTransition,{classNames:"slide_in",timeout:{enter:200,exit:1}},this.render_sidebar()):void 0)},render_sidebar:function(){return this.enclose({key:"real",className:"theme_editor_widget"},p({},"You can edit your profile's content on your ",a({href:this.props.user_settings_url,target:"_blank"},"account profile settings"),"."),form({ref:this.form_ref||(this.form_ref=React.createRef()),method:"POST",onSubmit:function(_this){return function(e){var theme;e.preventDefault();theme=JSON.stringify(_this.state.theme);_this.setState({loading:true});return $.ajax({url:_this.props.submit_url,type:"POST",data:I.with_csrf({theme:theme}),xhrFields:{withCredentials:true},error:function(xhr){_this.setState({loading:false});return I.Lightbox.open(R.ThemeEditor.ErrorLightbox({errors:["Server error"],sub_text:"Your changes were not saved, please try again"}))},success:function(res){_this.setState({loading:false});if(res.errors){return I.Lightbox.open(R.ThemeEditor.ErrorLightbox({errors:res.errors,sub_text:"Your changes were not saved, please try again"}))}}})}}(this)},this.render_color_pickers(),this.render_text_settings(),this.render_images(),this.render_project_settings(),this.render_collection_order(),this.render_css_editor(),div({className:"buttons save_buttons"},button({className:classNames("button",{disabled:this.state.loading}),disabled:this.state.loading||false},this.state.loading&&"Saving..."||"Save"))))},color_input:function(field_name,opts){var name;if(opts==null){opts={}}return R.Forms.ColorInput({popout_portal_target:document.body,className:"compact",value:this.state.theme[field_name],allow_empty:opts.allow_empty,onChange:this[name="set_"+field_name]||(this[name]=function(_this){return function(color){if(color===""){color=void 0}return _this.update_theme(field_name,color)}}(this))})},render_css_editor:function(){if(!this.props.can_use_css){return}return section({className:"input_group css_editor"},h3({},"Misc"),R.ThemeEditor.CssEditor({value:this.state.theme.css||"",css_guide_url:this.props.css_guide_url,on_change:this.set_css||(this.set_css=function(_this){return function(e){return _this.update_theme("css",e.target.value)}}(this))}))},render_color_pickers:function(){return section({className:"input_group"},h3({},"Color"),label({className:"horiz_input"},span({className:"label_text"},"BG"),this.color_input("bg_color")),label({className:"horiz_input"},span({className:"label_text"},"Text"),this.color_input("text_color")),label({className:"horiz_input"},span({className:"label_text"},"Link"),this.color_input("link_color")))},render_text_settings:function(){var ref;return section({className:"input_group"},h3({},"Text"),label({className:"horiz_input"},span({className:"label_text"},"Font"),R.ThemeEditor.FontSelect({fonts:this.state.fonts,fonts_url:this.props.fonts_url,on_add_font:this.append_font||(this.append_font=function(_this){return function(font){return _this.setState({fonts:slice.call(_this.state.fonts).concat([font])})}}(this)),value:this.state.theme.font_family||"",on_pick_family:this.set_font_family||(this.set_font_family=function(_this){return function(family){return _this.update_theme("font_family",family)}}(this))})),label({className:"horiz_input"},span({className:"label_text"},"Size"),R.Forms.Slider({min:75,max:175,show_tooltip:true,value:(ref=this.state.theme.font_size)!=null?ref:100,onChange:this.set_font_size||(this.set_font_size=function(_this){return function(val){return _this.update_theme("font_size",val)}}(this))})))},render_images:function(){var ref;return section({className:"input_group"},h3({},"Images"),R.Forms.ImageUploader({compact:true,upload_url:this.props.image_upload_url,upload:this.state.banner_image,label:"Banner",upload_label:"Upload",on_upload:this.set_banner_image||(this.set_banner_image=function(_this){return function(upload){_this.setState({banner_image:upload});return _this.update_theme("banner_image",Object.assign({},_this.state.theme.banner_image||{size:"fixed"},{id:upload!=null?upload.id:void 0}))}}(this))},this.state.banner_image?div({className:"position_fields"},label({className:"horiz_input"},span({className:"label_text"},"Size"),R.Forms.SimpleSelect({value:((ref=this.state.theme.banner_image)!=null?ref.size:void 0)||"",onChange:this.set_banner_image_size||(this.set_banner_image_size=function(_this){return function(val){return _this.update_theme("banner_image",Object.assign({},_this.state.theme.banner_image||{},{size:val}))}}(this)),options:this.banner_image_size_options||(this.banner_image_size_options=[{name:"Fixed width ",value:"fixed"},{name:"Full width",value:"full"}])}))):void 0),R.ThemeEditor.BackgroundImageUploader({image_upload_url:this.props.image_upload_url,upload:this.state.background_image,params:this.state.theme.background_image,on_change:function(_this){return function(upload,params){_this.update_theme("background_image",params);return _this.setState({background_image:upload})}}(this)}))},render_project_settings:function(){var ref;if(!(this.props.games&&this.props.games.length)){return}return section({className:"input_group project_input_group"},h3({},"My Projects"),label({className:"horiz_input"},span({className:"label_text"},"Layout"),R.Forms.SimpleSelect({value:this.state.theme.layout||"",onChange:this.set_layout||(this.set_layout=function(_this){return function(v){return _this.update_theme("layout",v)}}(this)),options:this.layout_options||(this.layout_options=[{name:"Sidebar",value:"column"},{name:"Grid",value:"grid"}])})),label({className:"horiz_input"},span({className:"label_text"},"B. Radius"),R.Forms.Slider({min:0,max:150,show_tooltip:true,value:(ref=this.state.theme.border_radius)!=null?ref:0,onChange:this.set_border_radius||(this.set_border_radius=function(_this){return function(val){return _this.update_theme("border_radius",val)}}(this))})),R.ThemeEditor.OrderPicker({items:this.props.games,update_order:this.set_game_order||(this.set_game_order=function(_this){return function(items){var item;return _this.setState({theme:Object.assign({},_this.state.theme,{game_order:function(){var i,len,results;results=[];for(i=0,len=items.length;i<len;i++){item=items[i];results.push(item.id)}return results}(),hidden_games:function(){var i,len,results;results=[];for(i=0,len=items.length;i<len;i++){item=items[i];if(item.hidden){results.push(item.id)}}return results}()})})}}(this))}))},render_collection_order:function(){if(!(this.props.collections&&this.props.collections.length)){return}return section({className:"input_group collection_input_group"},h3({},"Collections"),label({className:"horiz_input"},span({className:"label_text"},"Layout"),R.Forms.SimpleSelect({value:this.state.theme.collection_layout||"",onChange:this.set_collection_layout||(this.set_collection_layout=function(_this){return function(v){return _this.update_theme("collection_layout",v)}}(this)),options:this.collection_layout_options||(this.collection_layout_options=[{name:"List",value:"list"},{name:"Grid",value:"grid"}])})),label({className:"horiz_input wide_label"},span({className:"label_text"},"Supported by me"),div({},input({type:"checkbox",checked:this.state.theme.show_purchases||false,onChange:this.set_show_purchases||(this.set_show_purchases=function(_this){return function(e){return _this.update_theme("show_purchases",e.target.checked)}}(this))}))),R.ThemeEditor.OrderPicker({items:this.props.collections,update_order:this.set_collection_order||(this.set_collection_order=function(_this){return function(items){var item;return _this.setState({theme:Object.assign({},_this.state.theme,{collection_order:function(){var i,len,results;results=[];for(i=0,len=items.length;i<len;i++){item=items[i];results.push(item.id)}return results}(),hidden_collections:function(){var i,len,results;results=[];for(i=0,len=items.length;i<len;i++){item=items[i];if(item.hidden){results.push(item.id)}}return results}()})})}}(this))}))}})})}).call(this);(function(){I.libs.react.done(function(){var P,_rdf,a,br,button,code,div,em,fieldset,form,fragment,h1,h2,h3,h4,h5,h6,iframe,img,input,label,legend,li,ol,optgroup,option,p,pre,section,select,span,strong,textarea,types,ul,slice=[].slice;_rdf=ReactDOMFactories;div=_rdf.div,span=_rdf.span,a=_rdf.a,br=_rdf.br,p=_rdf.p,ol=_rdf.ol,ul=_rdf.ul,li=_rdf.li,strong=_rdf.strong,em=_rdf.em,img=_rdf.img,form=_rdf.form,label=_rdf.label,input=_rdf.input,textarea=_rdf.textarea,button=_rdf.button,iframe=_rdf.iframe,h1=_rdf.h1,h2=_rdf.h2,h3=_rdf.h3,h4=_rdf.h4,h5=_rdf.h5,h6=_rdf.h6,pre=_rdf.pre,code=_rdf.code,select=_rdf.select,option=_rdf.option,section=_rdf.section,optgroup=_rdf.optgroup,fieldset=_rdf.fieldset,legend=_rdf.legend;fragment=React.createFactory(React.Fragment);P=R["package"]("ThemeEditor");types=PropTypes;P.escape_font_family=function(f){if(f.match(/ /)){return"'"+f+"'"}else{return f}};P.background_css=function(image,params){var align;if(image){align=function(){switch(params.position){case"align_left":return"0 0 ";case"align_right":return"100% 0";default:return"50% 0"}}();return _.compact(["background-image: url('"+image.thumb_url+"')","background-repeat: "+(params.repeat||"repeat"),"background-position: "+align,params.attach==="fixed"?"background-attachment: fixed":void 0]).join(";")}else{return""}};P("MoreGroup",{pure:true,getInitialState:function(){return{open:!!this.props.default_open}},render_toggle:function(){return button({type:"button",className:"toggle_button",onClick:function(_this){return function(){return _this.setState({open:!_this.state.open})}}(this)},this.props.label)},render:function(){return this.enclose({className:classNames("more_group",{open:this.state.open})},fieldset({style:{display:this.state.open?"":"none"}},legend({},this.render_toggle()),div({className:"more_children"},this.props.children)),!this.state.open?this.render_toggle():void 0)}});P("FontSelect",{pure:true,propTypes:{fonts:types.array.isRequired,fonts_url:types.string.isRequired,allow_default:types.bool},open_google_fonts:function(){return I.Lightbox.open(R.ThemeEditor.FontPickerLightbox({fonts_url:this.props.fonts_url,on_pick_font:function(_this){return function(font_family){var base,existing,new_font,ref,ref1,slug;I.Lightbox.close();slug=font_family;existing=_this.props.fonts.find(function(f){return f.slug===slug});if(existing){if(typeof(base=_this.props).on_pick_family==="function"){base.on_pick_family(font_family)}return}new_font={slug:slug,name:font_family,family:font_family,type:"google_font",href:"https://fonts.googleapis.com/css?"+$.param({family:font_family+":400,400italic,700,700italic"})};if((ref=_this.props)!=null){ref.on_add_font(new_font)}return(ref1=_this.props)!=null?ref1.on_pick_family(new_font.family):void 0}}(this)}))},render:function(){var font;return R.Forms.SimpleSelect({name:this.props.name,value:this.props.value,onChange:function(_this){return function(font){if(font==="_select_google_font"){return _this.open_google_fonts()}else{return _this.props.on_pick_family(font)}}}(this),options:_.compact([this.props.allow_default?{name:"Default font",value:"_default"}:void 0,{name:"Select Google Font...",value:"_select_google_font"}].concat(slice.call(function(){var i,len,ref,results;ref=this.props.fonts;results=[];for(i=0,len=ref.length;i<len;i++){font=ref[i];results.push({name:font.name,value:font.slug,group:"Fonts"})}return results}.call(this))))})}});P("CssEditorLightbox",{pure:true,render:function(){return R.Lightbox({className:classNames(this.enclosing_class_name(),"compact")},h2({},"Edit CSS"),p({},"Changes are automatically applied.",this.props.css_guide_url?fragment({}," ",a({href:this.props.css_guide_url,target:"_blank",onClick:function(_this){return function(e){e.preventDefault();return I.Lightbox.open(R.ThemeEditor.CSSInstructionsLightbox({css_guide_url:_this.props.css_guide_url}))}}(this)},"Info about CSS on itch.io.")):void 0),div({className:"input_wrapper"},textarea({defaultValue:this.props.default_value,onChange:this.props.on_change,placeholder:"Type CSS here"})))}});P("CssEditor",{pure:true,render:function(){return fragment({},div({className:"label_help"},label({},div({className:"label_text"},"Custom CSS")),button({type:"button",className:"maximize_button textlike",title:"Expand",onClick:function(_this){return function(e){return I.Lightbox.open(R.ThemeEditor.CssEditorLightbox({default_value:_this.props.value,on_change:_this.props.on_change,css_guide_url:_this.props.css_guide_url}))}}(this)},"↗"),button({type:"button",className:"button small outline",onClick:function(_this){return function(e){return I.Lightbox.open(R.ThemeEditor.CSSInstructionsLightbox({css_guide_url:_this.props.css_guide_url}))}}(this)},"Readme")),textarea({name:this.props.name,value:this.props.value,onChange:this.props.on_change}))}});P("BackgroundImageUploader",{pure:true,getDefaultProps:function(){return{default_params:{repeat:"repeat",position:"align_center"}}},propTypes:{input_name_prefix:types.string,image_upload_url:types.string.isRequired,upload:types.object,on_change:types.func,params:types.object},update_params:function(update){var base,params;params=Object.assign({},this.props.params||{},update);return typeof(base=this.props).on_change==="function"?base.on_change(this.props.upload,params):void 0},render:function(){var ref,ref1,ref2;return R.Forms.ImageUploader({compact:true,upload_url:this.props.image_upload_url,upload:this.props.upload,name:this.props.input_name_prefix?this.props.input_name_prefix+"[image_id]":void 0,label:"Background",upload_label:"Upload",on_upload:this.props.on_change?this.on_upload||(this.on_upload=function(_this){return function(upload){var base,params;params=Object.assign({},_this.props.params||_this.props.default_params,{id:upload!=null?upload.id:void 0});return typeof(base=_this.props).on_change==="function"?base.on_change(upload,params):void 0}}(this)):void 0},this.props.upload?div({className:"position_fields"},label({className:"horiz_input"},span({className:"label_text"},"Repeat"),R.Forms.SimpleSelect({name:this.props.input_name_prefix?this.props.input_name_prefix+"[repeat]":void 0,value:(ref=this.props.params)!=null?ref.repeat:void 0,onChange:this.props.on_change?this.set_repeat||(this.set_repeat=function(_this){return function(repeat){return _this.update_params({repeat:repeat})}}(this)):void 0,options:this.background_repeat_options||(this.background_repeat_options=[{name:"Both",value:"repeat"},{name:"Horizontally",value:"repeat-x"},{name:"Vertically",value:"repeat-y"},{name:"None",value:"no-repeat"}])})),label({className:"horiz_input"},span({className:"label_text"},"Align"),R.Forms.SimpleSelect({name:this.props.input_name_prefix?this.props.input_name_prefix+"[position]":void 0,value:(ref1=this.props.params)!=null?ref1.position:void 0,onChange:this.props.on_change?this.set_position||(this.set_position=function(_this){return function(position){return _this.update_params({position:position})}}(this)):void 0,options:this.image_align_options||(this.image_align_options=[{name:"Center",value:"align_center"},{name:"Left",value:"align_left"},{name:"Right",value:"align_right"}])})),label({className:"horiz_input"},span({className:"label_text"},"Fixed"),div({},input({type:"checkbox",name:this.props.input_name_prefix?this.props.input_name_prefix+"[attach]":void 0,value:"fixed",checked:"fixed"===((ref2=this.props.params)!=null?ref2.attach:void 0),onChange:this.props.on_change?this.set_attach||(this.set_attach=function(_this){return function(e){var attach;attach=e.target.checked?"fixed":null;return _this.update_params({attach:attach})}}(this)):void 0})))):void 0)}})})}).call(this);
