(function(){var extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty,bind=function(fn,me){return function(){return fn.apply(me,arguments)}};I.setup_layout=function(){$("#inner_column").max_height($("#admin_panel").outerHeight(true)||0);$(window).on("message",function(_this){return function(e){var message,origin;origin=new RegExp("\\/\\/"+$(document.body).data("host")+"\\/");if(!e.originalEvent.origin.match){return}message=e.originalEvent.data;switch(message.name){case"dimensions":return parent.postMessage({width:$(document).width(),height:$(document).height()},"*")}}}(this));return new I.ViewGameFooter("#view_game_footer")};I.EmbedGameLightbox=function(superClass){extend(EmbedGameLightbox,superClass);function EmbedGameLightbox(){return EmbedGameLightbox.__super__.constructor.apply(this,arguments)}return EmbedGameLightbox}(I.Lightbox);I.ViewGameFooter=function(){function ViewGameFooter(el){this.el=$(el);this.el.dispatch("click",{embed_game_btn:function(_this){return function(btn){return I.Lightbox.open_remote(btn.data("lightbox_url"),I.EmbedGameLightbox)}}(this),report_game_btn:function(_this){return function(btn){return I.Lightbox.open_remote_react(btn.data("lightbox_url"),function(props){return R.Game.ReportLightbox(props)})}}(this)})}return ViewGameFooter}();I.GameUserTools=function(){function GameUserTools(el){this.el=$(el);$(document.body).on("i:rating_updated",function(_this){return function(e,res){if(res.created){_this.el.find(".rate_game_btn").addClass("has_rating")}if(res.removed){return _this.el.find(".rate_game_btn").removeClass("has_rating")}}}(this));I.tracked_links(this.el,"view_game","user_tools");I.has_follow_button(this.el,{cls:"follow_user_btn",animate_follow:I.is_mobile()?"animate_popout":void 0});this.el.dispatch("click",{add_to_collection_btn:function(_this){return function(btn){if(!I.current_user){return"continue"}return I.Lightbox.open_remote(btn.attr("href"),I.CollectionLightbox)}}(this),rate_game_btn:function(_this){return function(btn){if(!I.current_user){return"continue"}return I.Lightbox.open_remote(btn.attr("href"),I.RateGameLightbox)}}(this)});setTimeout(function(_this){return function(){return _this.el.removeClass("hidden")}}(this),200)}return GameUserTools}();I.FirstGameLightbox=function(superClass){extend(FirstGameLightbox,superClass);function FirstGameLightbox(){this.first_show=bind(this.first_show,this);return FirstGameLightbox.__super__.constructor.apply(this,arguments)}FirstGameLightbox.prototype.first_show=function(){I.event("view_game","first_game_lb","show");I.add_facebook(function(_this){return function(){var cat;cat="view_game";FB.Event.subscribe("edge.create",function(url){return I.event(cat,"fb","like")});FB.Event.subscribe("edge.remove",function(url){return I.event(cat,"fb","unlike")});return FB.Event.subscribe("message.send",function(url){return I.event(cat,"fb","share")})}}(this));return I.add_twitter()};return FirstGameLightbox}(I.Lightbox);I.GameGoalBanner=function(){function GameGoalBanner(el){this.el=$(el);this.el.dispatch("click",{buy_btn:function(_this){return function(btn){I.event("view_game","goal_banner","contribute_btn");if(I.is_mobile()){btn.attr("href",I.add_params(btn.attr("href"),{initiator:"mobile"}));return"continue"}return $(".buy_row a.buy_btn").click()}}(this)})}return GameGoalBanner}()}).call(this);(function(){var bind=function(fn,me){return function(){return fn.apply(me,arguments)}};I.GameDevlogPost=function(){GameDevlogPost.prototype.vote_counts_template=I.lazy_template(GameDevlogPost,"like_button");function GameDevlogPost(el,opts){this.render_like_button=bind(this.render_like_button,this);this.el=$(el);this.image_viewer=new I.ImageViewer(el);this.el.dispatch("click",{add_to_collection_btn:function(_this){return function(btn){if(!I.current_user){return"continue"}return I.Lightbox.open_remote(btn.attr("href"),I.CollectionLightbox)}}(this)});this.render_like_button()}GameDevlogPost.prototype.render_like_button=function(s){var child,drop;drop=this.el.find(".like_button_drop");this.like_button_state||(this.like_button_state=drop.data("init"));if(s){$.extend(this.like_button_state,s)}child=drop.html(this.vote_counts_template(this.like_button_state)).children();return child.find("form").remote_submit(function(_this){return function(res){return _this.render_like_button({liked:!_this.like_button_state.liked,likes_count:res.likes_count})}}(this))};return GameDevlogPost}()}).call(this);(function(){var extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;I.GameHeader=function(superClass){extend(GameHeader,superClass);function GameHeader(){GameHeader.__super__.constructor.apply(this,arguments);this.el.dispatch("click",{edit_theme_btn:function(_this){return function(){return _this.toggle_theme_editor()}}(this)});if(window.location.hash.match(/\bedit_theme\b/)){_.defer(function(_this){return function(){return _this.toggle_theme_editor()}}(this))}}GameHeader.prototype.toggle_theme_editor=function(){var new_open;new_open=!I.theme_editor.state.open;I.theme_editor.setState({open:new_open});return $(document.body).toggleClass("theme_editor_open",new_open)};return GameHeader}(I.Header)}).call(this);(function(){var bind=function(fn,me){return function(){return fn.apply(me,arguments)}};I.HtmlEmbed=function(){HtmlEmbed.current=$.Deferred().done(function(){return window.addEventListener("popstate",function(e){var state;state=e.state||{};return I.HtmlEmbed.current.done(function(embed){return embed.synchronize_state(state)})})});HtmlEmbed.prototype.ping_time=1e3;function HtmlEmbed(el,opts){this.opts=opts;this.load_frame=bind(this.load_frame,this);this.el=$(el);if(I.HtmlEmbed.current.state()==="resolved"){I.HtmlEmbed.current=$.Deferred().resolve(this)}else{I.HtmlEmbed.current.resolve(this)}this.load_archive();if(window.history.state){this.synchronize_state(window.history.state)}if(this.opts.width){I.ViewGame.current.then(function(_this){return function(view){return view.fit_to_width(_this.opts.width)}}(this))}this.el.dispatch("click",{load_iframe_btn:function(_this){return function(btn){return _this.load_frame().done(function(frame){setTimeout(function(){var ref;return(ref=frame[0])!=null?ref.focus():void 0},100);if(I.is_mobile()){return _this.enter_fullscreen()}else if(_this.opts.start_maximized){return _this.enter_maximized()}})}}(this),fullscreen_btn:function(_this){return function(btn){return _this.enter_fullscreen()}}(this),restore_btn:function(_this){return function(btn){_this.load_frame().done(function(frame){return setTimeout(function(){var ref;return(ref=frame[0])!=null?ref.focus():void 0},100)});if(I.is_mobile()){return _this.enter_fullscreen()}else{return _this.enter_maximized()}}}(this)})}HtmlEmbed.prototype.synchronize_state=function(state){if(state.maximized){this.enter_maximized(false);return setTimeout(function(_this){return function(){var ref;return(ref=_this.el.find(".game_frame iframe")[0])!=null?ref.focus():void 0}}(this),100)}else{return this.exit_maximized()}};HtmlEmbed.prototype.load_archive=function(){if(!this.opts.load_url){return}return $.get(this.opts.load_url,function(_this){return function(res){if(res.html){_this.el.replaceWith(res.html);return}if(res.errors){_this.el.replaceWith($('<div class="missing_game"></div>').text(res.errors.join(", ")));return}switch(res.status){case"complete":return _this.el.closest(".view_game_page").addClass("ready");case"extracting":return setTimeout(function(){_this.ping_time+=100;return _this.load_archive()},_this.ping_time)}}}(this))};HtmlEmbed.prototype.mobile_orientation=function(){var ratio;if(this.opts.orientation){return this.opts.orientation}if(!(this.opts.width&&this.opts.height)){return"landscape"}ratio=this.opts.width/this.opts.height;if(ratio>=1.4){return"landscape"}else if(ratio<=1.7){return"portrait"}};HtmlEmbed.prototype.load_frame=function(){return this._loaded_frame||(this._loaded_frame=$.Deferred(function(_this){return function(d){var placeholder;placeholder=_this.el.find(".iframe_placeholder");placeholder.replaceWith(placeholder.data("iframe"));_this.iframe=_this.el.find("#game_drop");_this.el.find(".game_frame").addClass("game_loaded").removeClass("game_pending");return d.resolve(_this.iframe)}}(this)))};HtmlEmbed.prototype.enter_maximized=function(push_history){if(push_history==null){push_history=true}if(this.maximized){return}this.maximized=true;return this.load_frame().done(function(_this){return function(){if(window.history&&push_history){window.history.pushState({maximized:true},document.title)}_this.el.find(".game_frame").addClass("maximized");return $(document.body).addClass("frame_maximized")}}(this))};HtmlEmbed.prototype.exit_maximized=function(){if(!this.maximized){return}this.maximized=false;this.el.find(".game_frame").removeClass("maximized");return $(document.body).removeClass("frame_maximized")};HtmlEmbed.prototype.enter_fullscreen=function(){var frame,orientation;frame=this.el.find(".game_frame iframe");if(!frame[0]){return}orientation=this.mobile_orientation();if(I.is_fullscreen()){return}if(!I.request_fullscreen(frame[0],orientation)){return this.enter_maximized()}};return HtmlEmbed}()}).call(this);(function(){var bind=function(fn,me){return function(){return fn.apply(me,arguments)}};I.ImageViewer=function(){ImageViewer.prototype.margin=40;ImageViewer.prototype._template=function(){return'<div class="screenshot_lightbox lightbox loading">\n  <div class="screenshot_container">\n    <div class="loader"></div>\n\n    <div class="prev_image_btn">\n      <span class="icon-arrow-left"></span>\n    </div>\n\n    <img class="lb_screenshot hidden" width="400" height="315">\n\n    <div class="next_image_btn">\n      <span class="icon-arrow-right"></span>\n    </div>\n  </div>\n</div>'};ImageViewer.prototype.size_image=function(){};function ImageViewer(el){this.size_image=bind(this.size_image,this);this.el=$(el);this.el.on("click","[data-image_lightbox]",function(_this){return function(e){var all_links,current_image,goto_image,goto_next_image,goto_prev_image,lb,on_image_load,source_link;if(I.is_mobile()){return}if(!Image){return}source_link=$(e.currentTarget);all_links=source_link.parent().find("[data-image_lightbox]");I.event("view_game","screenshots","show");lb=I.Lightbox.open(_this._template(),I.CenterLighbox);lb.el.toggleClass("no_tools",all_links.length<2);current_image=null;on_image_load=function(image){var $window,ar,h,screenshot,w,window_height,window_width;current_image=image;$window=$(window);window_width=$window.width()-(_this.margin+20)*2;window_height=$window.height()-_this.margin*2;w=image.naturalWidth;h=image.naturalHeight;ar=w/h;if(w>window_width){w=window_width;h=window_width/ar}if(h>window_height){w=window_height*ar;h=window_height}screenshot=lb.el.find(".lb_screenshot");screenshot.attr("src",image.src);if(w!==image.naturalWidth||h!==image.naturalHeight){screenshot.attr("width",Math.floor(w)).attr("height",Math.floor(h))}else{screenshot.attr("width",image.naturalWidth).attr("height",image.naturalHeight)}lb.position();screenshot.removeClass("hidden");return lb.el.removeClass("loading")};goto_image=function(elem){var image;lb.el.addClass("loading");source_link=elem;image=new Image;image.onload=function(_this){return function(){return on_image_load(image)}}(this);return image.src=$(elem).attr("href")};goto_prev_image=function(){var prev;prev=source_link.prev("[data-image_lightbox]");if(!prev.length){prev=$(all_links[all_links.length-1])}return goto_image(prev)};goto_next_image=function(){var next;next=source_link.next("[data-image_lightbox]");if(!next.length){next=$(all_links[0])}return goto_image(next)};lb.el.dispatch("click",{lb_screenshot:function(btn){if(all_links.length<2){return I.Lightbox.close()}else{I.event("view_game","screenshots","click_screenshot");return goto_next_image()}},prev_image_btn:function(btn){I.event("view_game","screenshots","prev_image_btn");return goto_prev_image()},next_image_btn:function(btn){I.event("view_game","screenshots","next_image_btn");return goto_next_image()}});lb.el.on("i:lightbox_keydown",function(e,ke){switch(ke.keyCode){case 37:I.event("view_game","screenshots","keyboard_left");return goto_prev_image();case 39:I.event("view_game","screenshots","keyboard_right");return goto_next_image();case 32:I.event("view_game","screenshots","Keyboard_space");return goto_next_image()}});lb.el.on("i:lightbox_resize",function(){if(current_image){return on_image_load(current_image)}});goto_image(source_link);return false}}(this))}return ImageViewer}()}).call(this);(function(){var bind=function(fn,me){return function(){return fn.apply(me,arguments)}},extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;I.ViewGame=function(){ViewGame.current=$.Deferred();function ViewGame(el,game1,opts1){var form;this.game=game1;this.opts=opts1;this.setup_hiding=bind(this.setup_hiding,this);this.setup_buy_on_top=bind(this.setup_buy_on_top,this);this.register_play=bind(this.register_play,this);I.event2("view game",{type:this.game.type_name,paid:this.game.actual_price>0});I.ViewGame.current.resolve(this);I.tracked_links($(".jam_banner"),"view_game","jam_banner");form=$(".devlog_banner").find("form").remote_submit(function(_this){return function(res){return form.end().slideUp("fast")}}(this),null,[{name:"json",value:"1"}]);this.el=$(el);this.setup_uploads();this.setup_buy_on_top();I.tracked_links(this.el,"view_game","main_column");if(this.game.hit_url){$.get(this.game.hit_url)}if(this.game.play_url){this.register_play()}this.el.on("click mouseup",".launch_btn[data-rp]",function(_this){return function(e){var btn,rp;btn=$(e.currentTarget);if(rp=btn.data("rp")){btn.data("rp",null);if(!(typeof navigator!=="undefined"&&navigator!==null?typeof navigator.sendBeacon==="function"?navigator.sendBeacon(rp):void 0:void 0)){return $.get(rp)}}}}(this));this.el.dispatch("click",{add_to_collection_btn:function(_this){return function(btn){if(I.is_mobile()||!I.current_user){return"continue"}return I.Lightbox.open_remote(btn.attr("href"),I.CollectionLightbox)}}(this),toggle_info_btn:function(_this){return function(el){el.closest(".more_information_toggle").toggleClass("open");return _this.el.find(".info_panel_wrapper").slideToggle()}}(this),download_btn:function(_this){return function(btn){var opts;I.event("view_game","download",""+_this.game.id);opts={};if(!btn.closest(".for_demo").length){opts.after_download_lightbox=true}I.ConversionTracker.download("1:"+_this.game.id);I.ConversionTracker.flush_now();return _this.prepare_download(btn.data("upload_id"),function(url,res){if(res.lightbox){I.start_download(res);return I.Lightbox.open(res.lightbox,I.AfterDownloadLightbox,_this.game)}else{return window.location=url}},opts)}}(this),buy_btn:function(_this){return function(btn){I.event("view_game","buy",""+_this.game.id);if(I.is_mobile()){btn.attr("href",I.add_params(btn.attr("href"),{initiator:"mobile"}));return"continue"}return I.Lightbox.open_remote(btn.attr("href"),I.BuyGameLightbox,_this.game,{is_donate:false})}}(this),reward_btn:function(_this){return function(btn){var $quantity,$reward,href;I.event("view_game","buy_reward",""+_this.game.id);href=btn.attr("href");$reward=btn.closest(".reward_footer");$quantity=$reward.find(".quantity_input");if($quantity){href=I.add_params(href,{quantity:$quantity.val()})}return I.Lightbox.open_remote(href,I.BuyGameLightbox,_this.game,{is_donate:false})}}(this),donate_btn:function(_this){return function(btn){I.event("view_game","donate",""+_this.game.id);if(I.is_mobile()){btn.attr("href",I.add_params(btn.attr("href"),{initiator:"mobile"}));return"continue"}return I.Lightbox.open_remote(btn.attr("href"),I.BuyGameLightbox,_this.game,{is_donate:btn.data("donate")})}}(this)});this.image_viewer=new I.ImageViewer(el);this.setup_referrer();if(this.opts.first_view){I.Lightbox.open_tpl("first_game_lightbox",I.FirstGameLightbox)}}ViewGame.prototype.register_play=function(){return window.setTimeout(function(_this){return function(){return $.get(_this.game.play_url)}}(this),(this.game.play_after+3)*1e3)};ViewGame.prototype.prepare_download=function(upload_id,fn,params){if(params==null){params={}}return I.prepare_download(this.game.slug,upload_id,null,fn,params)};ViewGame.prototype.setup_buy_on_top=function(){var h;h=this.el.find(".formatted_description").outerHeight(true);if(h<$(window).height()-100){return this.el.removeClass("buy_on_top")}};ViewGame.prototype.setup_uploads=function(){var el,i,len,ref1,results,size;this.uploads=this.el.find(".uploads");ref1=this.uploads.find(".upload");results=[];for(i=0,len=ref1.length;i<len;i++){el=ref1[i];size=$(el).find(".file_size_value");results.push(size.html(_.str.formatBytes(parseInt(size.html()))))}return results};ViewGame.prototype.setup_hiding=function(el){$(document.body).on("i:lightbox_open",function(_this){return function(){return $(el).css({visibility:"hidden"})}}(this));return $(document.body).on("i:lightbox_close",function(_this){return function(){return $(el).css({visibility:"visible"})}}(this))};ViewGame.prototype.fit_to_width=function(width){if(!(width>920)){return}if(this.opts.responsive||I.is_mobile()){return $("#inner_column").css({width:"auto",maxWidth:width+"px"})}else{return $("#inner_column").css({width:width+"px",maxWidth:width+"px"})}};ViewGame.prototype.setup_referrer=function(){var host,ref;if(I.ReferrerTracker.has_ref("game",this.game.id)){return}host=$(document.body).data("host");ref=document.referrer;if(!ref){return}if(ref.indexOf(host)>=0){return}return I.ReferrerTracker.push("game",this.game.id,"game:"+ref)};return ViewGame}();I.ViewFlashGame=function(superClass){extend(ViewFlashGame,superClass);function ViewFlashGame(el,game,swf,opts){this.swf=swf;ViewFlashGame.__super__.constructor.call(this,el,game,opts);this.embed_game();this.setup_hiding("#swf_drop")}ViewFlashGame.prototype.get_size=function(fn){return $.get("/"+this.game.slug+"/swf_size/"+this.swf.id,function(_this){return function(res){_this.swf.data.swf=res.swf;return typeof fn==="function"?fn():void 0}}(this))};ViewFlashGame.prototype.embed_game=function(skip_remote){var flash_version,height,ref1,width;if(!this.swf){return}if(!this.swf.data.swf&&!skip_remote){return this.get_size(function(_this){return function(){return _this.embed_game(true)}}(this))}ref1=this.swf.data.swf,width=ref1.width,height=ref1.height;flash_version=swfobject.getFlashPlayerVersion();if((flash_version!=null?flash_version.major:void 0)===0&&!window.location.hash.match(/\bforce_flash\b/)){this.el.addClass("ready no_flash");return $(document.body).addClass("embed_disabled")}else{swfobject.embedSWF(this.swf.url,"swf_drop",width,height,"11.0.0",false,{},{wmode:"direct",allowfullscreen:"true"});this.swf_drop=$("#swf_drop");this.swf_drop.parent().width(width).height(height);this.fit_to_width(width);return this.el.addClass("ready")}};return ViewFlashGame}(I.ViewGame);I.ViewUnityGame=function(superClass){extend(ViewUnityGame,superClass);function ViewUnityGame(el,game,unity1,opts){this.unity=unity1;ViewUnityGame.__super__.constructor.call(this,el,game,opts);this.embed_game();this.setup_hiding("#unity_drop embed")}ViewUnityGame.prototype.embed_game=function(){var drop,track_unity,unity,width;if(!this.unity){return}drop=$("#unity_drop");width=drop.width();if(width>920){$("#inner_column").width(width+40)}unity=new UnityObject2({params:{disableContextMenu:true}});track_unity=_.once(function(status){return I.event("view_game","unity",""+status)});unity.observeProgress(function(_this){return function(progress){track_unity(progress.pluginStatus);if(progress.pluginStatus==="unsupported"){drop.width("").height("");$("#inner_column").width("");return _this.el.addClass("unity_unsupported")}else{return $(document.body).removeClass("responsive")}}}(this));return unity.initPlugin(drop[0],this.unity.url)};return ViewUnityGame}(I.ViewGame);I.ViewJavaGame=function(superClass){extend(ViewJavaGame,superClass);function ViewJavaGame(el,game,jar,opts){this.jar=jar;this.setup_hiding("#jar_drop applet");ViewJavaGame.__super__.constructor.call(this,el,game,opts)}return ViewJavaGame}(I.ViewGame);I.ViewHtmlGame=function(superClass){extend(ViewHtmlGame,superClass);function ViewHtmlGame(){return ViewHtmlGame.__super__.constructor.apply(this,arguments)}return ViewHtmlGame}(I.ViewGame)}).call(this);(function(){var bind=function(fn,me){return function(){return fn.apply(me,arguments)}},extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;I.CommunityArchiveTopicLightbox=function(superClass){extend(CommunityArchiveTopicLightbox,superClass);function CommunityArchiveTopicLightbox(){this.init=bind(this.init,this);return CommunityArchiveTopicLightbox.__super__.constructor.apply(this,arguments)}CommunityArchiveTopicLightbox.prototype.init=function(){var form;this.with_redactor(function(_this){return function(){return I.redactor(_this.el.find("textarea"),{minHeight:100,source:false})}}(this));return form=this.el.find("form").remote_submit(function(_this){return function(res){form.set_form_errors(res.errors);if(res.errors){return}return window.location.reload()}}(this))};return CommunityArchiveTopicLightbox}(I.Lightbox)}).call(this);(function(){var bind=function(fn,me){return function(){return fn.apply(me,arguments)}},extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;I.CommunityBanLightbox=function(superClass){extend(CommunityBanLightbox,superClass);function CommunityBanLightbox(){this.init=bind(this.init,this);return CommunityBanLightbox.__super__.constructor.apply(this,arguments)}CommunityBanLightbox.prototype.init=function(){var form;this.with_redactor(function(_this){return function(){return I.redactor(_this.el.find("textarea"),{minHeight:100,source:false})}}(this));return form=this.el.find("form").remote_submit(function(_this){return function(res){form.set_form_errors(res.errors);if(res.errors){return}return _this.el.addClass("after_ban")}}(this))};return CommunityBanLightbox}(I.Lightbox)}).call(this);(function(){I.CommunityCategory=function(){function CommunityCategory(el){this.el=$(el)}return CommunityCategory}()}).call(this);(function(){I.CommunityCategoryBans=function(){function CommunityCategoryBans(el){this.el=$(el);this.el.remote_link(function(_this){return function(res){if(res.errors){alert(res.errors.join("\n"));return}return window.location.reload()}}(this))}return CommunityCategoryBans}()}).call(this);(function(){I.CommunityCategoryModerators=function(){function CommunityCategoryModerators(el){this.el=$(el);this.el.remote_link(function(_this){return function(res,el){if(res.return_to){return window.location=res.return_to}}}(this))}return CommunityCategoryModerators}()}).call(this);(function(){I.CommunityProfile=function(){function CommunityProfile(el,opts){var c;this.el=$(el);new I.FilterPickers(this.el);this.carousels=function(){var i,len,ref,results;ref=this.el.find(".game_carousel_widget");results=[];for(i=0,len=ref.length;i<len;i++){c=ref[i];results.push(new I.GameCarousel($(c)))}return results}.call(this);new I.CommunityViewTopic(this.el.find(".recent_posts"),opts)}return CommunityProfile}()}).call(this);(function(){I.CommunityEditCategory=function(){function CommunityEditCategory(el){var form;this.el=$(el);this.setup_tag_editor();form=this.el.find("form").remote_submit(function(_this){return function(res){if(res.errors){form.set_form_errors(res.errors);return}if(res.redirect_to){return window.location=res.redirect_to}}}(this))}CommunityEditCategory.prototype.setup_tag_editor=function(){var tag_editor,tags;tag_editor=this.el.find(".category_tag_editor");if(!tag_editor.length){return}tags=tag_editor.data("tags");return ReactDOM.render(R.Community.CategoryEditTags({tags:tags}),tag_editor[0])};return CommunityEditCategory}()}).call(this);(function(){var bind=function(fn,me){return function(){return fn.apply(me,arguments)}},extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;I.CommunityLockTopicLightbox=function(superClass){extend(CommunityLockTopicLightbox,superClass);function CommunityLockTopicLightbox(){this.init=bind(this.init,this);return CommunityLockTopicLightbox.__super__.constructor.apply(this,arguments)}CommunityLockTopicLightbox.prototype.init=function(){var form;this.with_redactor(function(_this){return function(){return I.redactor(_this.el.find("textarea"),{minHeight:100,source:false})}}(this));return form=this.el.find("form").remote_submit(function(_this){return function(res){form.set_form_errors(res.errors);if(res.errors){return}return window.location.reload()}}(this))};return CommunityLockTopicLightbox}(I.Lightbox)}).call(this);(function(){I.CommunityNewTopic=function(){function CommunityNewTopic(el,opts){var form;this.el=$(el);try{this.el.find("input[name=offset]").val((new Date).getTimezoneOffset())}catch(error){}this.set_fingerprint();form=this.el.find("form").remote_submit(function(_this){return function(res){if(res.errors){if(I.add_recaptcha_if_necessary(form,res.errors)){return}form.set_form_errors(res.errors);return}if(res.redirect_to){return window.location=res.redirect_to}}}(this))}CommunityNewTopic.prototype.set_fingerprint=function(){if(!window.Fingerprint2){return false}this.set_fingerprint=function(){};return(new Fingerprint2).get(function(_this){return function(res){if(res){return _this.el.find("input[name=bfp]").val(res)}}}(this))};return CommunityNewTopic}()}).call(this);(function(){I.CommunityPostForm=function(){function CommunityPostForm(el,opts){var form;if(opts==null){opts={}}this.el=$(el);form=this.el.find("form").remote_submit(function(_this){return function(res){if(res.errors){if(I.add_recaptcha_if_necessary(form,res.errors)){return}form.set_form_errors(res.errors);return}if(res.redirect_to){window.location=res.redirect_to}if(res.flash){return I.flash(res.flash)}}}(this))}return CommunityPostForm}()}).call(this);(function(){var bind=function(fn,me){return function(){return fn.apply(me,arguments)}},extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;I.CommunityReportPostLightbox=function(superClass){extend(CommunityReportPostLightbox,superClass);function CommunityReportPostLightbox(){this.init=bind(this.init,this);return CommunityReportPostLightbox.__super__.constructor.apply(this,arguments)}CommunityReportPostLightbox.prototype.init=function(){var form;return form=this.el.find("form").remote_submit(function(_this){return function(res){if(res.errors){form.set_form_errors(res.errors);return}return _this.el.addClass("submitted_report")}}(this))};return CommunityReportPostLightbox}(I.Lightbox)}).call(this);(function(){var bind=function(fn,me){return function(){return fn.apply(me,arguments)}},extend=function(child,parent){for(var key in parent){if(hasProp.call(parent,key))child[key]=parent[key]}function ctor(){this.constructor=child}ctor.prototype=parent.prototype;child.prototype=new ctor;child.__super__=parent.prototype;return child},hasProp={}.hasOwnProperty;I.CommunityStickTopicLightbox=function(superClass){extend(CommunityStickTopicLightbox,superClass);function CommunityStickTopicLightbox(){this.init=bind(this.init,this);return CommunityStickTopicLightbox.__super__.constructor.apply(this,arguments)}CommunityStickTopicLightbox.prototype.init=function(){var form;this.with_redactor(function(_this){return function(){return I.redactor(_this.el.find("textarea"),{minHeight:100,source:false})}}(this));return form=this.el.find("form").remote_submit(function(_this){return function(res){form.set_form_errors(res.errors);if(res.errors){return}return window.location.reload()}}(this))};return CommunityStickTopicLightbox}(I.Lightbox)}).call(this);(function(){var bind=function(fn,me){return function(){return fn.apply(me,arguments)}};I.CommunityTopicHeader=function(){function CommunityTopicHeader(el,opts){var moderation;this.opts=opts;this.render_topic_voter=bind(this.render_topic_voter,this);this.el=$(el);moderation=this.el.find(".moderation_tools");if(moderation.length){new I.CommunityTopicModerationTools(moderation,this.opts.moderation)}this.render_topic_voter()}CommunityTopicHeader.prototype.render_topic_voter=function(){var props,ref,voter;if(!(typeof R!=="undefined"&&R!==null?(ref=R.Community)!=null?ref.TopicVoter:void 0:void 0)){return}voter=this.el.find(".community_topic_voter_widget");if(!voter.length){return}props=voter.data("p");props.vote_url=this.opts.vote_url;return ReactDOM.render(R.Community.TopicVoter(props),voter[0])};return CommunityTopicHeader}()}).call(this);(function(){I.CommunityTopicList=function(){function CommunityTopicList(el,opts){this.opts=opts;this.el=$(el);new I.CommunityTopicModerationTools(el,this.opts);this.el.lazy_images({selector:"[data-background_image]"});this.render_topic_voters();this.el.has_tooltips();new I.GamePopups(this.el)}CommunityTopicList.prototype.render_topic_voters=function(){var i,len,props,ref,ref1,results,voter;if(!(typeof R!=="undefined"&&R!==null?(ref=R.Community)!=null?ref.TopicVoter:void 0:void 0)){return}ref1=this.el.find(".community_topic_voter_widget");results=[];for(i=0,len=ref1.length;i<len;i++){voter=ref1[i];props=$(voter).data("p");props.vote_url=this.opts.vote_url;results.push(ReactDOM.render(R.Community.TopicVoter(props),voter))}return results};return CommunityTopicList}()}).call(this);(function(){var bind=function(fn,me){return function(){return fn.apply(me,arguments)}};I.CommunityTopicModerationTools=function(){CommunityTopicModerationTools.prototype.topic_url=function(route,topic_id){return this.opts.urls[route].replace(/:topic_id\b/,topic_id)};function CommunityTopicModerationTools(el,opts){this.opts=opts;this.topic_url=bind(this.topic_url,this);this.el=$(el);new I.FilterPickers(el);this.el.on("click",".filter_option",function(_this){return function(e){var target,topic_id,value;target=$(e.currentTarget).trigger("i:close_filter_pickers");topic_id=target.closest("[data-topic_id]").data("topic_id");value=target!=null?target.data("value"):void 0;switch(value){case"purge":e.preventDefault();if(confirm("This will delete all the users posts and spam their account. No undo. Are you sure?")){return $.post($(e.currentTarget).attr("href"),I.with_csrf()).done(function(res){if(res.errors){alert(res.errors.join(","));return}if(res.redirect_to){return window.location=res.redirect_to}})}break;case"feature":case"unfeature":case"bump":e.preventDefault();return $.post($(e.currentTarget).attr("href"),I.with_csrf()).done(function(res){if(res.errors){alert(res.errors.join(","));return}if(res.redirect_to){return window.location=res.redirect_to}});case"archive":case"unarchive":e.preventDefault();return I.Lightbox.open_remote(_this.topic_url("archive_topic",topic_id),I.CommunityArchiveTopicLightbox);case"lock":case"unlock":e.preventDefault();return I.Lightbox.open_remote(_this.topic_url("lock_topic",topic_id),I.CommunityLockTopicLightbox);case"stick":case"unstick":e.preventDefault();return I.Lightbox.open_remote(_this.topic_url("stick_topic",topic_id),I.CommunityStickTopicLightbox);case"delete":e.preventDefault();if(confirm("Are you sure you want to delete this topic?")){return $.ajax({url:_this.topic_url("delete_topic",topic_id),data:I.with_csrf(),type:"post",xhrFields:{withCredentials:true}}).done(function(res){if(res.errors){return alert(res.errors.join())}return window.location.reload()})}}}}(this))}return CommunityTopicModerationTools}()}).call(this);(function(){var bind=function(fn,me){return function(){return fn.apply(me,arguments)}};I.CommunityViewTopic=function(){CommunityViewTopic.prototype.vote_counts_template=I.lazy_template(CommunityViewTopic,"vote_counts");function CommunityViewTopic(el,opts){this.opts=opts;this.update_votes=bind(this.update_votes,this);this.el=$(el);this.el.remote_link(function(_this){return function(res,el){if(el.is(".vote_btn")){if(res.errors){alert(res.errors.join(", "));return}_this.update_votes(el,res);return}if(res.redirect_to){return window.location=res.redirect_to}}}(this));this.el.dispatch("click",{ban_user_btn:function(_this){return function(btn){var ban_url,post;post=btn.closest(".community_post").data("post");ban_url=_this.opts.ban_url+("?banned_user_id="+post.user_id);return I.Lightbox.open_remote(ban_url,I.CommunityBanLightbox)}}(this),stick_topic_btn:function(_this){return function(btn){return I.Lightbox.open_remote(btn.data("href"),I.CommunityStickTopicLightbox)}}(this),lock_topic_btn:function(_this){return function(btn){return I.Lightbox.open_remote(btn.data("href"),I.CommunityLockTopicLightbox)}}(this),report_post_btn:function(_this){return function(btn){var post,url;post=btn.closest(".community_post").data("post");url=_this.opts.report_url.replace(/:post_id/,post.id);return I.Lightbox.open_remote(url,I.CommunityReportPostLightbox)}}(this),embed_preload:function(_this){return function(btn){var code;if(btn[0].hasAttribute("itchio")){code=btn.data("embed_code");return btn.replaceWith(code)}}}(this)})}CommunityViewTopic.prototype.update_votes=function(el,res){var i,len,like_button,post,v,voters;post=el.closest(".community_post");voters=post.find(".vote_btn");like_button=voters.filter(".post_action");like_button.removeClass("animate_bounce animate_drop_down");setTimeout(function(_this){return function(){return like_button.removeClass("animate_bounce animate_drop_down")}}(this),500);if(el.is(".voted")){_.defer(function(_this){return function(){return like_button.addClass("animate_drop_down")}}(this));el.removeClass("voted")}else{_.defer(function(_this){return function(){return like_button.addClass("animate_bounce")}}(this));voters.removeClass("voted").filter(el).addClass("voted")}for(i=0,len=voters.length;i<len;i++){v=voters[i];v=$(v);if(v.is(".voted")){v.data("params").action="remove"}else{delete v.data("params").action}}return post.find(".vote_counts").html(this.vote_counts_template({up_score:res.up_score+Math.max(0,res.score_adjustment),down_score:res.down_score+Math.abs(Math.min(0,res.score_adjustment))}))};return CommunityViewTopic}()}).call(this);(function(){var EMPTY,is_different,translation_component_cache,hasProp={}.hasOwnProperty,slice=[].slice;if(window.R){return}EMPTY={};is_different=function(a,b){var key;for(key in a){if(!hasProp.call(a,key))continue;if(a[key]!==b[key]){return true}}for(key in b){if(!hasProp.call(b,key))continue;if(!(key in a)){return true}}return false};translation_component_cache={};window.R=function(name,data,p,prefix){var cl,class_name,default_props,prop_types;if(p==null){p=R}if(prefix==null){prefix=""}if(p[name]){return p[name]._class}data.trigger=function(){var node;node=$(ReactDOM.findDOMNode(this));R.trigger.apply(R,[node].concat(slice.call(arguments)));return void 0};data.dispatch=function(){var node;node=$(ReactDOM.findDOMNode(this));R.dispatch.apply(R,[node].concat(slice.call(arguments)));return void 0};data.container=function(){return $(ReactDOM.findDOMNode(this))};data.extend_props=function(){var more;more=1<=arguments.length?slice.call(arguments,0):[];return $.extend.apply($,[{},this.props].concat(slice.call(more)))};data.tt=function(key,props){var text;if(props==null){props=EMPTY}if(text=I.i18n.fetch_key_sync(key)){if(_.isString(text)){return text}}translation_component_cache[key]||(translation_component_cache[key]=I.i18n.react_class(key));return React.createElement(translation_component_cache[key],props)};data.t=function(key,variables){if(I.i18n.fetch_key_sync(key)){return I.i18n.t_sync(key,variables)}else{I.i18n.fetch_key(key).done(function(_this){return function(){if(_this.isMounted()){return _this.forceUpdate()}}}(this));return"…"}};class_name=_.once(function(){return(""+prefix+name).replace(/[A-Z]/g,"_$&").replace(/\./g,"_").replace(/__+/g,"_").replace(/^_+/,"").replace(/_+$/,"").toLowerCase()+"_widget"});data.enclosing_class_name=class_name;data.enclose=function(){var args,component,props;props=arguments[0],args=2<=arguments.length?slice.call(arguments,1):[];component=props.component||"div";delete props.component;return React.createElement.apply(React,[component,$.extend({},props,{className:classNames(class_name(),props.className)})].concat(slice.call(args)))};data.displayName=""+prefix+name;if(data.pure){data.shouldComponentUpdate=function(nextProps,nextState){return is_different(this.props||EMPTY,nextProps)||is_different(this.state||EMPTY,nextState)}}default_props=data.getDefaultProps;delete data.getDefaultProps;prop_types=data.propTypes;delete data.propTypes;cl=createReactClass(data);if(default_props){cl.defaultProps=default_props()}if(prop_types){cl.propTypes=prop_types}p[name]=React.createFactory(cl);return p[name]._class=cl};R.scope_event_name=function(name){return"itch:"+name};R.trigger=function(){var args,name,node;node=arguments[0],name=arguments[1],args=3<=arguments.length?slice.call(arguments,2):[];return node.trigger(R.scope_event_name(name),slice.call(args))};R.dispatch=function(node,prefix,event_table){var event_name,fn,results;if(typeof prefix==="object"){event_table=prefix;prefix=false}results=[];for(event_name in event_table){if(!hasProp.call(event_table,event_name))continue;fn=event_table[event_name];if(prefix){event_name=prefix+":"+event_name}results.push(node.on(R.scope_event_name(event_name),fn))}return results};R.component=function(){return R.apply(null,arguments)};R.is_different=is_different;R["package"]=function(_this){return function(prefix){var p;p=R[prefix]||(R[prefix]=function(name,data){data.Package=p;return R.component(name,data,p,prefix+".")});p.component=function(){return p.apply(null,arguments)};return p}}(this)}).call(this);(function(){I.libs.react.done(function(){var P,_rdf,a,br,button,code,div,em,fieldset,form,fragment,h1,h2,h3,h4,h5,h6,iframe,img,input,label,legend,li,ol,optgroup,option,p,pre,section,select,span,strong,textarea,types,ul;_rdf=ReactDOMFactories;div=_rdf.div,span=_rdf.span,a=_rdf.a,br=_rdf.br,p=_rdf.p,ol=_rdf.ol,ul=_rdf.ul,li=_rdf.li,strong=_rdf.strong,em=_rdf.em,img=_rdf.img,form=_rdf.form,label=_rdf.label,input=_rdf.input,textarea=_rdf.textarea,button=_rdf.button,iframe=_rdf.iframe,h1=_rdf.h1,h2=_rdf.h2,h3=_rdf.h3,h4=_rdf.h4,h5=_rdf.h5,h6=_rdf.h6,pre=_rdf.pre,code=_rdf.code,select=_rdf.select,option=_rdf.option,section=_rdf.section,optgroup=_rdf.optgroup,fieldset=_rdf.fieldset,legend=_rdf.legend;fragment=React.createFactory(React.Fragment);P=R["package"]("Index");types=PropTypes;P("LazyImage",{pure:true,propTypes:{src:types.string,src_set:types.string,width:types.number,height:types.number},getInitialState:function(){return{visible:false}},componentDidMount:function(){var el;el=ReactDOM.findDOMNode(this);return this.unbind_lazy_images=$(el).lazy_images({elements:[el],show_images:function(_this){return function(){var base;_this.setState({visible:true});return typeof(base=_this.props).on_reveal==="function"?base.on_reveal():void 0}}(this)})},componentWillUnmount:function(){return typeof this.unbind_lazy_images==="function"?this.unbind_lazy_images():void 0},render:function(){var ref,ref1;return img({className:classNames(this.props["class"],this.props.className,{lazy_loaded:this.state.loaded,lazy_visible:this.state.visible}),alt:this.props.alt,width:this.state.loaded?this.props.width:(ref=this.props.initial_width)!=null?ref:this.props.width,height:this.state.loaded?this.props.height:(ref1=this.props.initial_height)!=null?ref1:this.props.height,src:this.state.visible?this.props.src:void 0,srcSet:this.state.visible?this.props.src_set:void 0,onLoad:this.state.visible&&!this.state.loaded?function(_this){return function(){var base;_this.setState({loaded:true});return typeof(base=_this.props).on_load==="function"?base.on_load():void 0}}(this):void 0})}})})}).call(this);(function(){I.libs.react.done(function(){var P,_rdf,a,br,button,code,div,em,fieldset,form,fragment,h1,h2,h3,h4,h5,h6,iframe,img,input,label,legend,li,ol,optgroup,option,p,pre,section,select,span,strong,textarea,types,ul,hasProp={}.hasOwnProperty,indexOf=[].indexOf||function(item){for(var i=0,l=this.length;i<l;i++){if(i in this&&this[i]===item)return i}return-1};_rdf=ReactDOMFactories;div=_rdf.div,span=_rdf.span,a=_rdf.a,br=_rdf.br,p=_rdf.p,ol=_rdf.ol,ul=_rdf.ul,li=_rdf.li,strong=_rdf.strong,em=_rdf.em,img=_rdf.img,form=_rdf.form,label=_rdf.label,input=_rdf.input,textarea=_rdf.textarea,button=_rdf.button,iframe=_rdf.iframe,h1=_rdf.h1,h2=_rdf.h2,h3=_rdf.h3,h4=_rdf.h4,h5=_rdf.h5,h6=_rdf.h6,pre=_rdf.pre,code=_rdf.code,select=_rdf.select,option=_rdf.option,section=_rdf.section,optgroup=_rdf.optgroup,fieldset=_rdf.fieldset,legend=_rdf.legend;fragment=React.createFactory(React.Fragment);P=R["package"]("Community");types=PropTypes;P("PostLiker",{pure:true,getDefaultProps:function(){return{animation_duration:500}},componentDidCatch:function(error,info){return I.event("error","react","Community.PostLiker")},componentWillUnmount:function(){if(this.animation_timer){window.clearTimeout(this.animation_timer);return this.animation_timer=null}},componentDidUpdate:function(_,prev_state){var ref1;if(((ref1=this.state)!=null?ref1.animation:void 0)&&(prev_state!=null?prev_state.animation:void 0)!==this.state.animation){return this.animation_timer=window.setTimeout(function(_this){return function(){return _this.setState({animation:null})}}(this),this.props.animation_duration)}},like:function(){var animation,future_animation,params,ref1,ref2;params={direction:"up"};if((ref1=this.props.vote)!=null?ref1.positive:void 0){params.action="remove"}animation=params.action==="remove"?"animate_drop_down":"animate_bounce";if((ref2=this.state)!=null?ref2.animation:void 0){future_animation=animation;_.defer(function(_this){return function(){return _this.setState({animation:future_animation})}}(this));animation=null}this.setState({loading:true,pending_vote:params.action!=="remove",animation:animation});return $.ajax({type:"POST",dataType:"json",url:this.props.urls.vote_url({id:this.props.post_id}),data:I.with_csrf(params),xhrFields:{withCredentials:true}}).done(function(_this){return function(res){var base;_this.setState({loading:false,pending_vote:void 0});return typeof(base=_this.props).on_vote==="function"?base.on_vote(res):void 0}}(this)).error(function(_this){return function(xhr){var res;_this.setState({loading:false});res=function(){try{return JSON.parse(xhr.responseText)}catch(error1){}}();if(res!=null?res.errors:void 0){_this.setState({pending_vote:null})}if(res!=null?res.login_url:void 0){return window.location=res.login_url}}}(this))},render:function(){var ref1,ref2,ref3,ref4,ref5;if(!this.props.current_user){return this.enclose({component:"a",className:classNames("post_action vote_btn",this.props.classNames),href:this.props.login_url,target:"_blank"},R.Icons.TriUp," ",this.tt("community.post_list.like"))}return this.enclose({component:"button",type:"button",className:classNames("post_action vote_btn",(ref1=this.state)!=null?ref1.animation:void 0,this.props.classNames,{loading:(ref2=this.state)!=null?ref2.loading:void 0,voted:(ref3=(ref4=this.state)!=null?ref4.pending_vote:void 0)!=null?ref3:(ref5=this.props.vote)!=null?ref5.positive:void 0}),onClick:this.on_click||(this.on_click=function(_this){return function(e){e.preventDefault();return _this.like()}}(this))},R.Icons.TriUp," ",this.tt("community.post_list.like"))}});P("PostVoter",{pure:true,propTypes:{urls:types.object,post_id:types.number,vote:types.object},componentDidCatch:function(error,info){return I.event("error","react","Community.PostVoter")},vote:function(dir){var params,ref1,ref2;if((ref1=this.state)!=null?ref1.loading:void 0){return}params={direction:dir};if(dir==="up"&&((ref2=this.props.vote)!=null?ref2.positive:void 0)){params.action="remove"}if(dir==="down"&&this.props.vote&&!this.props.vote.positive){params.action="remove"}this.setState({loading:true});return $.ajax({type:"POST",url:this.props.urls.vote_url({id:this.props.post_id}),data:I.with_csrf(params),dataType:"json",xhrFields:{withCredentials:true}}).done(function(_this){return function(res){var base;_this.setState({loading:false});return typeof(base=_this.props).on_vote==="function"?base.on_vote(res):void 0}}(this)).error(function(_this){return function(xhr){var res;_this.setState({loading:false});res=function(){try{return JSON.parse(xhr.responseText)}catch(error1){}}();if(res!=null?res.login_url:void 0){return window.location=res.login_url}}}(this))},render:function(){var ref1;return this.enclose({className:classNames("post_votes",{loading:(ref1=this.state)!=null?ref1.loading:void 0})},this.props.current_user?button({type:"button",disabled:this.props.disabled,className:classNames("vote_up_btn vote_btn",{voted:this.props.vote&&this.props.vote.positive}),onClick:this.on_vote_up||(this.on_vote_up=function(_this){return function(){return _this.vote("up")}}(this))},R.Icons.TriUp):a({className:"vote_up_btn vote_btn",target:"_blank",rel:"nofollow",href:this.props.login_url},R.Icons.TriUp),this.props.current_user?button({type:"button",disabled:this.props.disabled,className:classNames("vote_down_btn vote_btn",{voted:this.props.vote&&!this.props.vote.positive}),onClick:this.on_vote_down||(this.on_vote_down=function(_this){return function(){return _this.vote("down")}}(this))},R.Icons.TriDown):a({className:"vote_down_btn vote_btn",target:"_blank",rel:"nofollow",href:this.props.login_url},R.Icons.TriDown))}});P("PostBody",{pure:true,getDefaultProps:function(){return{max_height:300}},componentDidMount:function(){return _.defer(function(_this){return function(){var buffer,images;images=$(_this.wrapper_ref.current).find("img").on("load",function(){return _this.refresh_sizes()});buffer=!images.length?50:void 0;return _this.refresh_sizes(buffer)}}(this))},reveal:function(){return this.setState({open:true,has_more:false})},on_click:function(e){var embed,ref1,ref2;if((ref1=this.state)!=null?ref1.has_more:void 0){this.reveal()}embed=$(e.target).closest(".embed_preload");if(embed.length){code=embed.data("embed_code");embed.replaceWith(code);if(!((ref2=this.state)!=null?ref2.open:void 0)){return this.setState({open:true})}}},refresh_sizes:function(buffer){var total_height;if(!this.wrapper_ref.current){return}total_height=this.wrapper_ref.current.scrollHeight;if(total_height>this.props.max_height){this.setState({has_more:true})}if(buffer){if(total_height<this.props.max_height+buffer){return this.setState({open:true,has_more:false})}}},render:function(){var ref1,ref2,style;style=!((ref1=this.state)!=null?ref1.open:void 0)?{overflowY:"hidden",maxHeight:this.props.max_height+"px"}:void 0;return fragment({},div({className:"post_body user_formatted",ref:this.wrapper_ref||(this.wrapper_ref=React.createRef()),style:style,onClick:this.on_click,dangerouslySetInnerHTML:{__html:this.props.body_html}}),((ref2=this.state)!=null?ref2.has_more:void 0)?button({type:"button",onClick:this.reveal,className:"reveal_full_post_btn"},"View rest ↓"):void 0)}});P("Post",{pure:true,edit_post:function(update){return this.props.edit_post(this.props.post,update)},is_redacted:function(){var post,ref1,ref2,ref3,user;post=this.props.post;user=this.props.post.user;if(post.deleted||((ref1=post.user)!=null?ref1.deleted:void 0)){return true}else if(((ref2=post.user)!=null?ref2.suspended:void 0)||post.blocked){return!((ref3=this.state)!=null?ref3.show_blocked:void 0)}else{return false}},render:function(){var post,ref1;post=this.props.post;return fragment({},this.render_current_post(),((ref1=post.replies)!=null?ref1.length:void 0)?this.render_children():post.view_replies_url?div({className:"view_more_replies"},a({href:post.view_replies_url,className:"button outline forward_link"},this.tt("community.post_list.view_more_in_thread"))):void 0)},render_children:function(){var post;post=this.props.post;return div({className:classNames("community_post_replies",{top_level_replies:post.depth===1})},post.replies.map(function(_this){return function(post,idx){return P.Post({key:post.id,readonly:_this.props.readonly,idx:idx,post:post,current_user:_this.props.current_user,edit_post:_this.edit_child_post||(_this.edit_child_post=function(post,update){var _post;return _this.edit_post({replies:function(){var i,len,ref1,results;ref1=this.props.post.replies;results=[];for(i=0,len=ref1.length;i<len;i++){_post=ref1[i];if(_post===post){if(update==="remove"){continue}results.push($.extend({},post,update))}else{results.push(_post)}}return results}.call(_this)})}),urls:_this.props.urls,reply_form_params:_this.props.reply_form_params})}}(this)))},update_vote:function(vote){var down_adjust,score_adjustment,up_adjust;score_adjustment=vote.score_adjustment||0;up_adjust=Math.max(score_adjustment,0);down_adjust=Math.min(score_adjustment,0);return this.edit_post({up_votes:vote.up_score+up_adjust,down_votes:vote.down_score-down_adjust,vote:vote.score_adjustment?{positive:vote.score_adjustment>0}:null})},delete_post:function(type){var delete_url,msg,params,post,ref1;if(type==null){type=null}post=this.props.post;msg=type==="hard"?"Purging post will delete it permanently, along with any replies. Continue?":"Are you sure you want to delete this post?";if(!confirm(msg)){return}if((ref1=this.state)!=null?ref1.deleting:void 0){return}this.setState({deleting:true});delete_url=this.props.urls.delete_url({id:post.id});params={};if(type==="hard"){params.hard="1"}return $.ajax({type:"POST",url:delete_url,data:I.with_csrf(params),dataType:"json",xhrFields:{withCredentials:true}}).done(function(_this){return function(res){return _this.edit_post({deleted:true,hard_deleted:res.type==="hard"})}}(this)).always(function(_this){return function(){return _this.setState({deleting:false})}}(this))},render_current_post_contents:function(){var avatar,base,base1,base2,post,ref1,ref2,ref3,ref4,ref5,ref6,ref7,user;post=this.props.post;user=this.props.post.user;avatar=R.Index.LazyImage({className:"post_avatar",width:25,height:25,src:user.avatar_url,src_set:user.avatar_url2x?user.avatar_url+" 1x, "+user.avatar_url2x+" 2x":void 0});return(post.just_added?R.SlideDown:div)({className:"post_grid"},post.vote_types==="ud"?P.PostVoter({post_id:post.id,vote:post.vote,disabled:this.is_redacted(),urls:this.props.urls,on_vote:this.update_vote,current_user:this.props.current_user,login_url:typeof(base=this.props.urls).login_url==="function"?base.login_url():void 0}):void 0,user.url?a({href:user.url,className:"avatar_container"},avatar):div({className:"avatar_container"},avatar),div({className:"post_header"},span({className:"post_author"},post.deleted?span({className:"name_placeholder"},"Deleted post"):user.deleted?span({className:"name_placeholder"},this.tt("community.post_list.deleted_account")):post.blocked&&!((ref1=this.state)!=null?ref1.show_blocked:void 0)?span({className:"name_placeholder"},"Blocked account"):user.suspended?span({className:"name_placeholder"},this.tt("community.post_list.suspended_account")):user.url&&user.name?a({href:user.url},user.name):void 0),span({className:"post_date",title:post.created_at+" UTC"},a({href:post.url},""+moment.utc(post.created_at).local().fromNow())),!this.is_redacted()&&(post.edits_count||0)>0?fragment({}," ",span({className:"edit_message",title:post.edited_at+" ("+post.edits_count+")"},this.tt("community.post_list.edited"))):void 0,!this.is_redacted()&&post.vote_types&&(post.up_votes||post.down_votes)?span({className:"vote_counts"},post.up_votes?span({className:"upvotes"},"(+"+post.up_votes+")"):void 0,post.down_votes?span({className:"downvotes"},"(-"+post.down_votes+")"):void 0):void 0),div({className:"post_content"},post.deleted||((ref2=post.user)!=null?ref2.deleted:void 0)?div({className:"post_body"},em({className:"deleted_message"},this.tt("community.post_list.deleted_post")),(post.can_moderate||post.admin_url)&&!post.hard_deleted?fragment({}," (",button({className:"textlike",onClick:this.purge_post||(this.purge_post=function(_this){return function(e){e.preventDefault();return _this.delete_post("hard").done(function(){return _this.edit_post("remove")})}}(this))},"Purge"),")"):void 0):((ref3=post.user)!=null?ref3.suspended:void 0)&&!((ref4=this.state)!=null?ref4.show_blocked:void 0)?div({className:"post_body"},em({},this.tt("community.post_list.post_from_suspended_account"))," (",button({className:"textlike",onClick:this.show_blocked_post||(this.show_blocked_post=function(_this){return function(){return _this.setState({show_blocked:true})}}(this))},"Show post"),")"):post.blocked&&!((ref5=this.state)!=null?ref5.show_blocked:void 0)?div({className:"post_body"},em({},this.tt("community.post_list.post_from_blocked_account"))," (",button({className:"textlike",onClick:this.show_blocked_post||(this.show_blocked_post=function(_this){return function(){return _this.setState({show_blocked:true})}}(this))},"Show post"),", ",a({href:this.props.urls.blocks_url(),target:"_blank"},this.tt("community.post_list.edit_blocks")),")"):((ref6=this.state)!=null?ref6.editing:void 0)?this.render_edit_form():P.PostBody({key:post.body_html,body_html:post.body_html}),div({className:"post_footer"},!this.is_redacted()?post.vote_types==="u"?P.PostLiker({post_id:post.id,vote:post.vote,urls:this.props.urls,on_vote:this.update_vote,current_user:this.props.current_user,login_url:typeof(base1=this.props.urls).login_url==="function"?base1.login_url():void 0}):void 0:void 0,!this.is_redacted()&&!this.props.readonly?post.can_reply?a({href:this.props.urls.reply_url({id:post.id}),className:"post_action reply_btn",onClick:this.on_click_reply||(this.on_click_reply=function(_this){return function(e){e.preventDefault();return _this.setState(function(s){if(s==null){s={}}return{replying_to:!s.replying_to}})}}(this))},this.tt("community.post_list.reply")):!this.props.current_user&&this.props.urls.login_url?a({href:typeof(base2=this.props.urls).login_url==="function"?base2.login_url():void 0,className:"post_action reply_btn",rel:"nofollow",target:"_blank"},this.tt("community.post_list.reply")):void 0:void 0,post.can_edit&&!this.props.readonly?a({href:this.props.urls.edit_url({id:post.id}),className:"post_action",onClick:this.on_click_edit||(this.on_click_edit=function(_this){return function(e){e.preventDefault();return _this.setState(function(s){if(s==null){s={}}return{editing:!s.editing,replying_to:false}})}}(this))},this.tt("community.post_list.edit")):void 0,post.can_delete&&!post.deleted&&!this.props.readonly?a({href:"javascript:void(0)",className:"post_action delete_post_btn",onClick:function(_this){return function(e){e.preventDefault();return _this.delete_post()}}(this)},post.is_topic?this.tt("community.post_list.delete_topic"):this.tt("community.post_list.delete")):void 0,!this.is_redacted()&&post.can_report?a({href:"javascript:void(0)",className:"post_action render_post_btn",onClick:function(_this){return function(e){var report_url;e.preventDefault();report_url=_this.props.urls.report_url({id:post.id});return I.Lightbox.open_remote(report_url,I.CommunityReportPostLightbox)}}(this)},this.tt("community.post_list.report")):void 0,user.id&&post.ban_target&&!this.props.readonly?a({href:"javascript:void(0)",className:"post_action ban_user_btn",onClick:function(_this){return function(e){var ban_url;e.preventDefault();ban_url=_this.props.urls.ban_url(post.ban_target);ban_url+="?banned_user_id="+user.id;return I.Lightbox.open_remote(ban_url,I.CommunityBanLightbox)}}(this)},strong({},this.tt("community.post_list.ban"))):void 0,post.admin_url?a({href:post.admin_url},"Admin"):void 0),((ref7=this.state)!=null?ref7.replying_to:void 0)?this.render_reply_form():void 0))},render_edit_form:function(){var post;post=this.props.post;this.edit_form_cancel||(this.edit_form_cancel=fragment({}," ",button({type:"button",className:"textlike",onClick:function(_this){return function(){return _this.setState({editing:false})}}(this)},"Cancel")));return P.PostEditForm({edit_url:this.props.urls.edit_url({id:post.id}),more_buttons:this.edit_form_cancel,reply_form_params:this.props.reply_form_params,on_create_post:function(_this){return function(post){_this.edit_post(post);return _this.setState({editing:false})}}(this)})},render_reply_form:function(){var ref1;return R.SlideDown({},P.PostForm($.extend({submit_url:this.props.urls.reply_url({id:this.props.post.id}),autofocus:true,open:true,className:"inline_reply",key:"post-"+(((ref1=this.state)!=null?ref1.post_counter:void 0)||0),post_label:this.tt("community.post_form.post_reply"),remember_key:"reply:"+this.props.post.id,on_create_post:this.on_add_reply||(this.on_add_reply=function(_this){return function(post){post.just_added=true;_this.setState(function(s){return{replying_to:false,post_counter:(s.post_counter||0)+1}});return _this.edit_post({replies:[post].concat(_this.props.post.replies||[])})}}(this))},this.props.reply_form_params)))},render_current_post:function(){var post,ref1,ref2,ref3;post=this.props.post;return this.enclose({className:classNames("community_post",{disabled:post.deleted||((ref1=post.user)!=null?ref1.suspended:void 0)||((ref2=post.user)!=null?ref2.deleted:void 0)||post.blocked,is_deleted:post.deleted,is_reply:post.depth>1,is_blocked:post.blocked,is_suspended:(ref3=post.user)!=null?ref3.suspended:void 0,has_replies:post.replies&&post.replies.length,has_vote_column:post.vote_types==="ud"}),id:"post-"+post.id},this.props.len_posts&&this.props.idx===0?div({className:"post_anchor",id:"first-post"}):void 0,this.props.len_posts&&this.props.idx===this.props.len_posts-1?div({className:"post_anchor",id:"last-post"}):void 0,this.render_current_post_contents())}});P("PostList",{pure:true,propTypes:{children:types.array,urls:types.object},componentDidCatch:function(error,info){I.event("error","react","Community.PostList");return this.setState({critical_error:true})},render:function(){var ref1;if((ref1=this.state)!=null?ref1.critical_error:void 0){return h3({},"There was an error rendering the comments, please ",a({href:"https://itch.io/support"},"contact support")," with a link to this page.")}if(!this.props.posts){return null}this.url_templates||(this.url_templates=function(_this){return function(){var k,out,ref2,v;out={};ref2=_this.props.urls;for(k in ref2){if(!hasProp.call(ref2,k))continue;v=ref2[k];out[k]=_.template(v)}return out}}(this)());return this.enclose({},this.props.posts.map(function(_this){return function(post,idx){var ref;ref=idx===0?_this.first_post_ref||(_this.first_post_ref=React.createRef()):void 0;return P.Post({ref:ref,key:post.id,readonly:_this.props.readonly,idx:idx,edit_post:_this.props.edit_post,len_posts:_this.props.posts.length,post:post,current_user:_this.props.current_user,urls:_this.url_templates,reply_form_params:_this.props.reply_form_params})}}(this)))}});P("LoadOnScroll",{componentWillUnmount:function(){return typeof this.unbind_visibility==="function"?this.unbind_visibility():void 0},componentDidMount:function(){var el;el=ReactDOM.findDOMNode(this);return this.unbind_visibility=$(el).lazy_images({elements:[el],show_images:function(_this){return function(){var ref1;return(ref1=_this.props)!=null?ref1.on_seen():void 0}}(this)})},render:function(){return this.props.children}});P("PostEditForm",{propTypes:{edit_url:types.string.isRequired},componentDidCatch:function(error,info){I.event("error","react","Community.PostEditForm");return this.setState({critical_error:true})},getInitialState:function(){return{loading:true}},componentDidMount:function(){return $.ajax({type:"GET",dataType:"json",url:this.props.edit_url,xhrFields:{withCredentials:true}}).done(function(_this){return function(res){return _this.setState({loading:false,errors:res.errors,body_format:res.body_format,body:res.body})}}(this))},render:function(){var ref1;if((ref1=this.state)!=null?ref1.critical_error:void 0){return h3({},"There was an error editing this post, please ",a({href:"https://itch.io/support"},"contact support")," with a link to this page.")}if(this.state.body){return P.PostForm($.extend({},this.props.reply_form_params,{submit_url:this.props.edit_url,autofocus:true,open:true,className:"inline_edit",defaultValue:this.state.body,body_format:this.state.body_format,post_label:this.tt("misc.forms.save"),more_buttons:this.props.more_buttons,on_create_post:this.props.on_create_post}))}else{return div({},"")}}});P("PostForm",{getInitialState:function(){return{open:this.props.open||false}},componentDidCatch:function(error,info){return I.event("error","react","Community.PostForm")},render:function(){return this.enclose({},this.state.open?this.render_form():this.render_pre_form())},render_pre_form:function(){return form({className:classNames("form post_form",this.props.className)},input({className:"click_input",type:"text",placeholder:this.t("game.comments.write_your_comment"),onFocus:function(_this){return function(){return _this.setState({open:true,focus:true})}}(this)}))},render_form:function(){var ref1,ref2,ref3;return form({action:this.props.submit_url,ref:this.form_ref||(this.form_ref=React.createRef()),className:classNames("form post_form",this.props.className),onSubmit:function(_this){return function(e){var ref1;if((ref1=_this.state)!=null?ref1.loading:void 0){return}e.preventDefault();_this.setState({loading:true});return I.remote_submit($(e.target),[{name:"format",value:"props"}]).done(function(res){var base,ref2;if(res.errors){_this.setState({needs_recaptcha:indexOf.call(res.errors,"recaptcha")>=0,errors:res.errors,loading:false});return}if(res.flash){I.flash(res.flash)}if((ref2=_this.body_input_ref.current)!=null){ref2.clear_memory()}_this.setState({loading:false,needs_recaptcha:false,errors:null});if(res.post){return typeof(base=_this.props).on_create_post==="function"?base.on_create_post(res.post):void 0}})}}(this)},((ref1=this.state)!=null?ref1.errors:void 0)?R.Forms.FormErrors({errors:this.state.errors}):void 0,R.CSRF({}),this.props.body_format?input({type:"hidden",name:"post[body_format]",value:this.props.body_format}):void 0,function(){switch(this.props.body_format||"html"){case"html":return R.Redactor({placeholder:"Required",ref:this.body_input_ref||(this.body_input_ref=React.createRef()),remember_key:this.props.remember_key,name:"post[body]",required:true,defaultValue:this.props.defaultValue,redactor_opts:$.extend({minHeight:50,focus:this.props.autofocus||this.state.focus},this.props.redactor_opts)});case"markdown":return R.Forms.MarkdownInput({ref:this.body_input_ref||(this.body_input_ref=React.createRef()),remember_key:this.props.remember_key,placeholder:"Required",defaultValue:this.props.defaultValue,name:"post[body]",autofocus:this.props.autofocus||this.state.focus,required:true,on_submit_hotkey:this.on_submit_hotkey_callback||(this.on_submit_hotkey_callback=function(_this){return function(){var ref2,ref3;return(ref2=_this.submit_button_ref)!=null?(ref3=ref2.current)!=null?ref3.click():void 0:void 0}}(this))});default:return R.Forms.FormErrors({errors:["Don't know how to edit post with format "+this.state.body_format]})}}.call(this),((ref2=this.state)!=null?ref2.needs_recaptcha:void 0)?R.Forms.RecaptchaInput({sitekey:this.props.recaptcha_sitekey}):void 0,div({className:"buttons"},button({className:"button",disabled:(ref3=this.state)!=null?ref3.loading:void 0,ref:this.submit_button_ref||(this.submit_button_ref=React.createRef())},this.props.post_label||this.tt("community.post_form.post")),this.props.more_buttons))}});R["package"]("Game")("Comments",{pure:true,getDefaultProps:function(){return{autoload_count:1}},getInitialState:function(){return{posts:this.props.posts,pagination:this.props.pagination,autoload_count:this.props.autoload_count}},create_scroll_restore:function(el){var from_top,offset_parent,scroll_top;el=$(el).find(".post_grid");if(!el.length){return function(){}}offset_parent=el.offsetParent();scroll_top=window.document.documentElement.scrollTop;from_top=el.position().top-scroll_top;return function(){return window.document.documentElement.scrollTop=el.position().top-from_top}},load_page:function(page){var ref1;if(page==null){page="next_page"}if(!((ref1=this.state.pagination)!=null?ref1[page]:void 0)){return}this.setState({loading:true});return $.getJSON(this.props.topic.url,this.state.pagination[page]).done(function(_this){return function(res){var el,first_post,pagination,post_list,posts,ref2,ref3,ref4,restore_position;if(res.posts){pagination=Object.assign({},_this.props.pagination);pagination[page]=(ref2=res.pagination)!=null?ref2[page]:void 0;posts=function(){switch(page){case"prev_page":return res.posts.concat(this.state.posts);case"next_page":return this.state.posts.concat(res.posts)}}.call(_this);restore_position=page==="prev_page"?(post_list=(ref3=_this.post_list_ref)!=null?ref3.current:void 0,(first_post=post_list!=null?(ref4=post_list.first_post_ref)!=null?ref4.current:void 0:void 0)?(el=ReactDOM.findDOMNode(first_post),_this.create_scroll_restore(el)):void 0):void 0;return _this.setState({loading:false,posts:posts,pagination:pagination},restore_position)}else{return _this.setState({loading:false,pagination:null})}}}(this))},render:function(){var load_more_button,ref1,ref2,ref3,ref4;return this.enclose({},h2({},this.tt("game.comments.comments_header")),P.PostForm({key:"post-"+(((ref1=this.state)!=null?ref1.post_counter:void 0)||0),submit_url:this.props.post_form.submit_url,post_label:this.tt("game.comments.post_comment"),recaptcha_sitekey:this.props.recaptcha_sitekey,remember_key:this.props.remember_key||"topic:"+this.props.topic.id,redactor_opts:this.props.post_form.redactor_opts,body_format:this.props.body_format,on_create_post:this.on_create_post||(this.on_create_post=function(_this){return function(post){return _this.setState(function(s){post.just_added=true;return{post_counter:(s.post_counter||0)+1,posts:[post].concat(s.posts||[])}})}}(this))}),this.state.pagination&&this.state.pagination.prev_page?p({className:"pagination_buttons"},a({href:this.props.topic.url+"?"+$.param(this.state.pagination.prev_page),className:"load_posts_before",disabled:(ref2=this.state)!=null?ref2.loading:void 0,onClick:this.load_prev_page||(this.load_prev_page=function(_this){return function(e){e.preventDefault();return _this.load_page("prev_page")}}(this))},"Show previous posts ↑")):void 0,P.PostList({ref:this.post_list_ref||(this.post_list_ref=React.createRef()),posts:this.state.posts,urls:this.props.urls,current_user:this.props.current_user||I.current_user,reply_form_params:this.reply_form_params||(this.reply_form_params={recaptcha_sitekey:this.props.recaptcha_sitekey,redactor_opts:this.props.post_form.redactor_opts,body_format:this.props.body_format}),edit_post:this.edit_post||(this.edit_post=function(_this){return function(post,update){return _this.setState(function(s){var _post;return{posts:function(){var i,len,ref3,results;ref3=s.posts;results=[];for(i=0,len=ref3.length;i<len;i++){_post=ref3[i];if(_post===post){if(update==="remove"){continue}results.push($.extend({},post,update))}else{results.push(_post)}}return results}()}})}}(this))}),this.state.pagination&&this.state.pagination.next_page?(load_more_button=div({className:"pagination_buttons"},a({href:this.props.topic.url+"?"+$.param(this.state.pagination.next_page),className:classNames("load_posts_after",{loading:(ref3=this.state)!=null?ref3.loading:void 0}),onClick:this.load_next_page||(this.load_next_page=function(_this){return function(e){var ref4;e.preventDefault();if((ref4=_this.state)!=null?ref4.loading:void 0){return}return _this.load_page("next_page")}}(this))},((ref4=this.state)!=null?ref4.loading:void 0)?"Loading...":"Load more")),this.state.autoload_count>0?P.LoadOnScroll({key:JSON.stringify(this.state.pagination),on_seen:function(_this){return function(){_this.setState(function(state){return{autoload_count:state.autoload_count-1}});return _this.load_page("next_page")}}(this)},load_more_button):load_more_button):void 0)}})})}).call(this);(function(){I.libs.react.done(function(){var P,PATTERNS,_rdf,a,br,button,code,create_line_icon,div,em,fieldset,form,fragment,h1,h2,h3,h4,h5,h6,iframe,img,input,label,legend,li,line,ol,optgroup,option,p,path,pre,rect,section,select,span,strong,table,tbody,td,textarea,tr,types,ul,slice=[].slice,hasProp={}.hasOwnProperty;_rdf=ReactDOMFactories;div=_rdf.div,span=_rdf.span,a=_rdf.a,br=_rdf.br,p=_rdf.p,ol=_rdf.ol,ul=_rdf.ul,li=_rdf.li,strong=_rdf.strong,em=_rdf.em,img=_rdf.img,form=_rdf.form,label=_rdf.label,input=_rdf.input,textarea=_rdf.textarea,button=_rdf.button,iframe=_rdf.iframe,h1=_rdf.h1,h2=_rdf.h2,h3=_rdf.h3,h4=_rdf.h4,h5=_rdf.h5,h6=_rdf.h6,pre=_rdf.pre,code=_rdf.code,select=_rdf.select,option=_rdf.option,section=_rdf.section,optgroup=_rdf.optgroup,fieldset=_rdf.fieldset,legend=_rdf.legend;fragment=React.createFactory(React.Fragment);P=R["package"]("Forms");types=PropTypes;table=ReactDOMFactories.table,tbody=ReactDOMFactories.tbody,tr=ReactDOMFactories.tr,td=ReactDOMFactories.td;P("MarkdownInput",{pure:true,propTypes:{name:types.string,value:types.string},getDefaultProps:function(){return{max_default_height:400}},componentWillUnmount:function(){return this.unmounted=true},componentDidMount:function(){var inner_height,total_height;total_height=this.input_ref.current.scrollHeight;inner_height=this.input_ref.current.clientHeight;if(total_height>inner_height){this.setState({default_height:Math.min(total_height,this.props.max_default_height)})}if(this.props.autofocus){return _.defer(function(_this){return function(){var ref;return(ref=_this.input_ref.current)!=null?ref.focus():void 0}}(this))}},get_value:function(){var ref;return(ref=this.input_ref.current)!=null?ref.value:void 0},set_value:function(value){return this.input_ref.current.value=value},click_bold_text:function(e){return this.wrap_selection("**","**")},click_italic_text:function(e){return this.wrap_selection("*","*")},click_insert_link:function(e){var input_el,select_end,t;t=this.get_selected_text();input_el=this.input_ref.current;if(t.match(/^https?:\/\/[^\s]+$/)){this.wrap_selection("[](",")");input_el.selectionStart=input_el.selectionStart-"](".length;return input_el.selectionEnd=input_el.selectionStart}else{this.wrap_selection("[","](url)");if(t.length>0){select_end=input_el.selectionEnd;input_el.selectionStart=select_end+"](".length;return input_el.selectionEnd=select_end+"](url".length}}},click_insert_video:function(e){return I.Lightbox.open(P.MarkdownVideoEmbedLightbox({on_submit:function(_this){return function(embed_code){return _this.insert_line(embed_code)}}(this)}))},click_insert_image:function(e){return I.Lightbox.open_remote(I.root_url("dashboard/upload-image"),I.PickImageLightbox,function(_this){return function(image_url){var input_el;I.Lightbox.close();if(_this.unmounted){return}if(input_el=_this.input_ref.current){return _this.insert_line("![]("+image_url+")")}}}(this))},click_show_help:function(e){return I.Lightbox.open(P.MarkdownHelpLightbox({}))},get_selected_text:function(){var input_el;if(input_el=this.input_ref.current){return input_el.value.substring(input_el.selectionStart,input_el.selectionEnd)}else{return""}},wrap_selection:function(left,right){var input_el,inserted,replacement,select_end,select_start,text_after,text_before,text_selected,value;input_el=this.input_ref.current;select_start=input_el.selectionStart;select_end=input_el.selectionEnd;value=input_el.value;text_before=value.substring(0,input_el.selectionStart);text_after=value.substring(input_el.selectionEnd,value.length);text_selected=value.substring(input_el.selectionStart,input_el.selectionEnd);input_el.focus();replacement=""+left+(text_selected||"")+right;inserted=document.execCommand("insertText",false,replacement);if(!inserted){if(typeof input_el.setRangeText==="function"){input_el.setRangeText(replacement)}}input_el.selectionStart=select_start+left.length;return input_el.selectionEnd=select_end+left.length},insert_line:function(text){var input_el,inserted;input_el=this.input_ref.current;input_el.focus();inserted=document.execCommand("insertText",false,text);if(!inserted){if(typeof input_el.setRangeText==="function"){input_el.setRangeText(text)}input_el.selectionStart=input_el.selectionStart+text.length;return input_el.selectionEnd=input_el.selectionEnd}},on_hotkey_keydown:function(e){var base;if(!(e.metaKey||e.ctrlKey)){return}switch(e.key){case"b":this.click_bold_text(e);break;case"i":this.click_italic_text(e);break;case"k":this.click_insert_link(e);break;case"Enter":if(typeof(base=this.props).on_submit_hotkey==="function"){base.on_submit_hotkey()}break;default:return}return e.preventDefault()},render:function(){var ref;return this.enclose({},ul({className:"markdown_toolbar"},li({},button({tabIndex:-1,type:"button",onClick:this.click_show_help,title:"Markdown Help"},R.Icons.Markdown)),li({},button({tabIndex:-1,type:"button",onClick:this.click_bold_text,title:"Bold"},R.Icons.FormatBold)),li({},button({tabIndex:-1,type:"button",onClick:this.click_italic_text,title:"Italic"},R.Icons.FormatItalic)),li({},button({tabIndex:-1,type:"button",title:"Insert link",onClick:this.click_insert_link},R.Icons.InsertLink)),li({},button({tabIndex:-1,type:"button",title:"Insert image",onClick:this.click_insert_image},R.Icons.InsertImage)),li({},button({tabIndex:-1,type:"button",title:"Insert video",onClick:this.click_insert_video},R.Icons.InsertVideo))),textarea({name:this.props.name,ref:this.input_ref||(this.input_ref=React.createRef()),defaultValue:this.get_default_value(),className:"markdown_textarea",onKeyDown:this.on_hotkey_keydown,placeholder:this.props.placeholder,required:this.props.required,style:((ref=this.state)!=null?ref.default_height:void 0)?{height:this.state.default_height+"px"}:void 0,onChange:function(_this){return function(e){var base,value;value=e.target.value;if(typeof(base=_this.props).on_change==="function"){base.on_change(value)}if(_this.props.remember_key){_this.set_memory||(_this.set_memory=_.throttle(function(value){return I.store_memory(this.remember_key(),value)},500));return _this.set_memory(value)}}}(this)}))},get_default_value:function(){var v;if(v=this.props.value||this.props.defaultValue){return v}if(this.props.remember_key){if(v=typeof localStorage!=="undefined"&&localStorage!==null?localStorage.getItem(this.remember_key()):void 0){return v}}},remember_key:function(){return"inputmemory:"+this.props.remember_key},clear_memory:function(){return I.clear_memory(this.remember_key())}});R.Icons||(R.Icons={});path=ReactDOMFactories.path,line=ReactDOMFactories.line,rect=ReactDOMFactories.rect;R.Icons.Markdown=React.createElement("svg",{className:classNames("svgicon markdown_icon"),role:"img",version:"1.1",viewBox:"0 0 208 128",fill:"currentColor"},path({d:"M193 128H15a15 15 0 0 1-15-15V15A15 15 0 0 1 15 0h178a15 15 0 0 1 15 15v98a15 15 0 0 1-15 15zM50 98V59l20 25 20-25v39h20V30H90L70 55 50 30H30v68zm134-34h-20V30h-20v34h-20l30 35z"}));create_line_icon=function(){var contents,props,ref;props=arguments[0],contents=2<=arguments.length?slice.call(arguments,1):[];return React.createElement.apply(React,["svg",{className:classNames("svgicon",props.className),role:"img",version:"1.1",viewBox:"0 0 24 24",width:"24",height:"24",fill:(ref=props!=null?props.fill:void 0)!=null?ref:"none",stroke:"currentColor",strokeWidth:"3",strokeLinejoin:"round","aria-hidden":true}].concat(slice.call(contents)))};R.Icons.FormatBold=create_line_icon({className:"icon_format_bold"},path({d:"M6 4h8a4 4 0 0 1 4 4 4 4 0 0 1-4 4H6z"}),path({d:"M6 12h9a4 4 0 0 1 4 4 4 4 0 0 1-4 4H6z"}));R.Icons.FormatItalic=create_line_icon({className:"icon_format_italic"},line({x1:"19",y1:"4",x2:"10",y2:"4"}),line({x1:"14",y1:"20",x2:"5",y2:"20"}),line({x1:"15",y1:"4",x2:"9",y2:"20"}));R.Icons.InsertLink=create_line_icon({className:"icon_insert_link"},path({d:"M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"}),path({d:"M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"}));R.Icons.InsertImage=create_line_icon({className:"icon_insert_image"},rect({x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"}),React.createElement("circle",{cx:"8.5",cy:"8.5",r:"1.5"}),React.createElement("polyline",{points:"21 15 16 10 5 21"}));R.Icons.InsertVideo=create_line_icon({className:"icon_insert_video"},path({d:"M22.54 6.42a2.78 2.78 0 0 0-1.94-2C18.88 4 12 4 12 4s-6.88 0-8.6.46a2.78 2.78 0 0 0-1.94 2A29 29 0 0 0 1 11.75a29 29 0 0 0 .46 5.33A2.78 2.78 0 0 0 3.4 19c1.72.46 8.6.46 8.6.46s6.88 0 8.6-.46a2.78 2.78 0 0 0 1.94-2 29 29 0 0 0 .46-5.25 29 29 0 0 0-.46-5.33z"}),React.createElement("polygon",{points:"9.75 15.02 15.5 11.75 9.75 8.48 9.75 15.02"}));PATTERNS={youtube:/https?:\/\/(?:[0-9A-Z-]+\.)?(?:youtu\.be\/|youtube(?:\-nocookie)?\.com\S*[^\w\-\s])([\w\-]{11})(?=[^\w\-]|$)(?![?=&+%\w.\-]*(?:['"][^<>]*>|<\/a>))[?=&+%\w.-]*/gi,vimeo:/https?:\/\/(www\.)?vimeo.com\/(\d+)($|\/)/,sketchfab_old:/https?:\/\/(?:www\.)?sketchfab\.com\/models\/([\w]+)($|\/)/,sketchfab:/https?:\/\/(?:www\.)?sketchfab\.com\/3d-models\/.*?-([^-]+)$/};P("MarkdownVideoEmbedLightbox",{pure:true,getInitialState:function(){return{is_valid:false}},componentDidMount:function(){return _.defer(function(_this){return function(){var ref;return(ref=_this.input_ref.current)!=null?ref.focus():void 0}}(this))},generate_youtube_embed_code:function(video_id){return'<iframe width="560" height="315" src="https://www.youtube.com/embed/'+video_id+'" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>'},generate_vimeo_embed_code:function(video_id){return'<iframe src="https://player.vimeo.com/video/'+video_id+'" width="560" height="315" frameborder="0" allow="autoplay; fullscreen" allowfullscreen></iframe>'},generate_sketchfab_embed_code:function(model_id){return'<iframe width="560" height="315" src="https://sketchfab.com/models/'+model_id+'/embed" frameborder="0" allow="autoplay; fullscreen; vr" mozallowfullscreen="true" webkitallowfullscreen="true"></iframe>'},parse_input_value:function(){var m,pattern,ref,res,type,value,video_id;value=$.trim(((ref=this.input_ref.current)!=null?ref.value:void 0)||"");if(value.match(/<iframe/i)){return value}for(type in PATTERNS){if(!hasProp.call(PATTERNS,type))continue;pattern=PATTERNS[type];m=value.match(pattern);if(!m){continue}switch(type){case"youtube":video_id=(res=m[0].match(/v=([^>"'&]+)/))?res[1]:(res=m[0].match(/embed\/([^>"'&\/]+)/))?res[1]:void 0;if(video_id){return this.generate_youtube_embed_code(video_id)}break;case"vimeo":if(video_id=m[2]){return this.generate_vimeo_embed_code(video_id)}break;case"sketchfab":case"sketchfab_old":if(video_id=m[1]){return this.generate_sketchfab_embed_code(video_id)}break;default:console.log(type,m)}}},render:function(){return R.Lightbox({className:classNames(this.enclosing_class_name(),"compact")},h2({},"Embed Video"),form({className:"form",onSubmit:this.on_submit||(this.on_submit=function(_this){return function(e){var base;e.preventDefault();if(!(_this.state.is_valid&&_this.state.embed_code)){return}if(typeof(base=_this.props).on_submit==="function"){base.on_submit(_this.state.embed_code)}return I.Lightbox.close()}}(this))},div({className:"label"},"Youtube/Vimeo/Sketchfab URL or ",code({},"<iframe>")," embed code"),div({className:"input_split"},input({type:"text",required:"required",placeholder:"Please paste a valid URL or embed code",ref:this.input_ref||(this.input_ref=React.createRef()),onChange:this.on_change||function(_this){return function(e){var embed_code;embed_code=_this.parse_input_value();return _this.setState({embed_code:embed_code,is_valid:!!embed_code})}}(this)})," ",button({disabled:!this.state.is_valid,className:classNames("button",{disabled:!this.state.is_valid})},"Insert"))))}});P("MarkdownHelpLightbox",{pure:true,render:function(){var pair;pair=function(){var left,rest;left=arguments[0],rest=2<=arguments.length?slice.call(arguments,1):[];return tr({},td({className:"format_type"},left),td.apply(null,[{className:"format_example"}].concat(slice.call(rest))))};return R.Lightbox({className:classNames(this.enclosing_class_name(),"compact")},h2({},"Quick Markdown Guide"),p({},"Markdown is a writing format that converts into HTML."),div({className:"table_wrapper"},table({className:"nice_table"},tbody({},pair("Bold","**Bolded text here**"),pair("Italic","*Emphasized text here*"),pair("Bullet list","* First item",br({}),"* Second item"),pair("Link","[Linked text](http://example.com)"),pair("Blockquote","> Quoted text here",br({}),"> Can span multiple lines"),pair("Code","```",br({}),'print("Hello world")',br({}),"```"),pair("Video embeds",em({},"Paste embed code directly"))))),p({},a({href:"https://commonmark.org/help/",target:"_blank"},"Extended tutorial ↗"),". You can also use a subset of HTML directly for advanced formatting."))}})})}).call(this);(function(){I.libs.react.done(function(){var P,_rdf,a,br,button,code,div,em,fieldset,form,fragment,h1,h2,h3,h4,h5,h6,iframe,img,input,label,legend,li,ol,optgroup,option,p,pre,section,select,span,strong,textarea,types,ul;_rdf=ReactDOMFactories;div=_rdf.div,span=_rdf.span,a=_rdf.a,br=_rdf.br,p=_rdf.p,ol=_rdf.ol,ul=_rdf.ul,li=_rdf.li,strong=_rdf.strong,em=_rdf.em,img=_rdf.img,form=_rdf.form,label=_rdf.label,input=_rdf.input,textarea=_rdf.textarea,button=_rdf.button,iframe=_rdf.iframe,h1=_rdf.h1,h2=_rdf.h2,h3=_rdf.h3,h4=_rdf.h4,h5=_rdf.h5,h6=_rdf.h6,pre=_rdf.pre,code=_rdf.code,select=_rdf.select,option=_rdf.option,section=_rdf.section,optgroup=_rdf.optgroup,fieldset=_rdf.fieldset,legend=_rdf.legend;fragment=React.createFactory(React.Fragment);P=R["package"]("Admin");types=PropTypes;P("RemoteDataList",{componentDidMount:function(){return $.ajax({url:this.props.url,dataType:"json",xhrFields:{withCredentials:true}}).done(function(_this){return function(res){return _this.setState(res)}}(this))},render:function(){var ref;if(!((ref=this.state)!=null?ref.tag_slugs:void 0)){return null}return React.createElement("datalist",{id:this.props.id},this.state.tag_slugs.map(function(_this){return function(tag){return option({key:tag,value:tag})}}(this)))}});P("TagEditor",{getInitialState:function(){return{closed:false,featured_tags:this.props.featured_tags,tags:this.props.tags}},update_from_res:function(res){if(res.errors){this.setState({errors:res.errors});return}res.featured_tags||(res.featured_tags=[]);res.tags||(res.tags=[]);return this.setState(res)},feature_tag:function(tag,action){if(action==null){action="add"}this.setState({errors:null});return $.ajax({url:this.props.submit_url,type:"post",dataType:"json",xhrFields:{withCredentials:true},data:I.with_csrf({action:action,tag_slug:tag})}).done(this.update_from_res)},render_queue:function(){var rating,ref;rating=((ref=this.props.queue_rating)!=null?ref.rating:void 0)||"unrated";return div({className:classNames("queue_status",rating,{unrated:!this.props.queue_rating})},a({href:this.props.queue_url},rating))},render_suggested_tweet:function(){if(!this.props.suggested_tweet){return}return fragment({},React.createElement("hr",{}),React.createElement("details",{},React.createElement("summary",{},strong({},"Tweet builder")),textarea({className:"tweet_preview",defaultValue:this.props.suggested_tweet}),span({},"Len: "+this.props.suggested_tweet.length),this.props.cover_url?div({},a({href:this.props.cover_url},"Original cover")):void 0))},has_featured_tag:function(t){var i,len,ref,tag;if(!this.state.featured_tags){return false}ref=this.state.featured_tags;for(i=0,len=ref.length;i<len;i++){tag=ref[i];if(tag.tag_slug===t){return true}}return false},render:function(){var ref,ref1,seen_tags;if(this.state.closed){return null}return this.enclose({},this.state.errors?div({className:"form_errors"},this.state.errors.join(", ")):void 0,this.render_queue(),div({className:"panel_inside"},strong({},"User tags"),((ref=this.state.tags)!=null?ref.length:void 0)?(seen_tags={},this.state.tags.map(function(_this){return function(tag){if(seen_tags[tag.tag_slug]){return}seen_tags[tag.tag_slug]=true;return div({className:"tag_row",key:tag.tag_slug},div({},a({href:tag.url},tag.featured?strong({},tag.tag_slug):tag.tag_slug),_this.has_featured_tag(tag.tag_slug)?" ☑":fragment({}," (",a({href:"javascript:void(0)",className:"feature_tag_btn",onClick:function(e){e.preventDefault();return _this.feature_tag(tag.tag_slug)}},"add"),")")))}}(this))):div({className:"tag_row"},em({},"None")),React.createElement("hr",{}),strong({},"Featured tags"),form({method:"POST",action:this.props.submit_url,className:"new_tag_form",onSubmit:function(_this){return function(e){e.preventDefault();return I.remote_submit($(e.target)).done(_this.update_from_res).done(function(){var ref1;return(ref1=_this.tag_input_ref.current)!=null?ref1.value="":void 0})}}(this)},R.CSRF({}),input({type:"hidden",name:"action",value:"add"}),input({ref:this.tag_input_ref||(this.tag_input_ref=React.createRef()),onMouseEnter:function(_this){return function(){if(!_this.state.focused){return _this.setState({focused:true})}}}(this),onFocus:function(_this){return function(){if(!_this.state.focused){return _this.setState({focused:true})}}}(this),type:"text",name:"tag_slug",list:"tag-options"}),this.state.focused?P.RemoteDataList({url:this.props.submit_url,id:"tag-options"}):void 0,button({},"Add")),(ref1=this.state.featured_tags)!=null?ref1.map(function(_this){return function(tag){return div({className:"tag_row",key:tag.tag_slug},div({},a({href:tag.url},tag.tag_slug)," (",a({href:"javascript:void(0)",className:"feature_tag_btn",onClick:function(e){e.preventDefault();return _this.feature_tag(tag.tag_slug,"delete")}},"remove"),")"))}}(this)):void 0,this.render_suggested_tweet()),button({className:"close_btn",onClick:function(_this){return function(){return _this.setState({closed:true})}}(this)},"×"))}})})}).call(this);(function(){I.libs.react.done(function(){var P,_rdf,a,br,button,code,div,em,fieldset,form,fragment,h1,h2,h3,h4,h5,h6,iframe,img,input,label,legend,li,ol,optgroup,option,p,pre,section,select,span,strong,textarea,types,ul;_rdf=ReactDOMFactories;div=_rdf.div,span=_rdf.span,a=_rdf.a,br=_rdf.br,p=_rdf.p,ol=_rdf.ol,ul=_rdf.ul,li=_rdf.li,strong=_rdf.strong,em=_rdf.em,img=_rdf.img,form=_rdf.form,label=_rdf.label,input=_rdf.input,textarea=_rdf.textarea,button=_rdf.button,iframe=_rdf.iframe,h1=_rdf.h1,h2=_rdf.h2,h3=_rdf.h3,h4=_rdf.h4,h5=_rdf.h5,h6=_rdf.h6,pre=_rdf.pre,code=_rdf.code,select=_rdf.select,option=_rdf.option,section=_rdf.section,optgroup=_rdf.optgroup,fieldset=_rdf.fieldset,legend=_rdf.legend;fragment=React.createFactory(React.Fragment);P=R["package"]("Game");types=PropTypes;P("ReportLightbox",{pure:true,render:function(){var ref;return R.Lightbox({className:this.enclosing_class_name()},((ref=this.state)!=null?ref.submitted:void 0)?this.render_after_submit():this.render_report_form())},get_report_options:function(){var out;out=[["broken","Broken","Doesn't run, download, or crashes"],["offensive","Offensive material"],["doesnt_own","Uploader not authorized to distribute"],["miscategorized","Miscategorized","Shows up on wrong part of itch.io, incorrect tags, incorrect platforms, etc."],["spam","Spam"],["other",this.tt("game.report_form.reason_other")]];if(this.props.jam){out.unshift(["invalid_jam_submission","Invalid jam submission","Empty or incomplete page, breaks rules, etc."])}return out},render_report_form:function(){var ref,ref1,ref2,ref3,ref4;return fragment({},h2({},this.tt("game.report_form.title",{page_title:this.props.page_title})),form({className:"form",method:"post",action:this.props.submit_url,onSubmit:function(_this){return function(e){e.preventDefault();_this.setState({errors:null,loading:true});return I.remote_submit($(e.target)).done(function(res){if(res.errors){_this.setState({loading:false,errors:res.errors});return}return _this.setState({submitted:true})})}}(this)},R.CSRF({}),this.props.support_email||this.props.support_link?p({className:"support_notice"},this.tt("game.report_form.support_from_creator")," ",this.props.support_link?a({rel:"nofollow",target:"blank",className:"forward_link",href:this.props.support_link},this.tt("game.report_form.support_page_link")):a({rel:"nofollow",target:"blank",className:"forward_link",href:"mailto:"+this.props.support_email},this.tt("game.report_form.email_creator_link"))):void 0,((ref=this.state)!=null?ref.errors:void 0)?R.Forms.FormErrors({errors:this.state.errors}):void 0,p({},this.tt("game.report_form.form_description")),this.props.jam?p({},"This report will be made available to hosts of ",a({href:this.props.jam.url},this.props.jam.name),"."):void 0,div({className:"input_row"},div({className:"label"},this.tt("game.report_form.reason_label")),R.Forms.RadioButtons({name:"report[reason]",value:((ref1=this.state)!=null?ref1.reason:void 0)||"",onChange:function(_this){return function(e){return _this.setState({reason:e.target.value})}}(this),options:this.get_report_options()})),((ref2=this.state)!=null?ref2.reason:void 0)==="doesnt_own"?div({className:"input_row"},strong({},"Do you need to file a DMCA notice?")," ",a({target:"_blank",href:this.props.itchio_support_url,className:"forward_link"},"Contact our support team so we can process your request")):void 0,div({className:"input_row"},label({},div({className:"label"},this.tt("game.report_form.description_label"),span({className:"sub"}," — ",this.description_description())),textarea({maxLength:"2048",name:"report[description]",required:this.description_required(),placeholder:this.description_required()?this.t("misc.forms.required"):this.t("misc.forms.optional")}))),R.Forms.TextInputRow({title:"Your email",sub:"If your report needs a reply we'll use it to communicate with you",name:"report[email]",defaultValue:this.props.current_user_email,required:this.email_required(),placeholder:this.email_required()?this.t("misc.forms.required"):this.t("misc.forms.optional")}),div({callback:"buttons"},button({disabled:(ref3=this.state)!=null?ref3.loading:void 0,className:classNames("button",{disabled:(ref4=this.state)!=null?ref4.loading:void 0})},this.tt("game.report_form.submit_report_button")))))},render_after_submit:function(){return div({className:"report_submitted"},h2({},this.tt("game.report_form.report_received_header")),p({},"You report will be reviewed shortly, and action will be taken if necessary. If you have any additional requests then you can ",a({href:this.props.itchio_support_url,target:"_blank"},"contact our support team"),"."),p({},button({type:"button",className:"textlike",onClick:function(_this){return function(e){return I.Lightbox.close()}}(this)},this.tt("misc.lightboxes.close"))))},description_description:function(){var ref;switch((ref=this.state)!=null?ref.reason:void 0){case"broken":return"Please explain what is broken. Include how you tried to run the project, what operating system or browser you're using, and any error messages you saw. We will share your error with the creator to help them fix the issue.";case"invalid_jam_submission":return"Please explain why this submission should be disqualified or removed";case"miscategorized":return"Please explain how this project should be categorized.";default:return"Please provide a summary of your report"}},description_required:function(){var ref,ref1;return(ref=(ref1=this.state)!=null?ref1.reason:void 0)==="broken"||ref==="miscategorized"||ref==="other"||ref==="invalid_jam_submission"},email_required:function(){var ref,ref1;return(ref=(ref1=this.state)!=null?ref1.reason:void 0)==="broken"||ref==="doesnt_own"}})})}).call(this);(function(){I.libs.react.done(function(){var _rdf,a,br,button,code,div,em,fieldset,form,fragment,h1,h2,h3,h4,h5,h6,iframe,img,input,label,legend,li,ol,optgroup,option,p,pre,section,select,span,strong,textarea,ul;_rdf=ReactDOMFactories;div=_rdf.div,span=_rdf.span,a=_rdf.a,br=_rdf.br,p=_rdf.p,ol=_rdf.ol,ul=_rdf.ul,li=_rdf.li,strong=_rdf.strong,em=_rdf.em,img=_rdf.img,form=_rdf.form,label=_rdf.label,input=_rdf.input,textarea=_rdf.textarea,button=_rdf.button,iframe=_rdf.iframe,h1=_rdf.h1,h2=_rdf.h2,h3=_rdf.h3,h4=_rdf.h4,h5=_rdf.h5,h6=_rdf.h6,pre=_rdf.pre,code=_rdf.code,select=_rdf.select,option=_rdf.option,section=_rdf.section,optgroup=_rdf.optgroup,fieldset=_rdf.fieldset,legend=_rdf.legend;fragment=React.createFactory(React.Fragment);R.Icons||(R.Icons={});R.Icons.Close=function(props){var height,ref,ref1,width;if(props==null){props={}}width=(ref=props.width)!=null?ref:24;height=(ref1=props.height)!=null?ref1:width;return React.createElement("svg",{className:"svgicon icon_close",strokeLinecap:"round",stroke:"currentColor",role:"img",version:"1.1",viewBox:"0 0 24 24",strokeWidth:"2",width:width,height:height,strokeLinejoin:"round","aria-hidden":true,fill:"none"},React.createElement("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),React.createElement("line",{x1:"6",y1:"6",x2:"18",y2:"18"}))};R.component("Lightbox",{render:function(){return div({className:classNames("lightbox",this.props.className),style:this.props.style},this.props.close!==false?button({className:"close_button",type:"button"},R.Icons.Close({width:18})):void 0,this.props.children)}})})}).call(this);(function(){I.libs.react.done(function(){var _rdf,a,br,button,code,create_line_icon,div,em,fieldset,form,fragment,h1,h2,h3,h4,h5,h6,iframe,img,input,label,legend,li,ol,optgroup,option,p,pre,section,select,span,strong,textarea,ul,slice=[].slice;_rdf=ReactDOMFactories;div=_rdf.div,span=_rdf.span,a=_rdf.a,br=_rdf.br,p=_rdf.p,ol=_rdf.ol,ul=_rdf.ul,li=_rdf.li,strong=_rdf.strong,em=_rdf.em,img=_rdf.img,form=_rdf.form,label=_rdf.label,input=_rdf.input,textarea=_rdf.textarea,button=_rdf.button,iframe=_rdf.iframe,h1=_rdf.h1,h2=_rdf.h2,h3=_rdf.h3,h4=_rdf.h4,h5=_rdf.h5,h6=_rdf.h6,pre=_rdf.pre,code=_rdf.code,select=_rdf.select,option=_rdf.option,section=_rdf.section,optgroup=_rdf.optgroup,fieldset=_rdf.fieldset,legend=_rdf.legend;fragment=React.createFactory(React.Fragment);R.Icons||(R.Icons={});create_line_icon=function(){var contents,props,ref;props=arguments[0],contents=2<=arguments.length?slice.call(arguments,1):[];return React.createElement.apply(React,["svg",{className:classNames("svgicon",props.className),role:"img",version:"1.1",viewBox:"0 0 24 24",width:"24",height:"24",fill:(ref=props!=null?props.fill:void 0)!=null?ref:"none",stroke:"currentColor",strokeWidth:"2",strokeLinejoin:"round",strokeLinecap:"round","aria-hidden":true}].concat(slice.call(contents)))};R.Icons.TriUp=create_line_icon({className:"icon_tri_up",fill:"currentColor"},React.createElement("polygon",{points:"2 18 12 6 22 18"}));R.Icons.TriDown=create_line_icon({className:"icon_tri_down",fill:"currentColor"},React.createElement("polygon",{points:"2 6 12 18 22 6"}));R.Icons.Filter=create_line_icon({className:"icon_filter"},React.createElement("polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"}));R.Icons.Edit=create_line_icon({className:"icon_edit"},React.createElement("path",{d:"M20 14.66V20a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h5.34"}),React.createElement("polygon",{points:"18 2 22 6 12 16 8 16 8 12 18 2"}))})}).call(this);(function(){I.libs.react.done(function(){var P,_rdf,a,br,button,c,code,div,em,fieldset,form,fragment,h1,h2,h3,h4,h5,h6,iframe,img,input,label,legend,li,ol,optgroup,option,p,pre,section,select,span,strong,textarea,types,ul,slice=[].slice;_rdf=ReactDOMFactories;div=_rdf.div,span=_rdf.span,a=_rdf.a,br=_rdf.br,p=_rdf.p,ol=_rdf.ol,ul=_rdf.ul,li=_rdf.li,strong=_rdf.strong,em=_rdf.em,img=_rdf.img,form=_rdf.form,label=_rdf.label,input=_rdf.input,textarea=_rdf.textarea,button=_rdf.button,iframe=_rdf.iframe,h1=_rdf.h1,h2=_rdf.h2,h3=_rdf.h3,h4=_rdf.h4,h5=_rdf.h5,h6=_rdf.h6,pre=_rdf.pre,code=_rdf.code,select=_rdf.select,option=_rdf.option,section=_rdf.section,optgroup=_rdf.optgroup,fieldset=_rdf.fieldset,legend=_rdf.legend;fragment=React.createFactory(React.Fragment);if(R.Redactor){return}c=function(_this){return function(){return R.component.apply(R,arguments)}}(this);types=PropTypes;c("Redactor",{pure:true,componentDidMount:function(){var opts;opts=$.extend({minHeight:80,source:false},this.props.redactor_opts);opts.callbacks||(opts.callbacks={});opts.callbacks.change=function(_this){return function(html){var base;if(typeof(base=_this.props).on_change==="function"){base.on_change(html)}if(_this.props.remember_key){_this.set_memory||(_this.set_memory=_.throttle(function(html){return I.store_memory(this.remember_key(),html)},500));return _this.set_memory(html)}}}(this);return I.redactor($(ReactDOM.findDOMNode(this)),opts)},remember_key:function(){return"inputmemory:"+this.props.remember_key},clear_memory:function(){return I.clear_memory(this.remember_key())},get_default_value:function(){var v;if(v=this.props.defaultValue){return v}if(this.props.remember_key){if(v=typeof localStorage!=="undefined"&&localStorage!==null?localStorage.getItem(this.remember_key()):void 0){return v}}},render:function(){return textarea({name:this.props.name,value:this.props.value,defaultValue:this.get_default_value(),placeholder:this.props.placeholder,required:this.props.required,autoFocus:this.props.autofocus})}});c("CSRF",{pure:true,render:function(){return input({type:"hidden",name:"csrf_token",value:$("meta[name=csrf_token]").attr("value")})}});R.DownTickIcon=React.createElement("svg",{className:"svgicon icon_down_tick2",strokeLinecap:"round",stroke:"currentColor",role:"img",version:"1.1",viewBox:"0 0 24 24",strokeWidth:"2",width:"22",height:"22",strokeLinejoin:"round","aria-hidden":true,fill:"none"},React.createElement("polyline",{points:"6 9 12 15 18 9"}));P=R["package"]("Forms");P("TextInputRow",{pure:true,propTypes:{title:types.string,sub:types.any,name:types.string.isRequired,value:types.any},focus:function(){return this.input_ref.current.focus()},get_input_el:function(){return this.input_ref.current},get_value:function(){return this.input_ref.current.value},componentDidMount:function(){var valid_slug_chars;if(this.props.money_input){if(!this.props.currency){throw new Error("missing currency")}I.money_input(this.input_ref.current,{currency:this.props.currency})}if(this.props.slug_input){I.slug_input($(this.input_ref.current))}if(this.props.integer_input){valid_slug_chars=/[0-9]/g;return $(this.input_ref.current).on("keypress",function(_this){return function(e){var char;if(e.keyCode>=32){char=String.fromCharCode(e.keyCode);if(!char.match(valid_slug_chars)){return false}}}}(this))}},render:function(){var inside;inside=[div({className:"label",key:"label"},this.props.title,this.props.sub?span({className:"sub"}," — ",this.props.sub):void 0),input({type:"text",key:"input",name:this.props.name,ref:this.input_ref||(this.input_ref=React.createRef()),value:this.props.value,defaultValue:this.props.defaultValue,onChange:this.props.onChange,onKeyUp:this.props.onKeyUp,onFocus:this.props.onFocus,onBlur:this.props.onBlur,onClick:this.props.onClick,readOnly:this.props.readonly,className:classNames({has_error:this.props.has_error}),required:this.props.required,placeholder:this.props.placeholder,disabled:this.props.disabled,pattern:this.props.pattern}),this.props.error_message?p({key:"error",className:"input_error"},this.props.error_message):void 0];if(!this.props.multi){inside=label({children:inside})}return div({className:classNames("input_row",this.props.className)},inside)}});P("SimpleSelect",{pure:true,propTypes:{options:types.array.isRequired,name:types.string},getInitialState:function(){return{value:this.props.defaultValue?this.props.defaultValue:void 0}},render:function(){var children,current,current_group,push_group,render_current_option;current=this.current_option();render_current_option=this.props.render_current_option;render_current_option||(render_current_option=function(_this){return function(current){return current.short_name||current.name}}(this));children=[];current_group=null;push_group=function(){if(!current_group){return}children.push(optgroup.apply(null,[{label:current_group.label,key:"group-"+children.length}].concat(slice.call(current_group.children))));return current_group=null};this.props.options.map(function(_this){return function(o,idx){var opt;opt=option({key:""+idx,value:o.value},o.name);if(o.group){if((current_group!=null?current_group.label:void 0)!==o.group){push_group()}current_group||(current_group={label:o.group,children:[]});return current_group.children.push(opt)}else{push_group();return children.push(opt)}}}(this));push_group();return this.enclose({className:classNames({focused:this.state.focused,disabled:this.props.disabled,has_value:current!==this.props.options[0]})},div({className:"selected_option"},span({className:"selected_option_name"},render_current_option(current)),R.DownTickIcon),select({disabled:this.props.disabled,value:current.value,name:this.props.name,onFocus:function(_this){return function(e){return _this.setState({focused:true})}}(this),onBlur:function(_this){return function(e){return _this.setState({focused:false})}}(this),onChange:this.on_change,children:children}))},on_change:function(e){var value;value=e.target.value;if(this.props.onChange){if(value===this.props.value){return}return this.props.onChange(value)}else{if(value===this.state.value){return}return this.setState({value:value})}},find_option:function(value){var j,len,opt,ref;ref=this.props.options;for(j=0,len=ref.length;j<len;j++){opt=ref[j];if(opt.value===value){return opt}}},current_option:function(){var current,search_value;search_value=this.props.value||this.state.value;current=search_value!=null?this.find_option(search_value):void 0;return current||this.props.options[0]}});P("Select",{propTypes:{name:types.string.isRequired,value:types.any,options:types.array.isRequired},componentDidMount:function(){var el,opts;if(!this.props.selectize){return}opts=this.props.selectize===true?{}:this.props.selectize;el=$(this.refs.input);el.selectize(opts);if(this.props.onChange){return el.on("change",function(_this){return function(e){return _this.props.onChange(e)}}(this))}},render:function(){return select({ref:"input",name:this.props.name,onChange:this.props.onChange,value:this.props.value,defaultValue:this.props.defaultValue,children:this.props.options.map(function(_this){return function(arg){var label,value;value=arg[0],label=arg[1];return option({key:value,value:value},label||value)}}(this))})}});P("RadioButtons",{propTypes:{name:types.string.isRequired,value:types.any,options:types.array.isRequired},getValue:function(){var j,len,name,ref,ref1,value;ref=this.container().find("input").serializeArray();for(j=0,len=ref.length;j<len;j++){ref1=ref[j],name=ref1.name,value=ref1.value;return value}},render:function(){return ul({className:"radio_list",children:this.props.options.map(function(_this){return function(arg,idx){var input_label,more_opts,sub,value;value=arg[0],input_label=arg[1],sub=arg[2],more_opts=arg[3];return li({key:value!=null?value:idx,className:classNames({disabled:more_opts!=null?more_opts.disabled:void 0})},label({},input($.extend({type:"radio",name:_this.props.name,value:value,defaultChecked:_this.props.defaultValue?value===_this.props.defaultValue:void 0,checked:_this.props.value!=null?value===_this.props.value:void 0,onChange:_this.props.onChange},more_opts)),span({className:"radio_label"},input_label),sub?span({className:"sub"}," — ",sub):void 0))}}(this))})}});P("Slider",{pure:true,propTypes:{min:types.number,max:types.number,value:types.number,onChange:types.func,disabled:types.bool},getInitialState:function(){return{}},on_change:function(value){value=Math.round(value);if(this.props.onChange){if(this.props.value===value){return}return this.props.onChange(value)}else{if(this.state.value===value){return}return this.setState({value:value})}},start_drag:function(start_x,start_y){var move_listener,start_value,up_listener,width;if(this.props.disabled){return}width=this.refs.track.clientWidth;start_value=this.current_value();this.setState({dragging:true});move_listener=function(_this){return function(e){var dx,new_value,x,y;e.preventDefault();if(e.buttons===0){up_listener();return}x=e.pageX;y=e.pageX;dx=x-start_x;new_value=dx/width*(_this.props.max-_this.props.min)+start_value;new_value=Math.min(_this.props.max,Math.max(_this.props.min,new_value));if(new_value!==_this.current_value()){return _this.on_change(new_value)}}}(this);up_listener=function(_this){return function(e){if(e!=null){e.preventDefault()}_this.setState({dragging:false});document.body.removeEventListener("mousemove",move_listener);document.body.removeEventListener("mouseup",up_listener);return delete _this.up_listener}}(this);document.body.addEventListener("mousemove",move_listener);document.body.addEventListener("mouseup",up_listener);return this.up_listener=up_listener},current_value:function(){if("value"in this.state){return this.state.value||this.props.min}else{return this.props.value||this.props.min}},percent:function(){return(this.current_value()-this.props.min)/(this.props.max-this.props.min)},componentWillUnmount:function(){if(this.up_listener){return this.up_listener()}},render:function(){var offset_style;offset_style={left:this.percent()*100+"%"};return this.enclose({className:classNames("slider_input",{disabled:this.props.disabled}),onClick:function(_this){return function(e){var new_value,rect;if(e.target===_this.refs.slider_nub){return}rect=_this.refs.track.getBoundingClientRect();p=Math.min(rect.width,Math.max(0,e.pageX-rect.left))/rect.width;new_value=_this.props.min+p*(_this.props.max-_this.props.min);new_value=Math.min(_this.props.max,Math.max(_this.props.min,new_value));if(new_value!==_this.current_value()){return _this.on_change(new_value)}}}(this)},this.props.name?input({type:"hidden",name:this.props.name,value:this.current_value()}):void 0,div({ref:"track",className:"slider_track"},div({className:"slider_fill",style:{width:this.percent()*100+"%"}}),this.state.focused&&this.props.show_tooltip?div({style:offset_style,className:"value_tooltip"},this.current_value()):void 0,button({type:"button",ref:"slider_nub",className:"slider_nub",onFocus:function(_this){return function(){return _this.setState({focused:true})}}(this),onBlur:function(_this){return function(){return _this.setState({focused:false})}}(this),onMouseDown:function(_this){return function(e){return _this.start_drag(e.pageX,e.pageY)}}(this),onKeyDown:function(_this){return function(e){switch(e.keyCode){case 37:_this.on_change(Math.max(_this.props.min,_this.current_value()-1));break;case 39:_this.on_change(Math.min(_this.props.max,_this.current_value()+1));break;default:return}return e.preventDefault()}}(this),style:offset_style})))}});P("FilterPicker",{pure:true,componentWillUnmount:function(){return $(window).off("click",this.window_click_listener)},getDefaultProps:function(){return{label_padding:3}},getInitialState:function(){return{open:false}},close_picker:function(){if(!this.state.open){return}this.setState({open:false,popup_visible:false});return $(window).off("click",this.window_click_listener)},open_picker:function(){var el,rect;el=this.open_button_ref.current;rect=el.getBoundingClientRect();if(this.window_click_listener){$(window).off("click",this.window_click_listener)}this.window_click_listener=function(_this){return function(e){c=$(e.target).closest(_this.container());if(c.length){return}return _this.close_picker()}}(this);$(window).on("click",this.window_click_listener);return this.setState({open:true,top:-this.props.label_padding,left:-this.props.label_padding,height:rect.height+this.props.label_padding*2},function(_this){return function(){_this.filter_popup_ref.current.focus();return _.defer(function(){if(_this.window_click_listener&&_this.state.open){return _this.setState({popup_visible:true})}})}}(this))},render:function(){return this.enclose({className:classNames("filter_picker_widget",{open:this.state.open,popup_visible:this.state.popup_visible}),onKeyDown:this.state.open?function(_this){return function(e){if(e.keyCode===27){return _this.close_picker()}}}(this):void 0},button({type:"button",className:"filter_value",ref:this.open_button_ref||(this.open_button_ref=React.createRef()),onClick:this.state.open?this.close_picker:this.open_picker},span({className:"value_label"},this.props.label),R.DownTickIcon),div({tabIndex:-1,ref:this.filter_popup_ref||(this.filter_popup_ref=React.createRef()),className:"filter_popup",style:{top:(this.state.top||0)+"px",left:(this.state.left||0)+"px"}},div({style:{marginTop:(this.state.height||0)+"px"},className:"filter_options"},this.props.render_children?this.state.open?this.props.render_children():void 0:this.props.children)))}});P("StarPicker",{getDefaultProps:function(){return{total_stars:5,star_filled:"icon-star",star_empty:"icon-star2"}},getInitialState:function(){return{}},set_value:function(value){if(this.props.set_value){return this.props.set_value(value)}else{return this.setState({value:value})}},render:function(){var display_value,i,ref,ref1,ref2,stars,value;value=(ref=(ref1=(ref2=this.props.value)!=null?ref2:this.state.value)!=null?ref1:this.props.defaultValue)!=null?ref:0;display_value=this.state.preview_value||value;stars=function(){var j,ref3,results;results=[];for(i=j=1,ref3=this.props.total_stars;1<=ref3?j<=ref3:j>=ref3;i=1<=ref3?++j:--j){results.push(function(_this){return function(i){var cls;cls=i>display_value?"star icon "+_this.props.star_empty:"star icon "+_this.props.star_filled;return button({key:"star-"+i,type:"button",title:i+" Star"+(i===1?"":"s"),onMouseEnter:function(){return _this.setState({preview_value:i})},onMouseLeave:function(){return _this.setState({preview_value:null})},onClick:function(){return _this.set_value(i)}},span({className:cls}))}}(this)(i))}return results}.call(this);return this.enclose({className:classNames(this.props.className,{interactive:true,previewing:this.state.preview_value!=null,has_value:value>0})},this.props.name?input({type:"hidden",name:this.props.name,value:value>0?value:""}):void 0,stars)}});P("EditableInput",{getInitialState:function(){return{value:null,edit_value:null}},componentDidUpdate:function(prev_props){var value;value=this.state.value?this.state.value:this.props.value;if(this.props.value===value){return}return this.setState({value:this.props.value,edit_value:null})},confirm_edit:function(){if(!this.state.edit_value){return}return this.setValue(this.state.edit_value)},cancel_edit:function(){return this.setState({edit_value:null})},setValue:function(value){var base;this.setState({value:value,edit_value:null});return typeof(base=this.props).onUpdate==="function"?base.onUpdate(value):void 0},render:function(){var ref;return input({type:(ref=this.props.type)!=null?ref:"text",className:this.props.className,name:this.props.name,title:this.props.title,readOnly:this.props.readonly,required:this.props.required,placeholder:this.props.placeholder,disabled:this.props.disabled,pattern:this.props.pattern,value:this.state.edit_value!==null?this.state.edit_value:this.state.value!==null?this.state.value:this.props.value,onKeyDown:function(_this){return function(e){if(e.keyCode===27){_this.cancel_edit();e.stopPropagation()}if(e.keyCode===13){_this.confirm_edit();return e.stopPropagation()}}}(this),onFocus:function(_this){return function(e){return e.target.select()}}(this),onBlur:function(_this){return function(e){return _this.confirm_edit()}}(this),onChange:function(_this){return function(e){return _this.setState({edit_value:e.target.value})}}(this)})}});P("FocusButton",{pure:true,getInitialState:function(){return{focused:false}},componentWillUnmount:function(){var base;if(this.state.focused){return typeof(base=this.props).on_decrement_focus==="function"?base.on_decrement_focus():void 0}},on_focus:function(){var base;this.setState({focused:true});return typeof(base=this.props).on_increment_focus==="function"?base.on_increment_focus():void 0},on_blur:function(){var base;this.setState({focused:false});return typeof(base=this.props).on_decrement_focus==="function"?base.on_decrement_focus():void 0},render:function(){var props;props=$.extend({onFocus:this.on_focus,onBlur:this.on_blur},this.props);delete props.on_increment_focus;delete props.on_decrement_focus;return button(props)}});P("FormErrors",{pure:true,getDefaultProps:function(){return{animated:true,scroll_into_view:true}},propTypes:{title:types.string,errors:types.array.isRequired},render:function(){var el;el=function(){if(this.props.animated){if(!R.SlideDown){throw new Error("Attempted to render animated errors without R.SlideDown")}return R.SlideDown}else{return section}}.call(this);return el({className:classNames(this.enclosing_class_name(),"form_errors"),role:"alert"},div({ref:this.props.scroll_into_view?function(el){if(el){return typeof el.scrollIntoView==="function"?el.scrollIntoView():void 0}}:void 0},p({},strong({},this.props.title||this.tt("misc.forms.form_errors"))),ul({},this.props.errors.map(function(_this){return function(e){var text;text=e==="recaptcha"?"Please complete the CAPTCHA to continue":e;return li({key:e},text)}}(this))),this.props.children))}});P("RecaptchaInput",{propTypes:{sitekey:types.string.isRequired},componentDidMount:function(){return I.with_recaptcha(function(_this){return function(){var el;I.event("recaptcha","show",I.page_name());el=ReactDOM.findDOMNode(_this);return grecaptcha.render(el,{sitekey:_this.props.sitekey})}}(this))},render:function(){return div({className:"g-recaptcha"})}})})}).call(this);(function(){I.libs.react.done(function(){var _rdf,a,br,button,code,div,em,fieldset,form,fragment,h1,h2,h3,h4,h5,h6,iframe,img,input,label,legend,li,ol,optgroup,option,p,pre,section,select,span,strong,textarea,ul;_rdf=ReactDOMFactories;div=_rdf.div,span=_rdf.span,a=_rdf.a,br=_rdf.br,p=_rdf.p,ol=_rdf.ol,ul=_rdf.ul,li=_rdf.li,strong=_rdf.strong,em=_rdf.em,img=_rdf.img,form=_rdf.form,label=_rdf.label,input=_rdf.input,textarea=_rdf.textarea,button=_rdf.button,iframe=_rdf.iframe,h1=_rdf.h1,h2=_rdf.h2,h3=_rdf.h3,h4=_rdf.h4,h5=_rdf.h5,h6=_rdf.h6,pre=_rdf.pre,code=_rdf.code,select=_rdf.select,option=_rdf.option,section=_rdf.section,optgroup=_rdf.optgroup,fieldset=_rdf.fieldset,legend=_rdf.legend;fragment=React.createFactory(React.Fragment);R.component("SlideDown",{getInitialState:function(){return{}},getDefaultProps:function(){return{duration:200,delay:1}},componentDidMount:function(){var el;el=ReactDOM.findDOMNode(this);return this.timer=window.setTimeout(function(_this){return function(){_this.setState({height:el.scrollHeight||false});_this.timer=window.setTimeout(function(){return _this.setState({animated:true})},_this.props.duration+50);return _this.wrapper_ref.current.scrollTop=0}}(this),this.props.delay)},componentWillUnmount:function(){if(this.timer){window.clearTimeout(this.timer);return delete this.timer}},render:function(){var style;style=this.state.height===false?null:this.state.height?this.state.animated?null:{height:this.state.height+"px",overflow:"hidden",transition:"height "+this.props.duration/1e3+"s ease"}:{height:0,overflow:"scroll",transition:"height 0.2s ease"};return div({style:style,className:this.props.className,ref:this.wrapper_ref||(this.wrapper_ref=React.createRef())},this.props.children)}})})}).call(this);(function(){I.RateGameForm=function(){function RateGameForm(el){var form,picker,rate_btn,update_state;this.el=$(el);I.has_follow_button(this.el);I.with_redactor(function(_this){return function(){return I.redactor(_this.el.find("textarea"),{minHeight:50,source:false,buttons:["bold","italic","deleted","lists","link"]})}}(this));I.event2("view rate game lightbox");I.format_dates(this.el,"fromNow");rate_btn=this.el.find(".rate_btn");picker=new I.StarPicker(this.el.find(".star_picker"));update_state=function(_this){return function(){var enabled;enabled=picker.el.is(".has_rating");return rate_btn.toggleClass("disabled",!enabled).prop("disabled",!enabled)}}(this);update_state();this.el.on("i:pick_star",update_state);form=this.el.find("form");form.remote_submit(function(_this){return function(res){if(res.errors){alert(res.errors.join(", "));return}_this.el.addClass("rating_success");res.game_id||(res.game_id=form.data("game_id"));res.score=+form.find("[name=game_rating]").val();if(res.score>=3){_this.el.addClass("show_follow_button")}return $(document.body).trigger("i:rating_updated",[res])}}(this));this.el.dispatch("click",{remove_rating_btn:function(_this){return function(btn){var i;i=$("<input type='hidden' name='remove_game_rating' value='1'>");form.append(i).submit();return _this.el.addClass("rating_removed")}}(this)})}return RateGameForm}()}).call(this);
